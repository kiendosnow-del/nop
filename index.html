<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” CÃ y ThuÃª Blox Fruits</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:Segoe UI,Tahoma,sans-serif;background:#f1f5f9;margin:0;padding-bottom:50px}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;transition:0.3s;color:#fff}
        button:hover{opacity:0.8}
        button.red{background:#ef4444}
        button.green{background:#22c55e}
        button.orange{background:#f59e0b}
        input,select,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
        .info{background:#f8fafc;border:1px dashed #38bdf8;border-radius:10px;padding:10px;margin-top:10px;line-height:1.6;font-size:14px}
        .qr-box{text-align:center;padding:15px;background:#f1f5f9;border-radius:10px}
        .history-item{padding:10px;border-bottom:1px solid #eee;font-size:13px}
        .status-pending{color:#f59e0b;font-weight:bold}
        .status-done{color:#22c55e;font-weight:bold}
        #modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:99}
        .badge{padding:2px 6px;border-radius:4px;font-size:10px;color:#fff;background:#94a3b8}
    </style>
</head>
<body>

<div id="modal-overlay"></div>

<div class="box">
    ğŸ‘¤ <b id="u">Äang táº£i...</b> | ğŸ’° <b id="b">0</b>Ä‘ 
    <button class="red" onclick="logout()" style="float:right;padding:5px 10px;margin:0">ThoÃ¡t</button>
</div>

<div class="box" id="auth_section" style="display:none">
    <button onclick="showAuth()" style="width:100%">ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</button>
</div>

<div class="box" id="user_actions" style="display:none">
    <div style="display:flex; gap:10px">
        <button class="orange" onclick="showDeposit()" style="flex:1">ğŸ’³ Náº¡p tiá»n</button>
        <button id="adminBtn" class="red" style="display:none; flex:1" onclick="showAdmin()">ğŸ›  Quáº£n trá»‹</button>
    </div>
</div>

<div class="box">
    <h3>ğŸ›’ Dá»‹ch vá»¥ CÃ y ThuÃª</h3>
    <select id="goi" onchange="showInfo()">
        <option value="">-- Chá»n gÃ³i cÃ y thuÃª --</option>
        <optgroup label="ğŸ”° LEVEL">
            <option value="Level 700|20000" data-info="Farm nhanh lÃªn level 700" data-detail="âœ” Farm quest nhanh<br>âœ” KhÃ´ng Ä‘á»•i trÃ¡i<br>âœ” 3â€“5 giá»">Level 700 â€“ 20.000Ä‘</option>
            <option value="700 â†’ 1500|20000" data-info="Farm tá»« Sea 2" data-detail="âœ” Farm boss + quest<br>âœ” KhÃ´ng máº¥t Ä‘á»“<br>âœ” 1â€“2 ngÃ y">700 â†’ 1500 â€“ 20.000Ä‘</option>
            <option value="1500 â†’ 2800|20000" data-info="Farm Sea 3" data-detail="âœ” Farm full Sea 3<br>âœ” An toÃ n 100%<br>âœ” 2â€“3 ngÃ y">1500 â†’ 2800 â€“ 20.000Ä‘</option>
            <option value="0 â†’ MAX|50000" data-info="CÃ y tá»« Ä‘áº§u tá»›i max" data-detail="âœ” Full Sea 1â€“2â€“3<br>âœ” KhÃ´ng máº¥t acc<br>âœ” 4â€“6 ngÃ y">0 â†’ MAX â€“ 50.000Ä‘</option>
        </optgroup>
        <optgroup label="ğŸ’ ITEM">
            <option value="Má» Neo|20000" data-info="LÃ m Má» Neo" data-detail="âœ” Full quest<br>âœ” KhÃ´ng máº¥t Ä‘á»“<br>âœ” 1 ngÃ y">Má» Neo â€“ 20.000Ä‘</option>
            <option value="Tushita|15000" data-info="Kiáº¿m Tushita" data-detail="âœ” Full quest<br>âœ” An toÃ n<br>âœ” Trong ngÃ y">Tushita â€“ 15.000Ä‘</option>
            <option value="Yama|30000" data-info="Kiáº¿m Yama" data-detail="âœ” Full Yama<br>âœ” KhÃ´ng máº¥t Ä‘á»“<br>âœ” 1â€“2 ngÃ y">Yama â€“ 30.000Ä‘</option>
            <option value="Tam Kiáº¿m Full|35000" data-info="True Triple Katana" data-detail="âœ” Full 3 kiáº¿m<br>âœ” KhÃ´ng rollback<br>âœ” 2â€“3 ngÃ y">Tam Kiáº¿m Full â€“ 35.000Ä‘</option>
            <option value="CDK|30000" data-info="Cursed Dual Katana" data-detail="âœ” Full CDK<br>âœ” KhÃ´ng máº¥t item<br>âœ” 1â€“2 ngÃ y">CDK â€“ 30.000Ä‘</option>
        </optgroup>
        <optgroup label="ğŸ’  V4">
            <option value="Full Gear V4|30000" data-info="Full Gear V4" data-detail="âœ” Full Gear<br>âœ” Thá»©c tá»‰nh V4<br>âœ” 1â€“2 ngÃ y">Full Gear V4 â€“ 30.000Ä‘</option>
            <option value="1 Gear V4|5000" data-info="Up 1 Gear" data-detail="âœ” 1 Gear báº¥t ká»³<br>âœ” Nhanh gá»n<br>âœ” Trong ngÃ y">1 Gear V4 â€“ 5.000Ä‘</option>
        </optgroup>
        <optgroup label="ğŸ¥‹ MELEE">
            <option value="Godhuman|20000" data-info="Melee Godhuman" data-detail="âœ” Full Godhuman<br>âœ” Farm nguyÃªn liá»‡u<br>âœ” 1 ngÃ y">Godhuman â€“ 20.000Ä‘</option>
            <option value="Melee V2|15000" data-info="Up Melee V2" data-detail="âœ” Melee V2<br>âœ” Nhanh<br>âœ” Trong ngÃ y">Melee V2 â€“ 15.000Ä‘</option>
        </optgroup>
    </select>

    <div id="acc_box" style="display:none; background:#fff3cd; padding:10px; border-radius:8px; margin-top:10px">
        <small><b>ThÃ´ng tin tÃ i khoáº£n Roblox:</b></small>
        <input type="text" id="game_user" placeholder="TÃªn Ä‘Äƒng nháº­p Roblox">
        <input type="text" id="game_pass" placeholder="Máº­t kháº©u Roblox">
    </div>

    <div id="goiInfo" class="info" style="display:none"></div>
    <button id="btnOrder" class="green" style="width:100%;font-size:16px;margin-top:10px" onclick="order()">MUA NGAY</button>
</div>

<div class="box">
    <h3>ğŸ“œ Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng</h3>
    <div id="his">Äang táº£i...</div>
</div>

<div id="adminPanel" class="box" style="display:none; border:2px solid red">
    <h2 style="color:red">ğŸ›  ADMIN CONTROL</h2>
    
    <div style="background:#fef2f2; padding:10px; border-radius:8px; margin-bottom:15px">
        <h4>Cá»™ng tiá»n thÃ nh viÃªn</h4>
        <input id="ad_target" placeholder="Username khÃ¡ch">
        <input type="number" id="ad_amt" placeholder="Sá»‘ tiá»n">
        <input type="password" id="ad_key" placeholder="Admin Key">
        <button class="red" onclick="adminAddMoney()" style="width:100%">Cá»˜NG TIá»€N</button>
    </div>

    <h4>Quáº£n lÃ½ Ä‘Æ¡n hÃ ng (ToÃ n há»‡ thá»‘ng)</h4>
    <div id="admin_orders_list"></div>
</div>

<div id="modal_content"></div>

<script>
const ADMIN_KEY = "SNOW_ADMIN_123";
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm";

let cur = null;
let allOrders = JSON.parse(localStorage.getItem('snow_orders') || "[]");

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session) loadUser(session);
    else render();
};

function loadUser(username) {
    const data = localStorage.getItem('user_' + username);
    if(data) cur = JSON.parse(data);
    render();
}

function saveUser() {
    if(cur) localStorage.setItem('user_' + cur.username, JSON.stringify(cur));
}

function saveOrders() {
    localStorage.setItem('snow_orders', JSON.stringify(allOrders));
}

function render() {
    if(!cur) {
        document.getElementById('u').innerText = "KhÃ¡ch";
        document.getElementById('b').innerText = "0";
        document.getElementById('auth_section').style.display = "block";
        document.getElementById('user_actions').style.display = "none";
        document.getElementById('his').innerHTML = "<i>Vui lÃ²ng Ä‘Äƒng nháº­p</i>";
        return;
    }
    document.getElementById('u').innerText = cur.username;
    document.getElementById('b').innerText = cur.balance.toLocaleString();
    document.getElementById('auth_section').style.display = "none";
    document.getElementById('user_actions').style.display = "block";
    document.getElementById('adminBtn').style.display = cur.username === 'admin' ? 'block' : 'none';

    // Lá»‹ch sá»­ cÃ¡ nhÃ¢n
    const myOrders = allOrders.filter(o => o.buyer === cur.username);
    const hisBox = document.getElementById('his');
    if(myOrders.length === 0) hisBox.innerHTML = "<i>ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o</i>";
    else {
        hisBox.innerHTML = myOrders.reverse().map(o => `
            <div class="history-item">
                <b>${o.goi}</b> <span class="badge">${o.time}</span><br>
                Tráº¡ng thÃ¡i: <span class="${o.status === 'ÄÃ£ xong' ? 'status-done' : 'status-pending'}">${o.status}</span>
            </div>
        `).join('');
    }

    if(cur.username === 'admin') renderAdminOrders();
}

function renderAdminOrders() {
    const box = document.getElementById('admin_orders_list');
    if(allOrders.length === 0) box.innerHTML = "ChÆ°a cÃ³ Ä‘Æ¡n";
    else {
        box.innerHTML = allOrders.slice().reverse().map((o, idx) => `
            <div class="history-item" style="background:#f9fafb; margin-bottom:5px; border:1px solid #ddd">
                <b>KhÃ¡ch: ${o.buyer}</b> | GÃ³i: ${o.goi}<br>
                TK: <code style="color:blue">${o.acc}</code> | MK: <code style="color:blue">${o.pass}</code><br>
                TT: <b class="${o.status==='ÄÃ£ xong'?'status-done':'status-pending'}">${o.status}</b>
                ${o.status === 'Äang chá»' ? `<button onclick="completeOrder(${allOrders.length - 1 - idx})" class="green" style="padding:2px 5px; font-size:11px">Xong</button>` : ''}
            </div>
        `).join('');
    }
}

function showInfo(){
    let s = document.getElementById('goi').options[document.getElementById('goi').selectedIndex];
    const info = document.getElementById('goiInfo');
    const accBox = document.getElementById('acc_box');
    if(!s.value) { info.style.display="none"; accBox.style.display="none"; return; }
    info.style.display="block";
    accBox.style.display="block";
    info.innerHTML=`<b>ğŸ“Œ ${s.dataset.info}</b><br>${s.dataset.detail}`;
}

async function order() {
    if(!cur) return alert("HÃ£y Ä‘Äƒng nháº­p!");
    const select = document.getElementById('goi');
    const gUser = document.getElementById('game_user').value.trim();
    const gPass = document.getElementById('game_pass').value.trim();

    if(!select.value) return alert("HÃ£y chá»n gÃ³i!");
    if(!gUser || !gPass) return alert("Vui lÃ²ng nháº­p tÃ i khoáº£n/máº­t kháº©u Roblox!");

    const [name, price] = select.value.split('|');
    const cost = parseInt(price);

    if(cur.balance < cost) return alert("Sá»‘ dÆ° khÃ´ng Ä‘á»§! Vui lÃ²ng náº¡p thÃªm.");

    cur.balance -= cost;
    const newOrder = {
        buyer: cur.username,
        goi: name,
        acc: gUser,
        pass: gPass,
        time: new Date().toLocaleString('vi-VN'),
        status: "Äang chá»"
    };
    
    allOrders.push(newOrder);
    saveOrders();
    saveUser();
    render();
    
    alert("Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng!");

    // Webhook Discord
    fetch(DISCORD_WEBHOOK, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            content: `ğŸ”” **ÄÆ N Má»šI**\nğŸ‘¤ KhÃ¡ch: ${cur.username}\nğŸ“¦ GÃ³i: ${name}\nğŸ® TK: ${gUser} | MK: ${gPass}`
        })
    });
}

function completeOrder(index) {
    allOrders[index].status = "ÄÃ£ xong";
    saveOrders();
    render();
    alert("ÄÃ£ duyá»‡t hoÃ n thÃ nh Ä‘Æ¡n hÃ ng!");
}

function adminAddMoney() {
    const target = document.getElementById('ad_target').value.trim();
    const amount = parseInt(document.getElementById('ad_amt').value);
    const key = document.getElementById('ad_key').value;

    if(key !== ADMIN_KEY) return alert("Sai mÃ£ Admin!");
    
    const targetData = localStorage.getItem('user_' + target);
    if(!targetData) return alert("KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng!");

    let userObj = JSON.parse(targetData);
    userObj.balance += amount;
    localStorage.setItem('user_' + target, JSON.stringify(userObj));
    
    if(cur.username === target) { cur = userObj; render(); }
    alert(`ÄÃ£ cá»™ng ${amount}Ä‘ cho ${target}`);
}

// CÃ¡c hÃ m Auth & UI cÆ¡ báº£n
function showAuth() {
    openModal(`
        <h3>ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3>
        <input id="au" placeholder="TÃªn tÃ i khoáº£n...">
        <input id="ap" type="password" placeholder="Máº­t kháº©u...">
        <button onclick="handleAuth()" style="width:100%">XÃC NHáº¬N</button>
    `);
}

function handleAuth() {
    const user = document.getElementById('au').value.trim().toLowerCase();
    const pass = document.getElementById('ap').value.trim();
    if(user.length < 3) return alert("TÃªn quÃ¡ ngáº¯n");

    const existing = localStorage.getItem('user_' + user);
    if(existing) {
        const parsed = JSON.parse(existing);
        if(parsed.password !== pass) return alert("Sai máº­t kháº©u!");
        cur = parsed;
    } else {
        cur = { username: user, password: pass, balance: 0 };
        saveUser();
    }
    localStorage.setItem('snow_session', cur.username);
    closeModal();
    render();
}

function showDeposit() {
    const content = `NAP ${cur.username}`;
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n Techcombank</h3>
        <div class="qr-box">
            <img src="https://img.vietqr.io/image/TCB-1373727384-compact.png" style="width:200px"><br>
            STK: <b>1373 7273 84</b><br>
            Ná»™i dung: <b style="color:red; font-size:18px">${content}</b>
        </div>
        <p style="font-size:12px">Chuyá»ƒn xong vui lÃ²ng Ä‘á»£i admin cá»™ng tiá»n.</p>
    `);
}

function showAdmin() {
    const p = document.getElementById('adminPanel');
    p.style.display = p.style.display === 'none' ? 'block' : 'none';
}

function logout() {
    localStorage.removeItem('snow_session');
    location.reload();
}

function openModal(html) {
    const m = document.getElementById('modal_content');
    const o = document.getElementById('modal-overlay');
    m.innerHTML = `<div class="box" style="position:fixed;top:10%;left:5%;right:5%;z-index:100;border:2px solid #38bdf8">
        ${html}
        <button class="red" onclick="closeModal()" style="width:100%">ÄÃ“NG</button>
    </div>`;
    o.style.display = "block";
}

function closeModal() {
    document.getElementById('modal_content').innerHTML = "";
    document.getElementById('modal-overlay').style.display = "none";
}
</script>

</body>
</html>
