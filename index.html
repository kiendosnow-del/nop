<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>‚ùÑÔ∏è SNOW SHOP ‚Äî Qu·∫£n Tr·ªã H·ªá Th·ªëng</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f1f5f9;margin:0;padding-bottom:80px; color:#334155}
        .box{background:#fff;margin:12px;border-radius:12px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
        button{border:0;padding:10px 14px;border-radius:8px;font-weight:600;margin:6px 0;cursor:pointer;transition:0.2s;color:#fff; display:inline-block;}
        button:hover{opacity:0.9; transform: translateY(-1px);}
        button:active{transform: translateY(1px);}
        button.blue{background:#38bdf8}
        button.red{background:#ef4444}
        button.green{background:#22c55e}
        button.purple{background:#8b5cf6}
        button.gray{background:#94a3b8}
        
        input,select,textarea{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #cbd5e1;box-sizing:border-box; font-family: inherit;}
        input:focus, select:focus{outline:none; border-color:#38bdf8; ring: 2px solid #bae6fd;}
        
        .info{background:#f0f9ff;border:1px dashed #38bdf8;border-radius:8px;padding:12px;margin-top:10px;line-height:1.5;font-size:14px; color:#0c4a6e}
        .qr-box{text-align:center;padding:15px;background:#fff;border-radius:10px; border: 1px solid #e2e8f0; margin-top:10px}
        
        .item-list{padding:12px;border-bottom:1px solid #f1f5f9;font-size:14px; position: relative;}
        .item-list:last-child{border-bottom:none}
        
        .status-pending{color:#f59e0b;font-weight:bold; background:#fffbeb; padding:2px 6px; border-radius:4px}
        .status-working{color:#8b5cf6;font-weight:bold; background:#f3e8ff; padding:2px 6px; border-radius:4px}
        .status-done{color:#22c55e;font-weight:bold; background:#dcfce7; padding:2px 6px; border-radius:4px}
        
        /* --- FIX L·ªñI CLICK: Modal System --- */
        /* Overlay n·ªÅn ƒëen */
        #modal-overlay{
            position:fixed; top:0; left:0; width:100%; height:100%; 
            background:rgba(0,0,0,0.5); display:none; z-index:2000; 
            backdrop-filter: blur(4px);
        }
        /* Container ch·ª©a n·ªôi dung modal - D√πng pointer-events: none ƒë·ªÉ Click xuy√™n qua n·∫øu n√≥ trong su·ªët */
        #modal_content{
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 2001;
            display: flex; justify-content: center; align-items: center;
        }
        /* B·∫£n th√¢n c√°i b·∫£ng Modal th√¨ cho ph√©p click */
        .modal-card { 
            pointer-events: auto;
            width:90%; max-width:400px; 
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            animation: modalPop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; overflow-y: auto; /* Fix l·ªói n·∫øu modal d√†i qu√° m√†n h√¨nh */
        }
        @keyframes modalPop { from{opacity:0; transform:scale(0.95)} to{opacity:1; transform:scale(1)} }

        /* Admin Tabs */
        .tab-btn{padding:8px 16px; border-radius:6px; background:#f1f5f9; color:#64748b; margin-right:4px; border:none; cursor:pointer; font-size: 13px;}
        .tab-btn.active{background:#38bdf8; color:#fff; box-shadow: 0 2px 4px rgba(56, 189, 248, 0.3)}
        .admin-section{display:none; animation: fadeIn 0.3s}
        .admin-section.active{display:block}
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        
        /* Utility */
        .flex-row { display:flex; align-items:center; justify-content:space-between; }
    </style>
</head>
<body>

<div class="box flex-row">
    <div>
        üë§ <b id="u">ƒêang t·∫£i...</b> <br>
        üí∞ <b id="b" style="color:#22c55e; font-size:1.1em">0</b> <span style="font-size:0.9em;color:#64748b">VNƒê</span>
    </div>
    <button class="red" id="btnLogout" style="padding:6px 12px; font-size:12px; display:none">ƒêƒÉng xu·∫•t</button>
</div>

<div id="client_view">
    <div class="box" id="auth_section">
        <div style="text-align:center; margin-bottom:10px">
            <h3>üëã Ch√†o m·ª´ng ƒë·∫øn v·ªõi Snow Shop</h3>
            <p style="color:#64748b; font-size:13px">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng d·ªãch v·ª•</p>
        </div>
        <button id="btnShowAuth" class="blue" style="width:100%; padding:12px">üîë ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</button>
    </div>

    <div class="box" id="user_actions" style="display:none">
        <button class="purple" id="btnDeposit" style="width:100%">üí≥ N·∫°p ti·ªÅn v√†o t√†i kho·∫£n</button>
    </div>

    <div class="box">
        <h3 style="margin-top:0">üõí D·ªãch v·ª• C√†y Thu√™</h3>
        <select id="goi">
            <option value="">-- Ch·ªçn g√≥i d·ªãch v·ª• --</option>
            <optgroup label="üî∞ LEVEL & FARM">
                <option value="Level 700|20000" data-info="Farm l√™n Level 700" data-detail="‚úî M·ªü Sea 2<br>‚úî Th·ªùi gian: 3‚Äì5 gi·ªù">Level 700 ‚Äì 20.000ƒë</option>
                <option value="700 ‚Üí 1500|20000" data-info="Farm max Sea 2" data-detail="‚úî M·ªü Sea 3<br>‚úî Th·ªùi gian: 1‚Äì2 ng√†y">700 ‚Üí 1500 ‚Äì 20.000ƒë</option>
                <option value="1500 ‚Üí 2800|20000" data-info="Farm max Level" data-detail="‚úî Max Level hi·ªán t·∫°i<br>‚úî Th·ªùi gian: 2‚Äì3 ng√†y">1500 ‚Üí 2800 ‚Äì 20.000ƒë</option>
                <option value="0 ‚Üí MAX|50000" data-info="C√†y t·ª´ ƒë·∫ßu t·ªõi MAX" data-detail="‚úî Full Sea 1‚Äì2‚Äì3<br>‚úî Th·ªùi gian: 4‚Äì6 ng√†y">0 ‚Üí MAX ‚Äì 50.000ƒë</option>
            </optgroup>
            <optgroup label="üéí ITEMS">
                <option value="M·ªè Neo|20000" data-info="L·∫•y M·ªè Neo (Anchor)" data-detail="‚úî C·∫ßn nguy√™n li·ªáu<br>‚úî Th·ªùi gian: 1 ng√†y">M·ªè Neo ‚Äì 20.000ƒë</option>
                <option value="Tushita|15000" data-info="L·∫•y ki·∫øm Tushita" data-detail="‚úî C·∫ßn Level 2000+<br>‚úî Trong ng√†y">Tushita ‚Äì 15.000ƒë</option>
                <option value="CDK|30000" data-info="L·∫•y Cursed Dual Katana" data-detail="‚úî C·∫ßn Tushita + Yama<br>‚úî Th·ªùi gian: 1-2 ng√†y">CDK ‚Äì 30.000ƒë</option>
            </optgroup>
        </select>

        <div id="acc_box" style="display:none; animation: fadeIn 0.3s">
            <div style="margin:10px 0; font-size:12px; color:#ef4444; font-weight:bold">* Vui l√≤ng t·∫Øt x√°c minh 2 b∆∞·ªõc (2FA) tr∆∞·ªõc khi thu√™.</div>
            <input type="text" id="game_user" placeholder="T√™n ƒëƒÉng nh·∫≠p Roblox">
            <input type="text" id="game_pass" placeholder="M·∫≠t kh·∫©u Roblox">
        </div>
        <div id="goiInfo" class="info" style="display:none"></div>
        <button class="green" id="btnOrder" style="width:100%; margin-top:10px; font-size: 16px;">X√ÅC NH·∫¨N MUA NGAY</button>
    </div>

    <div class="box">
        <h3 style="margin-top:0">üìú L·ªãch s·ª≠ ƒë∆°n h√†ng</h3>
        <div id="his">ƒêang t·∫£i...</div>
    </div>
</div>

<div id="admin_view" style="display:none">
    <div class="box" style="border: 1px solid #ef4444;">
        <h2 style="color:#ef4444; margin:0 0 15px 0; font-size:18px; text-transform:uppercase; border-bottom:1px solid #eee; padding-bottom:10px">üõ† H·ªá th·ªëng Qu·∫£n Tr·ªã</h2>
        
        <div style="margin-bottom:15px; display:flex; gap:5px; overflow-x:auto">
            <button class="tab-btn active" data-tab="tab_orders">ƒê∆°n h√†ng</button>
            <button class="tab-btn" data-tab="tab_users">Th√†nh vi√™n</button>
            <button class="tab-btn" data-tab="tab_gift">C·ªông ti·ªÅn</button>
        </div>

        <div id="tab_orders" class="admin-section active">
            <div id="admin_all_orders"></div>
        </div>

        <div id="tab_users" class="admin-section">
            <div id="admin_user_list"></div>
        </div>

        <div id="tab_gift" class="admin-section">
            <div style="background:#fff7ed; padding:10px; border-radius:8px; margin-bottom:10px; font-size:13px; color:#c2410c">
                ‚ö†Ô∏è <b>L∆∞u √Ω:</b> Nh·∫≠p ch√≠nh x√°c t√™n t√†i kho·∫£n kh√°ch h√†ng.
            </div>
            <label style="font-size:12px; font-weight:bold">T√†i kho·∫£n kh√°ch:</label>
            <input id="ad_target" placeholder="Nh·∫≠p username...">
            
            <label style="font-size:12px; font-weight:bold">S·ªë ti·ªÅn:</label>
            <input type="number" id="ad_amt" placeholder="VD: 50000">
            
            <label style="font-size:12px; font-weight:bold">M√£ x√°c nh·∫≠n (Admin Key):</label>
            <input type="password" id="ad_key" placeholder="Nh·∫≠p m√£ b·∫£o m·∫≠t...">
            
            <button class="red" id="btnAdminAdd" style="width:100%; margin-top:10px">X√ÅC NH·∫¨N C·ªòNG TI·ªÄN</button>
        </div>
    </div>
</div>

<div id="modal-overlay"></div>
<div id="modal_content"></div>

<script>
/* ----- C·∫•u h√¨nh H·ªá th·ªëng ----- */
const CONFIG = {
    ADMIN_ID: "snowadmin",
    ADMIN_PASS: "Snowadmin1910",
    ADMIN_KEY: "SNOW_SECRET",
    WEBHOOK: "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm"
};

/* ----- State ----- */
let cur = null; 
let allOrders = [];
let el = {}; // Khai b√°o r·ªóng tr∆∞·ªõc, load sau ƒë·ªÉ tr√°nh l·ªói Null

/* ----- Helpers ----- */
function safeParse(key, defaultVal) {
    try { return JSON.parse(localStorage.getItem(key)) || defaultVal; } 
    catch (e) { return defaultVal; }
}
function formatMoney(n) { return Number(n).toLocaleString('vi-VN'); }
function escapeHtml(str) {
    if (!str) return '';
    return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
}
function userKeyFrom(name) { return 'user_' + (name || '').trim().toLowerCase(); }

/* ----- Init ----- */
// FIX QUAN TR·ªåNG: Ch·ªâ l·∫•y Element khi trang ƒë√£ t·∫£i xong ƒë·ªÉ tr√°nh l·ªói "kh√¥ng click ƒë∆∞·ª£c"
window.addEventListener('DOMContentLoaded', () => {
    // 1. Map Elements
    el = {
        uLabel: document.getElementById('u'),
        bLabel: document.getElementById('b'),
        authSec: document.getElementById('auth_section'),
        userAct: document.getElementById('user_actions'),
        adminView: document.getElementById('admin_view'),
        his: document.getElementById('his'),
        goi: document.getElementById('goi'),
        accBox: document.getElementById('acc_box'),
        goiInfo: document.getElementById('goiInfo'),
        overlay: document.getElementById('modal-overlay'),
        modalCont: document.getElementById('modal_content'),
        btnLogout: document.getElementById('btnLogout'),
        btnShowAuth: document.getElementById('btnShowAuth'),
        btnDeposit: document.getElementById('btnDeposit'),
        btnOrder: document.getElementById('btnOrder'),
        adOrders: document.getElementById('admin_all_orders'),
        adUsers: document.getElementById('admin_user_list'),
        btnAdminAdd: document.getElementById('btnAdminAdd')
    };

    // 2. Load Data
    allOrders = safeParse('snow_orders', []);
    const session = localStorage.getItem('snow_session');
    if (session) {
        const uData = safeParse(userKeyFrom(session), null);
        if (uData) cur = uData;
    }
    
    // 3. Bind Events (G√°n s·ª± ki·ªán Click)
    bindEvents();
    render();
});

function bindEvents() {
    // G√°n onclick an to√†n
    if(el.btnShowAuth) el.btnShowAuth.onclick = showAuthModal;
    if(el.btnLogout) el.btnLogout.onclick = logout;
    if(el.btnDeposit) el.btnDeposit.onclick = showDepositModal;
    if(el.goi) el.goi.onchange = onPackageChange;
    if(el.btnOrder) el.btnOrder.onclick = handleOrder;
    if(el.overlay) el.overlay.onclick = closeModal;
    if(el.btnAdminAdd) el.btnAdminAdd.onclick = adminAddMoney;

    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            e.target.classList.add('active');
            const targetId = e.target.getAttribute('data-tab');
            document.getElementById(targetId).classList.add('active');
        });
    });
}

/* ----- Render ----- */
function render() {
    if (cur) {
        // C·∫≠p nh·∫≠t l·∫°i s·ªë d∆∞ m·ªõi nh·∫•t
        const fresh = safeParse(userKeyFrom(cur.username), null);
        if (fresh) cur = fresh;
    }

    if (!cur) {
        el.uLabel.innerText = "Kh√°ch";
        el.bLabel.innerText = "0";
        el.authSec.style.display = "block";
        el.userAct.style.display = "none";
        el.adminView.style.display = "none";
        el.btnLogout.style.display = "none";
        el.his.innerHTML = "<div style='text-align:center;color:#94a3b8;padding:20px'><i>Vui l√≤ng ƒëƒÉng nh·∫≠p.</i></div>";
    } else {
        el.uLabel.innerText = cur.username;
        el.bLabel.innerText = formatMoney(cur.balance);
        el.authSec.style.display = "none";
        el.userAct.style.display = "block";
        el.btnLogout.style.display = "inline-block";

        // History
        const myOrders = allOrders.filter(o => o.buyer && o.buyer.toLowerCase() === cur.usernameLower);
        el.his.innerHTML = myOrders.length === 0 
            ? "<div style='text-align:center;color:#94a3b8;padding:10px'><i>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</i></div>"
            : myOrders.slice().reverse().map(o => `
                <div class="item-list">
                    <div style="font-weight:600; color:#334155">${escapeHtml(o.goi)}</div>
                    <div style="display:flex; justify-content:space-between; margin-top:4px">
                        <span class="${o.status === 'ƒê√£ xong' ? 'status-done' : (o.status === 'ƒêang c√†y' ? 'status-working' : 'status-pending')}" style="font-size:12px">${escapeHtml(o.status)}</span>
                        <span style="font-size:12px; color:#94a3b8">${escapeHtml(o.time)}</span>
                    </div>
                </div>`).join('');

        // Admin
        if (cur.usernameLower === CONFIG.ADMIN_ID.toLowerCase()) {
            el.adminView.style.display = "block";
            renderAdminPanel();
        } else {
            el.adminView.style.display = "none";
        }
    }
}

function renderAdminPanel() {
    if (!allOrders.length) {
        el.adOrders.innerHTML = "<p style='padding:10px; text-align:center'>Ch∆∞a c√≥ ƒë∆°n n√†o.</p>";
    } else {
        el.adOrders.innerHTML = allOrders.slice().reverse().map((o, idx) => {
            const realIdx = allOrders.length - 1 - idx;
            // FIX CLICK: G·ªçi h√†m window.updateOrder
            return `
            <div class="item-list" style="background:#fff; border:1px solid #f1f5f9; border-radius:8px; margin-bottom:8px">
                <div style="font-weight:bold; color:#0f172a">${escapeHtml(o.buyer)} <span style="font-weight:normal; color:#64748b">- ${escapeHtml(o.goi)}</span></div>
                <div style="background:#f8fafc; padding:6px; font-family:monospace; font-size:12px; border-radius:4px; margin:4px 0">
                    User: ${escapeHtml(o.acc)} | Pass: ${escapeHtml(o.pass)}
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <b style="font-size:13px">${escapeHtml(o.status)}</b>
                    <div>
                        <button onclick="window.updateOrder(${realIdx}, 'ƒêang c√†y')" class="purple" style="padding:4px 8px; font-size:11px">C√†y</button>
                        <button onclick="window.updateOrder(${realIdx}, 'ƒê√£ xong')" class="green" style="padding:4px 8px; font-size:11px">Xong</button>
                        <button onclick="window.deleteOrder(${realIdx})" class="red" style="padding:4px 8px; font-size:11px">X√≥a</button>
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    const userList = safeParse('snow_users', []);
    el.adUsers.innerHTML = userList.length === 0 ? "<p>Tr·ªëng</p>" : userList.map(uKey => {
        const u = safeParse(userKeyFrom(uKey), null);
        if (!u) return '';
        return `<div class="item-list flex-row">
            <span>üë§ <b>${escapeHtml(u.username)}</b></span>
            <span style="color:#22c55e; font-weight:bold">${formatMoney(u.balance)} ƒë</span>
        </div>`;
    }).join('');
}

/* ----- Logic & Actions ----- */
function showAuthModal() {
    openModal(`
        <div class="box modal-card" style="border-top: 4px solid #38bdf8">
            <h3 style="text-align:center; margin-top:0">üîê ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h3>
            <form id="auth_form">
                <input id="au" placeholder="T√™n t√†i kho·∫£n (vi·∫øt li·ªÅn)..." autocomplete="off" required>
                <input id="ap" type="password" placeholder="M·∫≠t kh·∫©u..." required>
                <button type="submit" class="blue" style="width:100%; margin-top:10px">TI·∫æP T·ª§C</button>
            </form>
            <p style="font-size:12px; color:#64748b; text-align:center; margin-bottom:0">* T·ª± ƒë·ªông t·∫°o t√†i kho·∫£n n·∫øu ch∆∞a c√≥.</p>
        </div>
    `);
    document.getElementById('auth_form').onsubmit = (e) => {
        e.preventDefault();
        handleLogin();
    };
    setTimeout(() => { if(document.getElementById('au')) document.getElementById('au').focus() }, 100);
}

function handleLogin() {
    const uRaw = document.getElementById('au').value.trim();
    const pRaw = document.getElementById('ap').value.trim();
    if (uRaw.length < 3 || pRaw.length < 3) return alert("T√†i kho·∫£n/M·∫≠t kh·∫©u qu√° ng·∫Øn!");
    
    const uLower = uRaw.toLowerCase();
    if (uLower === CONFIG.ADMIN_ID.toLowerCase() && pRaw === CONFIG.ADMIN_PASS) {
        const admin = { username: CONFIG.ADMIN_ID, password: CONFIG.ADMIN_PASS, balance: 99999999, usernameLower: uLower };
        saveUser(admin);
        cur = admin;
    } else {
        const key = userKeyFrom(uRaw);
        const ex = safeParse(key, null);
        if (ex) {
            if (ex.password === pRaw) cur = ex;
            else return alert("Sai m·∫≠t kh·∫©u!");
        } else {
            const newUser = { username: uRaw, password: pRaw, balance: 0, usernameLower: uLower };
            saveUser(newUser);
            cur = newUser;
        }
    }
    localStorage.setItem('snow_session', cur.username);
    closeModal();
    render();
}

function saveUser(u) {
    if(!u.usernameLower) u.usernameLower = u.username.trim().toLowerCase();
    localStorage.setItem(userKeyFrom(u.username), JSON.stringify(u));
    let idx = safeParse('snow_users', []);
    if (!idx.includes(u.usernameLower)) {
        idx.push(u.usernameLower);
        localStorage.setItem('snow_users', JSON.stringify(idx));
    }
}

function logout() {
    if(!confirm("ƒêƒÉng xu·∫•t?")) return;
    localStorage.removeItem('snow_session');
    cur = null;
    render();
}

function showDepositModal() {
    if (!cur) return;
    openModal(`
        <div class="box modal-card" style="border-top: 4px solid #a855f7">
            <h3 style="text-align:center; margin-top:0">üí≥ N·∫°p ti·ªÅn chuy·ªÉn kho·∫£n</h3>
            <div style="background:#fff7ed; color:#c2410c; padding:10px; border-radius:8px; font-size:13px; text-align:center">
                N·ªôi dung CK: <b style="user-select:all">NAP ${escapeHtml(cur.username)}</b>
            </div>
            <div class="qr-box">
                <img src="https://img.vietqr.io/image/MB-0000000000-compact.png?amount=0&addInfo=NAP%20${encodeURIComponent(cur.username)}&accountName=SNOWSHOP" style="width:100%; max-width:200px;">
            </div>
            <button class="red" onclick="closeModal()" style="width:100%">ƒê√ìNG</button>
        </div>
    `);
}

function onPackageChange() {
    if (!el.goi.value) {
        el.goiInfo.style.display = "none";
        el.accBox.style.display = "none";
        return;
    }
    const s = el.goi.options[el.goi.selectedIndex];
    el.goiInfo.style.display = "block";
    el.accBox.style.display = "block";
    el.goiInfo.innerHTML = `<b>üìå ${escapeHtml(s.dataset.info)}</b><br><small>${s.dataset.detail}</small>`;
}

function handleOrder() {
    if (!cur) return alert("Vui l√≤ng ƒëƒÉng nh·∫≠p!");
    const val = el.goi.value;
    const ug = document.getElementById('game_user').value.trim();
    const pg = document.getElementById('game_pass').value.trim();
    
    if (!val || !ug || !pg) return alert("Thi·∫øu th√¥ng tin!");
    const [pkg, price] = val.split('|');
    const cost = parseInt(price);
    
    if (cur.balance < cost) return alert("Kh√¥ng ƒë·ªß ti·ªÅn!");
    
    cur.balance -= cost;
    saveUser(cur);
    
    const od = { buyer: cur.username, goi: pkg, acc: ug, pass: pg, status: "ƒêang ch·ªù", time: new Date().toLocaleString('vi-VN') };
    allOrders.push(od);
    localStorage.setItem('snow_orders', JSON.stringify(allOrders));
    
    // Webhook Discord
    fetch(CONFIG.WEBHOOK, {
        method: "POST", headers: {'Content-Type':'application/json'},
        body: JSON.stringify({embeds:[{title:"üîî ƒê∆†N M·ªöI", color:5814783, fields:[{name:"Kh√°ch",value:od.buyer},{name:"G√≥i",value:od.goi},{name:"Acc/Pass",value:`${od.acc} | ${od.pass}`}]}]})
    }).catch(()=>{});

    alert("Mua th√†nh c√¥ng!");
    render();
}

function adminAddMoney() {
    const tUser = document.getElementById('ad_target').value.trim();
    const tAmt = parseInt(document.getElementById('ad_amt').value);
    const tKey = document.getElementById('ad_key').value.trim();
    
    if (!tUser || !tAmt || tKey !== CONFIG.ADMIN_KEY) return alert("Sai th√¥ng tin ho·∫∑c Key!");
    const key = userKeyFrom(tUser);
    const u = safeParse(key, null);
    if (!u) return alert("User kh√¥ng t·ªìn t·∫°i!");
    
    u.balance = Number(u.balance) + tAmt;
    saveUser(u);
    if (cur && cur.usernameLower === u.usernameLower) cur.balance = u.balance;
    
    alert(`ƒê√£ c·ªông ${formatMoney(tAmt)}ƒë cho ${u.username}`);
    render();
}

/* ----- Window Global Functions (Cho Admin Button Click) ----- */
window.updateOrder = function(idx, st) {
    if (!allOrders[idx]) return;
    allOrders[idx].status = st;
    localStorage.setItem('snow_orders', JSON.stringify(allOrders));
    render();
};

window.deleteOrder = function(idx) {
    if (!confirm("X√≥a ƒë∆°n n√†y?")) return;
    allOrders.splice(idx, 1);
    localStorage.setItem('snow_orders', JSON.stringify(allOrders));
    render();
};

window.closeModal = function() {
    el.overlay.style.display = 'none';
    el.modalCont.innerHTML = '';
};

function openModal(html) {
    el.modalCont.innerHTML = html;
    el.overlay.style.display = 'block';
}
</script>
</body>
</html>
