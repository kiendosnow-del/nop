<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>â„ï¸ SNOW | CÃ y ThuÃª Blox Fruits</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f8ff}
header{background:linear-gradient(135deg,#1e90ff,#00c6ff);color:#fff;padding:14px;text-align:center}
.container{max-width:560px;margin:auto;padding:14px}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px}
input,select,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:10px}
button{background:#1e90ff;color:#fff;border:none;font-weight:bold}
.order{border:1px solid #ddd;border-radius:10px;padding:8px;margin:6px 0}
.hide{display:none}
.price{font-weight:bold;color:#1e90ff}
</style>
</head>

<body>
<header>
<h2>â„ï¸ SNOW</h2>
<div id="userBox" class="hide">
ğŸ‘¤ <b id="uname"></b> | ğŸ’° <b id="wallet">0Ä‘</b>
<button onclick="logout()">ÄÄƒng xuáº¥t</button>
</div>
</header>

<div class="container">

<!-- AUTH -->
<div class="card" id="authBox">
<input id="email" placeholder="Email">
<input id="pass" type="password" placeholder="Máº­t kháº©u">
<input id="username" placeholder="TÃªn hiá»ƒn thá»‹ (chá»‰ khi Ä‘Äƒng kÃ½)">
<button onclick="login()">ÄÄƒng nháº­p</button>
<button onclick="register()">ÄÄƒng kÃ½</button>
</div>

<!-- USER ORDER -->
<div class="card hide" id="orderBox">
<select id="goi">
<option value="0">-- Chá»n gÃ³i cÃ y thuÃª --</option>

<optgroup label="ğŸ”° LEVEL">
<option value="20000">700 â†’ 1500 (20k)</option>
<option value="20000">1500 â†’ 2800 (20k)</option>
<option value="50000">0 â†’ MAX (50k)</option>
</optgroup>

<optgroup label="ğŸ§° ITEM">
<option value="20000">Má» Neo (20k)</option>
<option value="15000">Tushita (15k)</option>
<option value="30000">Yama (30k)</option>
<option value="20000">Tam Kiáº¿m Láº» (20k)</option>
<option value="35000">Tam Kiáº¿m Full (35k)</option>
<option value="30000">CDK (30k)</option>
</optgroup>

<optgroup label="âš™ï¸ UP V4">
<option value="30000">Full Gear (30k)</option>
<option value="20000">Gáº¡t Cáº§n (20k)</option>
<option value="20000">Máº£nh GÆ°Æ¡ng (20k)</option>
<option value="5000">1 Gear (5k)</option>
</optgroup>

<optgroup label="ğŸ§¬ RACE">
<option value="20000">Cyborg (20k)</option>
<option value="20000">Ghoul (20k)</option>
</optgroup>

<optgroup label="ğŸ¥‹ MELEE">
<option value="20000">Godhuman (20k)</option>
<option value="15000">Melee V2 (15k)</option>
</optgroup>

<optgroup label="ğŸ“ˆ MASTERY">
<option value="45000">600 Mas (45k)</option>
<option value="50000">600 Mas Gun (50k)</option>
</optgroup>
</select>

<div class="price">GiÃ¡: <span id="price">0Ä‘</span></div>
<input id="rbx" placeholder="Username Roblox">
<textarea id="note" placeholder="Ghi chÃº"></textarea>
<button onclick="buy()">ğŸ›’ MUA</button>
</div>

<!-- ADMIN -->
<div class="card hide" id="adminBox">
<h3>ğŸ›  ADMIN PANEL</h3>
<div id="orderList"></div>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// âš ï¸ DÃN CONFIG FIREBASE THáº¬T Cá»¦A Báº N VÃ€O ÄÃ‚Y
const firebaseConfig = {
  apiKey: "AIzaSyBe1mlXDAnOWzqkMarFN5PKJmuM9YIKTs4",
  authDomain: "nott-9d55e.firebaseapp.com",
  projectId: "nott-9d55e",
  storageBucket: "nott-9d55e.firebasestorage.app",
  messagingSenderId: "1013326079626",
  appId: "1:1013326079626:web:1be873b3eb551b2d87af73",
  measurementId: "G-RGJXCLEY7L"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const WEBHOOK = "DISCORD_WEBHOOK_Cá»¦A_Báº N";

goi.onchange = () => price.innerText = (+goi.value).toLocaleString()+"Ä‘";

// AUTH STATE
auth.onAuthStateChanged(user=>{
  if(!user) return;
  db.collection("users").doc(user.uid).onSnapshot(s=>{
    const d=s.data();
    authBox.classList.add("hide");
    userBox.classList.remove("hide");
    uname.innerText=d.username;
    wallet.innerText=(d.wallet||0).toLocaleString()+"Ä‘";

    if(d.role==="admin"){
      adminBox.classList.remove("hide");
      orderBox.classList.add("hide");
      loadOrders();
    }else{
      orderBox.classList.remove("hide");
      adminBox.classList.add("hide");
    }
  });
});

// AUTH
function register(){
  if(!username.value) return alert("Nháº­p tÃªn hiá»ƒn thá»‹");
  auth.createUserWithEmailAndPassword(email.value,pass.value)
  .then(r=>{
    db.collection("users").doc(r.user.uid).set({
      username:username.value,
      wallet:0,
      role:"user",
      created:Date.now()
    });
    alert("âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng");
  }).catch(e=>alert(e.message));
}

function login(){
  auth.signInWithEmailAndPassword(email.value,pass.value)
  .catch(()=>alert("âŒ Sai tÃ i khoáº£n hoáº·c máº­t kháº©u"));
}

function logout(){auth.signOut();location.reload();}

// BUY
async function buy(){
  const p=+goi.value;
  if(!p) return alert("ChÆ°a chá»n gÃ³i");

  const u=auth.currentUser;
  const uRef=db.collection("users").doc(u.uid);

  try{
    await db.runTransaction(async t=>{
      const us=await t.get(uRef);
      if(us.data().wallet<p) throw "Thiáº¿u tiá»n";
      t.update(uRef,{wallet:us.data().wallet-p});
      t.set(db.collection("orders").doc(),{
        uid:u.uid,
        username:us.data().username,
        goi:goi.options[goi.selectedIndex].text,
        price:p,
        note:note.value,
        status:"pending",
        time:Date.now()
      });
    });

    fetch(WEBHOOK,{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({content:`ğŸ“¦ ÄÆ N Má»šI\nğŸ‘¤ ${uname.innerText}\nğŸ“¦ ${goi.options[goi.selectedIndex].text}\nğŸ’° ${p.toLocaleString()}Ä‘`})
    });

    alert("âœ… ÄÃ£ táº¡o Ä‘Æ¡n");
  }catch(e){alert(e)}
}

// ADMIN
function loadOrders(){
  db.collection("orders").orderBy("time","desc").onSnapshot(s=>{
    orderList.innerHTML="";
    s.forEach(d=>{
      const o=d.data();
      orderList.innerHTML+=`
      <div class="order">
        ğŸ‘¤ ${o.username}<br>
        ğŸ“¦ ${o.goi}<br>
        ğŸ’° ${o.price.toLocaleString()}Ä‘<br>
        ğŸ“Œ <b>${o.status}</b><br>
        ${o.status==="pending"?`
          <button onclick="done('${d.id}')">Duyá»‡t</button>
          <button onclick="refund('${d.id}','${o.uid}',${o.price})">HoÃ n</button>
        `:""}
      </div>`;
    });
  });
}

function done(id){
  db.collection("orders").doc(id).update({status:"done"});
}
function refund(id,uid,price){
  db.runTransaction(async t=>{
    const u=db.collection("users").doc(uid);
    const us=await t.get(u);
    t.update(u,{wallet:us.data().wallet+price});
    t.update(db.collection("orders").doc(id),{status:"refund"});
  });
}
</script>
</body>
</html>
