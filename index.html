<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SNOW SHOP — Thuê Cày Blox Fruits</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b1220;
  --card:#0f1724;
  --panel:#0b1220;
  --muted:#9ca3af;
  --text:#e5e7eb;
  --accent:#06b6d4; /* cyan */
  --accent-2:#facc15; /* yellow */
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(255,255,255,0.02);
  --success: #10b981;
  --danger:#ef4444;
  --radius:12px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg,#061021 0%, var(--bg) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.45;
}

/* Header */
.header{
  max-width:1200px;margin:18px auto;padding:18px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px;
}
.brand{
  display:flex;gap:12px;align-items:center;
}
.logo{
  width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#2563eb);display:flex;align-items:center;justify-content:center;font-weight:800;color:#021022;font-size:20px;
  box-shadow:0 6px 18px rgba(2,8,23,0.6);
}
.site-title{font-weight:700;font-size:18px}
.header-meta{display:flex;gap:14px;align-items:center;font-size:14px}
.header-meta .badge{background:var(--glass);padding:8px 12px;border-radius:999px;font-weight:600;color:var(--accent);}

/* Nav */
.nav{
  max-width:1200px;margin:0 auto;background:transparent;padding:0 20px;display:flex;justify-content:center;
}
.nav .nav-inner{display:flex;gap:10px;align-items:center}
.nav button{
  background:transparent;border:none;color:var(--muted);padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;
}
.nav button.active, .nav button:hover{color:var(--text);background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01))}

/* Main container */
.container{max-width:1200px;margin:18px auto;padding:18px;display:grid;grid-template-columns:1fr 340px;gap:18px}
@media (max-width:980px){ .container{grid-template-columns:1fr} }

/* Left column */
.panel{
  background:linear-gradient(180deg,var(--panel),#071122);border-radius:var(--radius);padding:20px;box-shadow:0 12px 30px rgba(1,6,16,0.6);
}

/* Hero */
.hero{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:18px;border-radius:12px;background:linear-gradient(90deg,rgba(6,182,212,0.06),rgba(58,123,213,0.03));}
.hero-left{max-width:64%}
.hero h1{margin:0;font-size:20px;color:var(--text);line-height:1.05}
.hero p{margin:8px 0 0;color:var(--muted);font-size:14px}
.hero-cta{margin-top:12px;display:flex;gap:10px}
.btn{
  border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;
  background:linear-gradient(90deg,var(--accent),#2563eb);color:#021022;
  box-shadow:0 8px 20px rgba(6,182,212,0.08);
}
.btn-outline{
  background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)
}

/* Packages grid */
.packages{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:16px}
@media (max-width:980px){ .packages{grid-template-columns:repeat(2,1fr)} }
@media (max-width:640px){ .packages{grid-template-columns:1fr} }

.card{
  background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
  border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);
}
.package-title{display:flex;justify-content:space-between;align-items:center;gap:8px}
.pkg-name{font-weight:800}
.pkg-price{font-weight:800;color:var(--accent)}
.pkg-desc{color:var(--muted);font-size:13px;margin-top:6px}
.features{margin-top:10px;display:flex;flex-direction:column;gap:6px}
.feature{display:flex;gap:8px;align-items:flex-start;font-size:13px;color:var(--muted)}
.feature .dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(90deg,var(--accent),#60a5fa);margin-top:6px}

/* Right column (sidebar) */
.sidebar{display:flex;flex-direction:column;gap:12px}
.wallet{padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}
.wallet h4{margin:0}
.balance{font-weight:800;font-size:18px;color:var(--accent);margin-top:8px}

/* Order history */
.orders-list{padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}
.order-row{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:8px;background:var(--glass-2);}

/* Footer */
.footer{max-width:1200px;margin:18px auto;padding:14px;color:var(--muted);font-size:13px;text-align:center}

/* Modal (simple) */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:60}
.modal{width:100%;max-width:720px;background:linear-gradient(180deg,#071022,#05101a);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.modal h3{margin:0 0 12px}

/* Small helpers */
.kv{font-size:13px;color:var(--muted)}
.chips{display:flex;gap:8px;flex-wrap:wrap}

/* Micro animations */
.card, .package-card{transition:transform .18s ease, box-shadow .18s ease}
.card:hover, .package-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.6)}
</style>
</head>

<body>
  <header class="header" role="banner">
    <div class="brand">
      <div class="logo" aria-hidden>SS</div>
      <div>
        <div class="site-title">SNOW SHOP</div>
        <div class="kv">Thuê cày Blox Fruits — Uy tín • Nhanh • An toàn</div>
      </div>
    </div>

    <div class="header-meta" aria-hidden>
      <div class="badge" id="userLabelSmall">Chưa đăng nhập</div>
      <div class="badge">Ví: <strong id="soduSmall">0</strong>đ</div>
    </div>
  </header>

  <nav class="nav" role="navigation" aria-label="Chính">
    <div class="nav-inner">
      <button data-tab="home" class="active">Gói dịch vụ</button>
      <button data-tab="account">Tài khoản</button>
      <button data-tab="orders">Lịch sử</button>
      <button id="contactBtn">Liên hệ</button>
    </div>
  </nav>

  <main class="container" role="main">
    <!-- LEFT COLUMN: main content -->
    <section class="panel" id="home">
      <div class="hero" aria-labelledby="heroTitle">
        <div class="hero-left">
          <h1 id="heroTitle">Thuê cày Blox Fruits nhanh — an toàn — bảo mật</h1>
          <p>Gói chuyên nghiệp, cày nhanh, không mất đồ. Chọn gói, đặt đơn, team sẽ liên hệ và hoàn thành theo cam kết.</p>
          <div class="hero-cta">
            <button class="btn" id="shopNow">Mua ngay</button>
            <button class="btn btn-outline" id="howItWorks">Cách hoạt động</button>
          </div>
        </div>
        <div class="hero-right" style="text-align:right">
          <div class="kv">Hỗ trợ 24/7</div>
          <div style="margin-top:10px" class="chips">
            <div class="kv">✅ Thanh toán đa dạng</div>
            <div class="kv">✅ Kỹ thuật chuyên nghiệp</div>
          </div>
        </div>
      </div>

      <!-- Packages -->
      <div style="margin-top:18px;display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Gói nổi bật</h3>
        <div class="kv">Chọn gói phù hợp — Giá hiển thị là VNĐ</div>
      </div>

      <div class="packages" id="packagesGrid" role="list" aria-label="Danh sách gói">
        <!-- Packages are inserted by JS -->
      </div>

      <section style="margin-top:18px" class="card">
        <h4 style="margin:0 0 8px">Cam kết</h4>
        <ul class="kv" style="margin:6px 0 0;padding-left:16px">
          <li>Hoàn tiền nếu không thực hiện đúng cam kết</li>
          <li>Không thay đổi pass/không lấy thông tin cá nhân</li>
          <li>Hỗ trợ sau bán hàng và nhận phản hồi</li>
        </ul>
      </section>
    </section>

    <!-- RIGHT COLUMN: sidebar -->
    <aside class="sidebar">
      <div class="wallet card">
        <h4 style="margin:0">Tài khoản</h4>
        <div class="kv" id="acctInfo">Bạn chưa đăng nhập</div>
        <div class="balance" id="walletBalance">0đ</div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn" id="openAccountBtn">Đăng nhập / Đăng ký</button>
          <button class="btn btn-outline" id="quickOrder">Đặt nhanh</button>
        </div>
      </div>

      <div class="orders-list" id="recentOrders">
        <h4 style="margin:0 0 8px">Đơn gần đây</h4>
        <div id="ordersPreview" aria-live="polite"></div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px">Liên hệ & hỗ trợ</h4>
        <div class="kv">Discord / Telegram / Zalo</div>
        <div style="margin-top:8px">
          <button class="btn btn-outline" id="supportContact">Mở liên hệ</button>
        </div>
      </div>
    </aside>
  </main>

  <div class="footer">© <span id="year"></span> SNOW SHOP — Thiết kế chuyên nghiệp cho dịch vụ thuê cày.</div>

  <!-- Modal markup (hidden) -->
  <div id="modalRoot" class="hidden" aria-hidden="true"></div>

<script>
/* --------------------------------------------------------------------------
   Professional shop front-end (single-file)
   - Responsive package grid
   - Modal order flow
   - Local demo auth (localStorage + SHA-256)
   - Orders saved to localStorage
   - Webhook forwarding placeholder (do not put raw Discord webhook in client)
   -------------------------------------------------------------------------- */

/* CONFIG */
const DISCORD_WEBHOOK = ""; // set to your backend endpoint that safely forwards to Discord (do not put raw discord webhook here)
const PACKAGE_LIST = [
  { id:'p_lvl700', name:'Level 700', price:20000, time:'3–5 giờ', desc:'Farm quest nhanh • Không đổi trái', features:['Farm quest tối ưu','Không mất đồ','Nhanh gọn'] },
  { id:'p_700_1500', name:'700 → 1500', price:20000, time:'1–2 ngày', desc:'Farm boss + quest', features:['Farm boss','Không mất đồ','An toàn'] },
  { id:'p_1500_2800', name:'1500 → 2800', price:20000, time:'2–3 ngày', desc:'Farm Sea 3 full', features:['Full Sea 3','An toàn cao','Hoàn thành đúng hạn'] },
  { id:'p_max', name:'0 → MAX', price:50000, time:'4–6 ngày', desc:'Cày từ đầu tới max', features:['Full Sea 1-2-3','Không mất acc','Cam kết hoàn thành'] },
  { id:'p_tushita', name:'Tushita', price:15000, time:'Trong ngày', desc:'Kiếm Tushita an toàn', features:['Full quest','Nhanh','An toàn'] },
  { id:'p_tamkiem', name:'Tam Kiếm Full', price:35000, time:'2–3 ngày', desc:'True Triple Katana', features:['Full 3 kiếm','Không rollback','Tỉ lệ cao'] },
];

/* ---------- Utilities ---------- */
const el = id => document.getElementById(id);
const qsa = sel => Array.from(document.querySelectorAll(sel));
function formatVND(n){ return (Number(n)||0).toLocaleString('vi-VN'); }
async function sha256(msg){
  const enc = new TextEncoder();
  const buf = await crypto.subtle.digest('SHA-256', enc.encode(msg));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

/* ---------- Local "backend" (demo) ---------- */
const DB = {
  usersKey: 'snowshop_users_v2',
  ordersKey: 'snowshop_orders_v2',
  loadUsers(){ return JSON.parse(localStorage.getItem(this.usersKey)||'{}'); },
  saveUsers(u){ localStorage.setItem(this.usersKey, JSON.stringify(u)); },
  loadOrders(){ return JSON.parse(localStorage.getItem(this.ordersKey)||'[]'); },
  saveOrders(o){ localStorage.setItem(this.ordersKey, JSON.stringify(o)); }
};

function currentUser(){ return JSON.parse(sessionStorage.getItem('snow_current_user')||'null'); }
function setCurrentUser(u){ if(u) sessionStorage.setItem('snow_current_user', JSON.stringify(u)); else sessionStorage.removeItem('snow_current_user'); }

/* ---------- Initial render ---------- */
(function bootstrap(){
  el('year').textContent = new Date().getFullYear();
  renderPackages();
  renderHeaderAuth();
  renderOrdersPreview();
  attachNav();
})();

/* ---------- Navigation / Tabs ---------- */
function attachNav(){
  qsa('.nav-inner button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      qsa('.nav-inner button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab || btn.textContent.toLowerCase();
      // show panels
      qsa('main .panel, main aside').forEach(n=>n.style.display='block');
      if(tab === 'account'){ openAccountModal(); }
      if(tab === 'orders'){ openOrdersPanel(); }
      if(tab === 'home'){ /* nothing */ }
    });
  });
  el('shopNow').addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));
  el('howItWorks').addEventListener('click', ()=>alert('1) Chọn gói • 2) Đặt đơn • 3) Kỹ thuật thi hành • 4) Hoàn thành và nhận phản hồi'));
  el('openAccountBtn').addEventListener('click', openAccountModal);
  el('quickOrder').addEventListener('click', ()=>openQuickOrderModal());
  el('contactBtn').addEventListener('click', ()=>alert('Liên hệ: Discord / Telegram / Zalo (thêm sau)'));
  el('supportContact').addEventListener('click', ()=>alert('Mở kênh hỗ trợ...'));
}

/* ---------- Packages rendering ---------- */
function renderPackages(){
  const grid = el('packagesGrid');
  grid.innerHTML = '';
  PACKAGE_LIST.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card package-card';
    card.setAttribute('role','listitem');
    card.innerHTML = `
      <div class="package-title">
        <div>
          <div class="pkg-name">${escapeHtml(p.name)}</div>
          <div class="kv">${escapeHtml(p.desc)}</div>
        </div>
        <div style="text-align:right">
          <div class="pkg-price">${formatVND(p.price)}₫</div>
          <div class="kv" style="font-size:12px">${p.time}</div>
        </div>
      </div>
      <div class="features" aria-hidden>
        ${p.features.map(f=>`<div class="feature"><div class="dot"></div>${escapeHtml(f)}</div>`).join('')}
      </div>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" data-buy="${p.id}">MUA NGAY</button>
        <button class="btn btn-outline" data-info="${p.id}">CHI TIẾT</button>
      </div>
    `;
    grid.appendChild(card);
  });

  // Attach listeners
  qsa('[data-buy]').forEach(b=>{
    b.addEventListener('click', (e)=>{
      const id = e.currentTarget.getAttribute('data-buy');
      const pkg = PACKAGE_LIST.find(x=>x.id===id);
      openOrderModal(pkg);
    });
  });
  qsa('[data-info]').forEach(b=>{
    b.addEventListener('click', (e)=>{
      const id = e.currentTarget.getAttribute('data-info');
      const pkg = PACKAGE_LIST.find(x=>x.id===id);
      alert(`${pkg.name}\n\nMô tả: ${pkg.desc}\nThời gian: ${pkg.time}\nGiá: ${formatVND(pkg.price)}₫\n\nTính năng:\n- ${pkg.features.join('\n- ')}`);
    });
  });
}

/* ---------- Modal factory ---------- */
function showModal(contentHTML, {closeOnBackdrop=true} = {}){
  // create backdrop
  const root = el('modalRoot');
  root.innerHTML = '';
  root.classList.remove('hidden');
  root.style.position = 'fixed';
  root.style.inset = 0;
  root.style.zIndex = 60;
  root.innerHTML = `<div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">${contentHTML}</div>`;
  // backdrop close
  if(closeOnBackdrop){
    document.getElementById('modalBackdrop').addEventListener('click', (ev)=>{
      if(ev.target.id === 'modalBackdrop') hideModal();
    });
  }
}
function hideModal(){ const root = el('modalRoot'); root.innerHTML=''; root.classList.add('hidden'); }

/* ---------- Account modal (login/register) ---------- */
function openAccountModal(){
  const html = `
    <div class="modal" role="document" style="max-width:480px">
      <h3>Tài khoản</h3>
      <div style="display:flex;gap:8px;margin-top:12px">
        <input id="m_user" placeholder="Tên đăng nhập" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)"/>
        <input id="m_pass" type="password" placeholder="Mật khẩu" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)"/>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" id="m_login">Đăng nhập</button>
        <button class="btn btn-outline" id="m_register">Đăng ký</button>
        <button class="btn btn-outline" id="m_close">Đóng</button>
      </div>
      <p class="kv" style="margin-top:10px">Lưu ý: demo lưu dữ liệu cục bộ. Không dùng tài khoản thực quan trọng.</p>
    </div>
  `;
  showModal(html);
  el('m_close').addEventListener('click', hideModal);
  el('m_register').addEventListener('click', async ()=>{
    const user = el('m_user').value.trim(); const pass = el('m_pass').value;
    if(!user || !pass){ alert('Nhập tên và mật khẩu'); return; }
    const users = DB.loadUsers();
    if(users[user]){ alert('Tài khoản đã tồn tại'); return; }
    const passHash = await sha256(pass);
    users[user] = { username:user, passHash, balance:0 };
    DB.saveUsers(users);
    alert('Đăng ký thành công. Vui lòng đăng nhập.');
    el('m_pass').value = '';
  });
  el('m_login').addEventListener('click', async ()=>{
    const user = el('m_user').value.trim(); const pass = el('m_pass').value;
    if(!user || !pass){ alert('Nhập tên và mật khẩu'); return; }
    const users = DB.loadUsers(); const rec = users[user];
    if(!rec){ alert('Không tìm thấy tài khoản'); return; }
    const h = await sha256(pass);
    if(h !== rec.passHash){ alert('Mật khẩu sai'); return; }
    setCurrentUser({ username:user });
    hideModal();
    renderHeaderAuth();
    alert('Đăng nhập thành công');
  });
}

/* ---------- Order modal / flow ---------- */
function openOrderModal(pkg){
  const cur = currentUser();
  const html = `
    <div class="modal" role="document">
      <h3>Đặt gói — ${escapeHtml(pkg.name)} <span style="float:right;color:var(--accent)">${formatVND(pkg.price)}₫</span></h3>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
        <label class="kv">Tên (Roblox / Discord)</label>
        <input id="o_name" placeholder="Tên người nhận / Discord" style="padding:10px;border-radius:8px"/>
        <label class="kv">Login Roblox</label>
        <input id="o_login" placeholder="Login Roblox" style="padding:10px;border-radius:8px"/>
        <label class="kv">Ghi chú</label>
        <textarea id="o_note" placeholder="Mô tả chi tiết, pass (nếu cần), thời gian ưu tiên..." style="padding:10px;border-radius:8px"></textarea>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" id="o_confirm">XÁC NHẬN ĐẶT</button>
        <button class="btn btn-outline" id="o_cancel">HỦY</button>
      </div>
      <p class="kv" style="margin-top:10px">Sau khi đặt, đơn hàng sẽ được lưu và gửi tới hệ thống. Bạn sẽ nhận được phản hồi từ team.</p>
    </div>
  `;
  showModal(html);
  if(cur) el('o_name').value = cur.username;
  el('o_cancel').addEventListener('click', hideModal);
  el('o_confirm').addEventListener('click', async ()=>{
    const curUser = currentUser();
    if(!curUser){ if(!confirm('Bạn chưa đăng nhập. Đăng nhập bây giờ?')) return; else { hideModal(); openAccountModal(); return; } }
    const name = el('o_name').value.trim(); const login = el('o_login').value.trim(); const note = el('o_note').value.trim();
    if(!name || !login){ alert('Nhập tên và login'); return; }
    // confirm
    if(!confirm(`Xác nhận đặt ${pkg.name} — ${formatVND(pkg.price)}₫ ?`)) return;
    const order = {
      id: 'o_' + Date.now(),
      username: curUser.username,
      name, login,
      package: pkg.name,
      price: pkg.price,
      note,
      createdAt: Date.now(),
      sent:false
    };
    // Save locally
    const list = DB.loadOrders(); list.unshift(order); DB.saveOrders(list);
    renderOrdersPreview();
    hideModal();
    // Try to send to backend webhook
    try{
      await sendOrderToWebhook(order);
      // mark as sent
      const list2 = DB.loadOrders();
      const idx = list2.findIndex(x=>x.id===order.id);
      if(idx>=0){ list2[idx].sent=true; DB.saveOrders(list2); renderOrdersPreview(); }
      alert('Đơn hàng đã gửi tới hệ thống!');
    }catch(err){
      console.warn('Webhook send failed', err);
      // copy payload for admin/backend manual forwarding (demo)
      const payload = JSON.stringify(buildOrderPayload(order), null, 2);
      try{ await navigator.clipboard.writeText(payload); }catch(e){}
      alert('Không thể gửi tự động. Payload đã được sao chép vào clipboard để gửi qua backend.');
    }
  });
}

/* Quick order modal (preselect first package) */
function openQuickOrderModal(){
  openOrderModal(PACKAGE_LIST[0]);
}

/* Build order payload for backend */
function buildOrderPayload(order){
  return {
    id: order.id,
    username: order.username,
    name: order.name,
    login: order.login,
    package: order.package,
    price: order.price,
    note: order.note,
    created_at: new Date(order.createdAt).toISOString()
  };
}

/* Try to forward to DISCORD_WEBHOOK (which should be a safe backend endpoint) */
async function sendOrderToWebhook(order){
  if(!DISCORD_WEBHOOK) throw new Error('No webhook configured');
  const payload = {
    embeds: [{
      title: `Đơn mới: ${order.package}`,
      color: 3447003,
      fields:[
        {name: 'Người đặt', value: order.username || '—', inline:true},
        {name: 'Tên/Discord', value: order.name || '—', inline:true},
        {name: 'Login', value: order.login || '—', inline:true},
        {name: 'Giá', value: formatVND(order.price) + '₫', inline:true},
        {name: 'Ghi chú', value: order.note || '—', inline:false}
      ],
      timestamp: new Date(order.createdAt).toISOString()
    }]
  };
  const res = await fetch(DISCORD_WEBHOOK, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  if(!res.ok) throw new Error('Forward failed: ' + res.status);
  return res;
}

/* ---------- Orders preview / list ---------- */
function renderOrdersPreview(){
  const div = el('ordersPreview');
  const list = DB.loadOrders();
  if(!div) return;
  if(list.length===0){ div.innerHTML = '<div class="kv">Chưa có đơn gần đây</div>'; return; }
  div.innerHTML = list.slice(0,6).map(o=>{
    return `<div class="order-row" title="${escapeHtml(o.package)}">
      <div style="max-width:70%"><strong>${escapeHtml(o.package)}</strong><div class="kv" style="font-size:12px">${escapeHtml(o.name)} • ${escapeHtml(o.login)}</div></div>
      <div style="text-align:right">
        <div class="kv">${formatVND(o.price)}₫</div>
        <div style="font-size:12px;color:${o.sent? 'var(--success)':'var(--accent)'}">${o.sent ? 'Đã gửi' : 'Chờ gửi'}</div>
      </div>
    </div>`;
  }).join('');
}

/* ---------- Orders Panel (open full orders in modal) ---------- */
function openOrdersPanel(){
  const list = DB.loadOrders();
  const html = `
    <div class="modal" style="max-width:760px">
      <h3>Lịch sử đơn hàng</h3>
      <div style="max-height:480px;overflow:auto;margin-top:12px">
        ${list.length===0 ? '<p class="kv">Chưa có đơn nào.</p>' : list.map(o=>`
          <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:8px;background:var(--glass-2)">
            <div>
              <div><strong>${escapeHtml(o.package)}</strong> <span class="kv">• ${new Date(o.createdAt).toLocaleString()}</span></div>
              <div class="kv">${escapeHtml(o.name)} — ${escapeHtml(o.login)}</div>
              <div class="kv" style="margin-top:6px">Ghi chú: ${escapeHtml(o.note||'—')}</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:800">${formatVND(o.price)}₫</div>
              <div class="kv" style="color:${o.sent? 'var(--success)':'var(--accent)'}">${o.sent ? 'Đã gửi' : 'Chưa gửi'}</div>
            </div>
          </div>
        `).join('')}
      </div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" id="ordersClose">Đóng</button>
        <button class="btn btn-outline" id="ordersExport">Xuất JSON</button>
      </div>
    </div>
  `;
  showModal(html);
  el('ordersClose').addEventListener('click', hideModal);
  el('ordersExport').addEventListener('click', ()=>{
    const json = JSON.stringify(DB.loadOrders(), null, 2);
    const w = window.open('', '_blank');
    w.document.write('<pre>' + escapeHtml(json) + '</pre>');
  });
}

/* ---------- Header / account rendering ---------- */
function renderHeaderAuth(){
  const cur = currentUser();
  if(cur){
    el('userLabelSmall').textContent = cur.username;
    const users = DB.loadUsers();
    const bal = (users[cur.username] && users[cur.username].balance) || 0;
    el('soduSmall').textContent = formatVND(bal);
    el('acctInfo').textContent = 'Xin chào, ' + cur.username;
    el('walletBalance').textContent = formatVND(bal) + '₫';
  } else {
    el('userLabelSmall').textContent = 'Chưa đăng nhập';
    el('soduSmall').textContent = '0';
    el('acctInfo').textContent = 'Bạn chưa đăng nhập';
    el('walletBalance').textContent = '0₫';
  }
}

/* ---------- Escape helper ---------- */
function escapeHtml(s){ if(s==null) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* ---------- Demo: create admin/demo user (optional) ---------- */
(async ()=>{
  const users = DB.loadUsers();
  if(!users['demo']){ users['demo'] = { username:'demo', passHash: await sha256('demo'), balance: 50000 }; DB.saveUsers(users); }
  renderHeaderAuth();
})();

</script>
</body>
</html>
