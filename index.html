<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” Quáº£n Trá»‹ Há»‡ Thá»‘ng</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f1f5f9;margin:0;padding-bottom:50px}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;transition:0.3s;color:#fff}
        button:hover{opacity:0.8}
        button.red{background:#ef4444}
        button.green{background:#22c55e}
        button.purple{background:#a855f7}
        input,select,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
        .info{background:#f8fafc;border:1px dashed #38bdf8;border-radius:10px;padding:10px;margin-top:10px;line-height:1.6;font-size:14px}
        .qr-box{text-align:center;padding:15px;background:#f1f5f9;border-radius:10px}
        .item-list{padding:10px;border-bottom:1px solid #eee;font-size:13px; position: relative;}
        .status-pending{color:#f59e0b;font-weight:bold}
        .status-done{color:#22c55e;font-weight:bold}
        #modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:99}
        .tab-btn{padding:8px 15px; border-radius:8px; background:#e2e8f0; color:#475569; margin-right:5px; border:none; cursor:pointer}
        .tab-btn.active{background:#38bdf8; color:#fff}
        .admin-section{display:none}
        .admin-section.active{display:block}
    </style>
</head>
<body>

<div id="modal-overlay"></div>

<div class="box">
    ğŸ‘¤ <b id="u">Äang táº£i...</b> | ğŸ’° <b id="b">0</b>Ä‘ 
    <button class="red" onclick="logout()" style="float:right;padding:5px 10px;margin:0">ThoÃ¡t</button>
</div>

<div id="client_view">
    <div class="box" id="auth_section" style="display:none">
        <button onclick="showAuth()" style="width:100%; background:#6366f1">ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</button>
    </div>

    <div class="box" id="user_actions" style="display:none">
        <button class="purple" onclick="showDeposit()" style="width:100%">ğŸ’³ Náº¡p tiá»n vÃ o tÃ i khoáº£n</button>
    </div>

    <div class="box">
        <h3>ğŸ›’ Dá»‹ch vá»¥ CÃ y ThuÃª</h3>
        <select id="goi" onchange="showInfo()">
            <option value="">-- Chá»n gÃ³i cÃ y thuÃª --</option>
            <optgroup label="ğŸ”° LEVEL">
                <option value="Level 700|20000" data-info="Farm nhanh lÃªn level 700" data-detail="âœ” Farm quest nhanh<br>âœ” KhÃ´ng Ä‘á»•i trÃ¡i<br>âœ” 3â€“5 giá»">Level 700 â€“ 20.000Ä‘</option>
                <option value="700 â†’ 1500|20000" data-info="Farm tá»« Sea 2" data-detail="âœ” Farm boss + quest<br>âœ” KhÃ´ng máº¥t Ä‘á»“<br>âœ” 1â€“2 ngÃ y">700 â†’ 1500 â€“ 20.000Ä‘</option>
                <option value="1500 â†’ 2800|20000" data-info="Farm Sea 3" data-detail="âœ” Farm full Sea 3<br>âœ” An toÃ n 100%<br>âœ” 2â€“3 ngÃ y">1500 â†’ 2800 â€“ 20.000Ä‘</option>
                <option value="0 â†’ MAX|50000" data-info="CÃ y tá»« Ä‘áº§u tá»›i max" data-detail="âœ” Full Sea 1â€“2â€“3<br>âœ” KhÃ´ng máº¥t acc<br>âœ” 4â€“6 ngÃ y">0 â†’ MAX â€“ 50.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’ ITEM">
                <option value="Má» Neo|20000" data-info="LÃ m Má» Neo" data-detail="âœ” Full quest<br>âœ” KhÃ´ng máº¥t Ä‘á»“<br>âœ” 1 ngÃ y">Má» Neo â€“ 20.000Ä‘</option>
                <option value="Tushita|15000" data-info="Kiáº¿m Tushita" data-detail="âœ” Full quest<br>âœ” An toÃ n<br>âœ” Trong ngÃ y">Tushita â€“ 15.000Ä‘</option>
            </optgroup>
        </select>

        <div id="acc_box" style="display:none">
            <input type="text" id="game_user" placeholder="TÃ i khoáº£n Roblox">
            <input type="text" id="game_pass" placeholder="Máº­t kháº©u Roblox">
        </div>
        <div id="goiInfo" class="info" style="display:none"></div>
        <button class="green" style="width:100%; margin-top:10px; font-size: 16px;" onclick="order()">XÃC NHáº¬N MUA</button>
    </div>

    <div class="box">
        <h3>ğŸ“œ Lá»‹ch sá»­ cá»§a báº¡n</h3>
        <div id="his">Äang táº£i...</div>
    </div>
</div>

<div id="admin_view" style="display:none">
    <div class="box" style="border: 2px solid #ef4444;">
        <h2 style="color:#ef4444; margin:0 0 10px 0">ğŸ›  Há»† THá»NG QUáº¢N TRá»Š</h2>
        <div style="margin-bottom:10px">
            <button class="tab-btn active" onclick="openTab(event, 'tab_orders')">ÄÆ¡n hÃ ng</button>
            <button class="tab-btn" onclick="openTab(event, 'tab_users')">ThÃ nh viÃªn</button>
            <button class="tab-btn" onclick="openTab(event, 'tab_gift')">Gift/Náº¡p</button>
        </div>

        <div id="tab_orders" class="admin-section active">
            <div id="admin_all_orders"></div>
        </div>

        <div id="tab_users" class="admin-section">
            <div id="admin_user_list"></div>
        </div>

        <div id="tab_gift" class="admin-section">
            <h4>ğŸ Táº·ng tiá»n / Duyá»‡t náº¡p</h4>
            <input id="ad_target" placeholder="TÃªn tÃ i khoáº£n nháº­n">
            <input type="number" id="ad_amt" placeholder="Sá»‘ tiá»n">
            <input type="password" id="ad_key" placeholder="Admin Key xÃ¡c nháº­n">
            <button class="red" onclick="adminAddMoney()" style="width:100%">XÃC NHáº¬N Cá»˜NG TIá»€N</button>
        </div>
    </div>
</div>

<div id="modal_content"></div>

<script>
const ADMIN_ID = "snowadmin"; 
const ADMIN_PASS = "Snowadmin1910";
const ADMIN_KEY = "SNOW_SECRET";
const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm"; // Thay URL tháº­t cá»§a báº¡n

let cur = null;
let allOrders = JSON.parse(localStorage.getItem('snow_orders') || "[]");

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session) loadUser(session);
    else render();
};

function loadUser(username) {
    const data = localStorage.getItem('user_' + username);
    if(data) cur = JSON.parse(data);
    render();
}

function render() {
    if(!cur) {
        document.getElementById('u').innerText = "KhÃ¡ch";
        document.getElementById('b').innerText = "0";
        document.getElementById('auth_section').style.display = "block";
        document.getElementById('user_actions').style.display = "none";
        document.getElementById('admin_view').style.display = "none";
        return;
    }
    document.getElementById('u').innerText = cur.username;
    document.getElementById('b').innerText = cur.balance.toLocaleString();
    document.getElementById('auth_section').style.display = "none";
    document.getElementById('user_actions').style.display = "block";

    const myOrders = allOrders.filter(o => o.buyer === cur.username);
    document.getElementById('his').innerHTML = myOrders.length ? myOrders.slice().reverse().map(o => `
        <div class="item-list"><b>${o.goi}</b> - <span class="${o.status==='ÄÃ£ xong'?'status-done':'status-pending'}">${o.status}</span><br><small>${o.time}</small></div>
    `).join('') : "<i>ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng.</i>";

    if(cur.username === ADMIN_ID) {
        document.getElementById('admin_view').style.display = "block";
        renderAdminData();
    } else {
        document.getElementById('admin_view').style.display = "none";
    }
}

function renderAdminData() {
    document.getElementById('admin_all_orders').innerHTML = allOrders.slice().reverse().map((o, idx) => `
        <div class="item-list" style="background:#f8fafc; border:1px solid #e2e8f0; margin-bottom:5px">
            <b>${o.buyer}</b> mua <b>${o.goi}</b><br>
            Roblox: <code style="color:blue">${o.acc}</code> | Pass: <code style="color:red">${o.pass}</code><br>
            TT: <b class="${o.status==='ÄÃ£ xong'?'status-done':'status-pending'}">${o.status}</b>
            ${o.status === 'Äang chá»' ? `<button onclick="completeOrder(${allOrders.length-1-idx})" style="font-size:10px; padding:2px 8px" class="green">Xong</button>` : ''}
        </div>
    `).join('') || "ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.";
}

function order() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    const s = document.getElementById('goi');
    const u = document.getElementById('game_user').value.trim();
    const p = document.getElementById('game_pass').value.trim();
    
    if(!s.value || !u || !p) return alert("Vui lÃ²ng nháº­p tÃ i khoáº£n Roblox!");
    
    const [name, price] = s.value.split('|');
    if(cur.balance < parseInt(price)) return alert("Báº¡n khÃ´ng Ä‘á»§ tiá»n!");
    
    cur.balance -= parseInt(price);
    
    const newOrder = {
        buyer: cur.username, 
        goi: name, 
        acc: u, 
        pass: p,
        status: "Äang chá»", 
        time: new Date().toLocaleString()
    };

    allOrders.push(newOrder);
    localStorage.setItem('snow_orders', JSON.stringify(allOrders));
    localStorage.setItem('user_' + cur.username, JSON.stringify(cur));
    
    sendDiscordNotify(newOrder);
    render();
    alert("Mua thÃ nh cÃ´ng! ThÃ´ng bÃ¡o Ä‘Ã£ Ä‘Æ°á»£c gá»­i tá»›i Admin.");
}

function sendDiscordNotify(orderData) {
    if (!DISCORD_WEBHOOK_URL.includes("https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm")) return;
    const params = {
        embeds: [{
            title: "ğŸ”” ÄÆ N HÃ€NG Má»šI!",
            color: 3447003,
            fields: [
                { name: "ğŸ‘¤ KhÃ¡ch", value: orderData.buyer, inline: true },
                { name: "ğŸ›’ GÃ³i", value: orderData.goi, inline: true },
                { name: "ğŸ® Acc", value: `\`${orderData.acc}\`` },
                { name: "ğŸ”‘ Pass", value: `\`${orderData.pass}\`` }
            ],
            timestamp: new Date()
        }]
    };
    fetch(DISCORD_WEBHOOK_URL, { method: "POST", headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(params) });
}

function showDeposit() {
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n</h3>
        <p>Ná»™i dung: <b>NAP ${cur.username}</b></p>
        <div class="qr-box"><img src="https://img.vietqr.io/image/TCB-1373727384-compact.png?addTag=NAP%20${cur.username}" style="width:180px"></div>
    `);
}

function showAuth() {
    openModal(`
        <h3>ğŸ” ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3>
        <input id="au" placeholder="TÃªn tÃ i khoáº£n...">
        <input id="ap" type="password" placeholder="Máº­t kháº©u...">
        <button onclick="handleAuth()" style="width:100%">XÃC NHáº¬N</button>
    `);
}

function handleAuth() {
    const user = document.getElementById('au').value.trim().toLowerCase();
    const pass = document.getElementById('ap').value.trim();
    if(user.length < 3) return alert("TÃªn quÃ¡ ngáº¯n!");
    if (user === ADMIN_ID && pass === ADMIN_PASS) {
        cur = { username: user, password: pass, balance: 999999999 };
    } else {
        const existingData = localStorage.getItem('user_' + user);
        if(existingData) {
            const userData = JSON.parse(existingData);
            if(userData.password === pass) cur = userData;
            else return alert("Sai máº­t kháº©u!");
        } else {
            cur = { username: user, password: pass, balance: 0 };
        }
    }
    localStorage.setItem('user_' + user, JSON.stringify(cur));
    localStorage.setItem('snow_session', cur.username);
    closeModal();
    render();
}

function logout() { localStorage.removeItem('snow_session'); location.reload(); }
function openModal(html) {
    document.getElementById('modal_content').innerHTML = `<div class="box" style="position:fixed;top:10%;left:5%;right:5%;z-index:100;border:2px solid #38bdf8">${html}<button class="red" onclick="closeModal()" style="width:100%">ÄÃ“NG</button></div>`;
    document.getElementById('modal-overlay').style.display = "block";
}
function closeModal() { document.getElementById('modal-overlay').style.display = "none"; document.getElementById('modal_content').innerHTML = ""; }
function showInfo(){
    let s = document.getElementById('goi').options[document.getElementById('goi').selectedIndex];
    if(!s.value) { document.getElementById('goiInfo').style.display="none"; document.getElementById('acc_box').style.display="none"; return; }
    document.getElementById('goiInfo').style.display="block";
    document.getElementById('acc_box').style.display="block";
    document.getElementById('goiInfo').innerHTML = `<b>ğŸ“Œ ${s.dataset.info}</b><br><small>${s.dataset.detail}</small>`;
}
function openTab(evt, tabId) {
    let contents = document.getElementsByClassName("admin-section");
    for (let i = 0; i < contents.length; i++) contents[i].classList.remove("active");
    let btns = document.getElementsByClassName("tab-btn");
    for (let i = 0; i < btns.length; i++) btns[i].classList.remove("active");
    document.getElementById(tabId).classList.add("active");
    evt.currentTarget.classList.add("active");
}
</script>
</body>
</html>
