<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” Professional System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f1f5f9;margin:0;padding-bottom:50px;color:#334155}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;transition:0.18s;color:#fff}
        button:hover{opacity:0.9;transform:translateY(-1px)}
        button.red{background:#ef4444} button.green{background:#22c55e} button.purple{background:#a855f7}
        input,select,textarea{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #e2e8f0;box-sizing:border-box;font-size:14px}
        .info{background:#f0f9ff;border:1px dashed #38bdf8;border-radius:10px;padding:12px;margin-top:10px;font-size:13px}
        .badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
        .bg-wait{background:#fef3c7;color:#d97706} .bg-done{background:#dcfce7;color:#16a34a} .bg-process{background:#f3e8ff;color:#7c3aed}
        .tab-btn{background:#fff;color:#64748b;border:1px solid #e2e8f0;margin-right:5px}
        .tab-btn.active{background:#38bdf8;color:#fff;border-color:#38bdf8}
        #modalOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,0.6);display:none;z-index:1000;backdrop-filter:blur(3px)}
        .modal{background:#fff;width:90%;max-width:400px;margin:80px auto;border-radius:16px;padding:20px;position:relative;animation:slideUp 0.3s}
        @keyframes slideUp{from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1}}
        optgroup{font-weight:bold;color:#0f172a}
    </style>
</head>
<body>

<div class="box" style="display:flex; justify-content:space-between; align-items:center; background:linear-gradient(to right, #ffffff, #f0f9ff)">
    <div>
        <div style="font-size:12px; color:#64748b">TÃ i khoáº£n: <b id="uName" style="color:#0f172a">KhÃ¡ch</b></div>
        <div style="font-size:18px; font-weight:bold; color:#16a34a">ğŸ’° <span id="uBalance">0</span> Ä‘</div>
    </div>
    <div id="authButtons"><button onclick="showLogin()">ğŸ”‘ ÄÄƒng nháº­p</button></div>
    <div id="userButtons" style="display:none"><button onclick="logout()" class="red">ThoÃ¡t</button></div>
</div>

<div id="clientView">
    <div class="box">
        <h3 style="margin:0 0 10px 0; color:#0f172a">ğŸ›’ Chá»n gÃ³i dá»‹ch vá»¥</h3>
        <select id="goi">
            <option value="">-- Click Ä‘á»ƒ chá»n gÃ³i --</option>
            <optgroup label="ğŸ”° CÃ€Y LEVEL (SEA 1-2-3)">
                <option value="Lv 1 - 700|20000">Lv 1 â†’ 700 (Sea 1) - 20,000Ä‘</option>
                <option value="Lv 700 - 1500|30000">Lv 700 â†’ 1500 (Sea 2) - 30,000Ä‘</option>
                <option value="Lv 1500 - MAX|40000">Lv 1500 â†’ MAX (Sea 3) - 40,000Ä‘</option>
                <option value="Lv 1 - MAX|80000">GÃ³i SiÃªu Cáº¥p: 1 â†’ MAX - 80,000Ä‘</option>
            </optgroup>
            <optgroup label="âš”ï¸ Váº¬T PHáº¨M (ITEMS)">
                <option value="Láº¥y CDK|50000">Cursed Dual Katana - 50,000Ä‘</option>
                <option value="Láº¥y Shark Anchor|40000">Má» Neo (Shark Anchor) - 40,000Ä‘</option>
                <option value="Láº¥y Soul Guitar|30000">ÄÃ n Soul Guitar - 30,000Ä‘</option>
                <option value="Full V3-V4|60000">Up Tá»™c V3 â†’ V4 (Full Gear) - 60,000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ”¥ MASTERY (THÃ”NG THáº O)">
                <option value="Mastery Sword 600|20000">Mastery Kiáº¿m 600 - 20,000Ä‘</option>
                <option value="Mastery Fruit 600|30000">Mastery TrÃ¡i Ãc Quá»· 600 - 30,000Ä‘</option>
                <option value="Mastery Melee 600|20000">Mastery VÃµ 600 - 20,000Ä‘</option>
            </optgroup>
        </select>
        <input id="accRoblox" placeholder="Username / Email Roblox">
        <input id="passRoblox" type="password" placeholder="Password Roblox">
        <div class="info">âš ï¸ HÃ£y táº¯t xÃ¡c minh 2 bÆ°á»›c (2FA) trÆ°á»›c khi Ä‘áº·t Ä‘Æ¡n.</div>
        <button class="green" style="width:100%; font-size:16px" onclick="handleBuy()">XÃC NHáº¬N MUA NGAY</button>
        <button class="purple" style="width:100%" onclick="showNapBank()">ğŸ’³ Náº P TIá»€N QUA BANK / MOMO</button>
    </div>

    <div class="box">
        <h3 style="margin:0 0 10px 0">ğŸ“œ Lá»‹ch sá»­ giao dá»‹ch</h3>
        <div id="historyList">Vui lÃ²ng Ä‘Äƒng nháº­p...</div>
    </div>
</div>

<div id="adminView" style="display:none">
    <div class="box" style="border: 2px solid #ef4444; background:#fff5f5">
        <h2 style="color:#ef4444; margin-top:0">ğŸ›  ADMIN PANEL</h2>
        <div style="display:flex; overflow-x:auto; padding-bottom:5px">
            <button class="tab-btn" onclick="showTab('usersList', this)">ThÃ nh viÃªn</button>
            <button class="tab-btn active" onclick="showTab('orders', this)">Quáº£n lÃ½ Ä‘Æ¡n</button>
            <button class="tab-btn" onclick="showTab('naps', this)">Duyá»‡t Náº¡p</button>
            <button class="tab-btn" onclick="showTab('users', this)">Cáº¥p Tiá»n</button>
        </div>

        <div id="tabOrders" class="tab-content"><div id="adminOrderList"></div></div>
        <div id="tabNaps" class="tab-content" style="display:none"><div id="adminNapList"></div></div>
        <div id="tabUsers" class="tab-content" style="display:none">
        <div id="tabUsersList" class="tab-content" style="display:none">
    <h4>Danh sÃ¡ch thÃ nh viÃªn há»‡ thá»‘ng</h4>
    <div id="adminMemberList"></div>
        </div>
            <h4>Cáº¥p tiá»n cho tÃ i khoáº£n</h4>
            <input id="adTargetUser" placeholder="TÃªn tÃ i khoáº£n nháº­n tiá»n">
            <input id="adAmount" type="number" placeholder="Sá»‘ tiá»n (VÃ­ dá»¥: 50000)">
            <button class="green" style="width:100%" onclick="adminAddMoney()">Cáº¤P TIá»€N NGAY</button>
        </div>
    </div>
</div>

<div id="modalOverlay"><div class="modal" id="modalContent"></div></div>

<script>
/* ----- CONFIG ----- */
const ADMIN_CONFIG = { user: "admin", pass: "admin123" };
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm"; // DÃ¡n webhook cá»§a báº¡n

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');

const el = {
    uName: document.getElementById('uName'),
    uBalance: document.getElementById('uBalance'),
    authBtns: document.getElementById('authButtons'),
    userBtns: document.getElementById('userButtons'),
    history: document.getElementById('historyList'),
    modal: document.getElementById('modalOverlay'),
    modalIn: document.getElementById('modalContent'),
    adminView: document.getElementById('adminView')
};

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session && db_users[session]) cur = db_users[session];
    render();
};

function render() {
    if(!cur) {
        el.uName.innerText = "KhÃ¡ch";
        el.uBalance.innerText = "0";
        el.authBtns.style.display = "block";
        el.userBtns.style.display = "none";
        el.adminView.style.display = "none";
        el.history.innerHTML = "<center>ÄÄƒng nháº­p Ä‘á»ƒ xem Ä‘Æ¡n</center>";
    } else {
        // Cáº­p nháº­t dá»¯ liá»‡u má»›i nháº¥t tá»« DB (Ä‘á» phÃ²ng Admin vá»«a cá»™ng tiá»n)
        cur = db_users[cur.username];
        el.uName.innerText = cur.username;
        el.uBalance.innerText = cur.balance.toLocaleString();
        el.authBtns.style.display = "none";
        el.userBtns.style.display = "block";
        el.adminView.style.display = (cur.username === ADMIN_CONFIG.user) ? "block" : "none";

        const myOrders = db_orders.filter(o => o.buyer === cur.username);
        el.history.innerHTML = myOrders.length ? myOrders.map(o => `
            <div style="border-bottom:1px solid #f1f5f9; padding:10px 0">
                <div style="display:flex; justify-content:space-between">
                    <b>${o.goi}</b>
                    <span class="badge ${o.status==='Xong'?'bg-done':(o.status==='Äang cÃ y'?'bg-process':'bg-wait')}">${o.status}</span>
                </div>
                <small style="color:#94a3b8">${o.time}</small>
            </div>
        `).reverse().join('') : "ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.";

        if(cur.username === ADMIN_CONFIG.user) renderAdmin();
    }
}

function renderAdmin() {
    // ... Giá»¯ nguyÃªn cÃ¡c pháº§n render Ä‘Æ¡n vÃ  náº¡p cÅ© ...

    // ThÃªm Ä‘oáº¡n nÃ y Ä‘á»ƒ render danh sÃ¡ch thÃ nh viÃªn
    document.getElementById('adminMemberList').innerHTML = Object.values(db_users).map(user => `
        <div class="box" style="background:#f8fafc; border:1px solid #e2e8f0; margin:5px 0">
            <div style="display:flex; justify-content:space-between; align-items:center">
                <div>
                    <b>User:</b> <span style="color:#0ea5e9">${user.username}</span><br>
                    <b>Pass:</b> <code>${user.password}</code>
                </div>
                <div style="text-align:right">
                    <b style="color:#16a34a">${user.balance.toLocaleString()}Ä‘</b>
                </div>
            </div>
        </div>
    `).reverse().join('');
}

/* ----- LOGIC CHÃNH ----- */
function handleBuy() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    const gÃ³iVal = document.getElementById('goi').value;
    const acc = document.getElementById('accRoblox').value.trim();
    const pass = document.getElementById('passRoblox').value.trim();

    if(!gÃ³iVal || !acc || !pass) return alert("Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin!");
    const [name, price] = gÃ³iVal.split('|');
    
    if(cur.balance < parseInt(price)) return alert("Sá»‘ dÆ° khÃ´ng Ä‘á»§!");

    cur.balance -= parseInt(price);
    db_users[cur.username] = cur;
    db_orders.push({ buyer: cur.username, goi: name, acc, pass, status: "Chá» duyá»‡t", time: new Date().toLocaleString() });
    
    save(); render();
    alert("Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng!");
    sendWebhook("ğŸ›’ ÄÆ N MÃ€U Má»šI", `KhÃ¡ch: ${cur.username}\nGÃ³i: ${name}\nAcc: ${acc}\nPass: ${pass}`, 3447003);
}

function adminAddMoney() {
    const target = document.getElementById('adTargetUser').value.trim();
    const amt = parseInt(document.getElementById('adAmount').value);
    
    if(db_users[target]) {
        db_users[target].balance += amt;
        save(); render();
        alert(`ÄÃ£ cáº¥p ${amt.toLocaleString()}Ä‘ cho ${target}`);
        document.getElementById('adAmount').value = "";
    } else {
        alert("NgÆ°á»i dÃ¹ng khÃ´ng tá»“n táº¡i!");
    }
}

function approveNap(i) {
    const req = db_naps[i];
    if(db_users[req.username]) {
        db_users[req.username].balance += req.amount;
        db_naps[i].status = "ÄÃ£ duyá»‡t";
        save(); render();
        alert("ÄÃ£ duyá»‡t náº¡p!");
    }
}

function showNapBank() {
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n NgÃ¢n hÃ ng</h3>
        <div class="info" style="text-align:center">
            NgÃ¢n hÃ ng: <b>TEC BANK</b><br>
            STK: <b>1373727384</b><br>
            Ná»™i dung: <b style="color:red; font-size:18px">NAP ${cur.username}</b>
        </div>
        <input id="napAmt" type="number" placeholder="Nháº­p sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn">
        <button class="green" style="width:100%" onclick="submitNap()">XÃC NHáº¬N ÄÃƒ CHUYá»‚N</button>
        <button class="red" style="width:100%" onclick="closeModal()">ÄÃ³ng</button>
    `);
}

function submitNap() {
    const amt = parseInt(document.getElementById('napAmt').value);
    if(!amt || amt < 1000) return alert("Tiá»n khÃ´ng há»£p lá»‡!");
    db_naps.push({ username: cur.username, amount: amt, status: "Chá» duyá»‡t", time: new Date().toLocaleString() });
    save(); closeModal();
    alert("ÄÃ£ gá»­i yÃªu cáº§u náº¡p!");
    sendWebhook("ğŸ’° YÃŠU Cáº¦U Náº P TIá»€N", `KhÃ¡ch: ${cur.username}\nSá»‘ tiá»n: ${amt.toLocaleString()}Ä‘\nNá»™i dung: NAP ${cur.username}`, 15105570);
}

/* ----- CÃC HÃ€M PHá»¤ ----- */
function save() {
    localStorage.setItem('snow_users', JSON.stringify(db_users));
    localStorage.setItem('snow_orders', JSON.stringify(db_orders));
    localStorage.setItem('snow_naps', JSON.stringify(db_naps));
}

function updateStatus(i, s) { db_orders[i].status = s; save(); render(); }
function deleteOrder(i) { if(confirm("XoÃ¡ Ä‘Æ¡n?")) { db_orders.splice(i,1); save(); render(); } }
function deleteNap(i) { db_naps.splice(i,1); save(); render(); }

async function sendWebhook(title, desc, color) {
    if(DISCORD_WEBHOOK.length < 10) return;
    await fetch(DISCORD_WEBHOOK, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ embeds: [{ title, description: desc, color, timestamp: new Date() }] })
    });
}

function showLogin() {
    openModal(`
        <h3>ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3>
        <input id="au" placeholder="TÃªn tÃ i khoáº£n">
        <input id="ap" type="password" placeholder="Máº­t kháº©u">
        <button class="green" style="width:100%" onclick="handleAuth()">VÃ€O SHOP</button>
        <button onclick="closeModal()" style="width:100%; background:none; color:#64748b">Quay láº¡i</button>
    `);
}

function handleAuth() {
    const u = document.getElementById('au').value.trim();
    const p = document.getElementById('ap').value;
    if(!u || !p) return alert("Nháº­p Ä‘á»§ thÃ´ng tin!");
    if(!db_users[u]) {
        db_users[u] = { username: u, password: p, balance: 0 };
        alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
    } else if(db_users[u].password !== p) return alert("Sai máº­t kháº©u!");
    cur = db_users[u];
    localStorage.setItem('snow_session', u);
    save(); closeModal(); render();
}

function logout() { localStorage.removeItem('snow_session'); location.reload(); }
function openModal(h) { el.modalIn.innerHTML = h; el.modal.style.display = "block"; }
function closeModal() { el.modal.style.display = "none"; }
function showTab(t, b) {
    document.querySelectorAll('.tab-content').forEach(c => c.style.display = "none");
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1)).style.display = "block";
    b.classList.add('active');
}
</script>
</body>
</html>
