<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Blox Fruits Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;font-family:sans-serif;
  background:#0b0f1a;color:#fff;
}
.box{
  max-width:400px;margin:80px auto;
  background:#111827;padding:20px;
  border-radius:12px;
}
input,button{
  width:100%;padding:12px;
  margin-top:10px;border-radius:8px;
  border:none;font-size:16px;
}
input{background:#1f2937;color:#fff}
button{background:#22c55e;color:#000;font-weight:700;cursor:pointer}
.hidden{display:none}
</style>
</head>
<body>

<div class="box" id="authBox">
  <h2>ğŸ” ÄÄƒng nháº­p / ÄÄƒng kÃ½</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Máº­t kháº©u">
  <button onclick="register()">ÄÄƒng kÃ½</button>
  <button onclick="login()">ÄÄƒng nháº­p</button>
  <p id="msg"></p>
</div>

<div class="box hidden" id="appBox">
  <h2>ğŸ‘¤ Xin chÃ o</h2>
  <p>Email: <span id="userEmail"></span></p>
  <p>ğŸ’° VÃ­: <b><span id="wallet">0</span> Ä‘</b></p>
  <button onclick="logout()">ÄÄƒng xuáº¥t</button>

  <div id="adminBox" class="hidden">
    <hr>
    <h3>ğŸ›  ADMIN PANEL</h3>
    <p>Báº¡n lÃ  admin</p>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ğŸ”¥ DÃN FIREBASE CONFIG Cá»¦A Báº N VÃ€O ÄÃ‚Y */
const firebaseConfig = {
  apiKey: "AIzaSyBe1mlXDAnOWzqkMarFN5PKJmuM9YIKTs4",
  authDomain: "nott-9d55e.firebaseapp.com",
  projectId: "nott-9d55e",
  storageBucket: "nott-9d55e.firebasestorage.app",
  messagingSenderId: "1013326079626",
  appId: "1:1013326079626:web:1be873b3eb551b2d87af73",
  measurementId: "G-RGJXCLEY7L"
};
/* ====================================== */

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ELEMENTS
const emailEl = document.getElementById("email");
const passEl = document.getElementById("password");
const msg = document.getElementById("msg");
const authBox = document.getElementById("authBox");
const appBox = document.getElementById("appBox");
const userEmail = document.getElementById("userEmail");
const walletEl = document.getElementById("wallet");
const adminBox = document.getElementById("adminBox");

// AUTH
window.register = async () => {
  try{
    const email = emailEl.value.trim();
    const pass = passEl.value.trim();
    const res = await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",res.user.uid),{
      email,
      wallet:0,
      role:"user",
      created:Date.now()
    });
    msg.innerText="âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng";
  }catch(e){
    msg.innerText=e.message;
  }
};

window.login = async () => {
  try{
    await signInWithEmailAndPassword(auth,emailEl.value,passEl.value);
  }catch(e){
    msg.innerText=e.message;
  }
};

window.logout = async () => {
  await signOut(auth);
};

// STATE
onAuthStateChanged(auth,async(user)=>{
  if(!user){
    authBox.classList.remove("hidden");
    appBox.classList.add("hidden");
    return;
  }
  authBox.classList.add("hidden");
  appBox.classList.remove("hidden");
  userEmail.innerText=user.email;

  const ref = doc(db,"users",user.uid);
  onSnapshot(ref,(snap)=>{
    if(!snap.exists())return;
    const d=snap.data();
    walletEl.innerText=d.wallet;
    if(d.role==="admin") adminBox.classList.remove("hidden");
  });
});
</script>

</body>
</html>
