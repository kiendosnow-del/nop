<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” Há»‡ Thá»‘ng CÃ y ThuÃª</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',sans-serif;background:#f1f5f9;margin:0;padding-bottom:80px;color:#334155}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;color:#fff;transition:0.2s}
        button:hover{opacity:0.8; transform: translateY(-1px)}
        button.red{background:#ef4444} button.green{background:#22c55e} button.purple{background:#a855f7} button.gray{background:#64748b}
        input,select{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #e2e8f0;box-sizing:border-box}
        .badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
        .bg-wait{background:#fef3c7;color:#d97706} .bg-process{background:#f3e8ff;color:#7c3aed} .bg-done{background:#dcfce7;color:#16a34a}
        
        .tab-container { display: flex; gap: 8px; padding: 0 12px; margin-top: 10px; }
        .tab-btn {
            background: #fff;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 12px 5px;
            flex: 1; 
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
            font-size: 13px;
        }
        .tab-btn.active{background:#38bdf8;color:#fff;border-color:#38bdf8}
        
        #modalOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,0.6);display:none;z-index:1000;backdrop-filter:blur(3px)}
        .modal{background:#fff;width:90%;max-width:450px;margin:50px auto;border-radius:16px;padding:20px;position:relative}
        .detail-box { background: #f8fafc; border-left: 4px solid #38bdf8; padding: 10px; margin: 10px 0; font-size: 13px; display: none; white-space: pre-line; }
    </style>
</head>
<body>

<div class="box" style="display:flex; justify-content:space-between; align-items:center; background:linear-gradient(to right, #fff, #f0f9ff)">
    <div>
        <div style="font-size:12px; color:#64748b">ChÃ o, <b id="uName">KhÃ¡ch</b></div>
        <div style="font-size:18px; font-weight:bold; color:#16a34a">ğŸ’° <span id="uBalance">0</span> Ä‘</div>
    </div>
    <div id="authButtons"><button onclick="showLogin()">ğŸ”‘ ÄÄƒng nháº­p</button></div>
    <div id="userButtons" style="display:none"><button onclick="logout()" class="red">ThoÃ¡t</button></div>
</div>

<div class="tab-container">
    <button class="tab-btn active" onclick="showMainTab('caythue', this)">ğŸ® CÃ y ThuÃª</button>
    <button class="tab-btn" onclick="showMainTab('doncay', this)">ğŸ“œ ÄÆ¡n CÃ y</button>
    <button id="adminTabBtn" class="tab-btn" style="display:none; color:#ef4444" onclick="showMainTab('admin', this)">ğŸ›  QUáº¢N TRá»Š</button>
</div>

<div id="tabCayThue" class="main-tab">
    <div class="box">
        <h3>ğŸ›’ Dá»‹ch vá»¥ Blox Fruit</h3>
        <select id="goi" onchange="updateServiceDetail()">
            <option value="">-- Chá»n gÃ³i dá»‹ch vá»¥ --</option>
            <optgroup label="ğŸ”° LEVEL">
                <option value="Level 700|20000" data-detail="âœ” Farm quest nhanh&#10;âœ” KhÃ´ng Ä‘á»•i trÃ¡i&#10;âœ” 3â€“5 giá»">Level 700 â€“ 20.000Ä‘</option>
                <option value="700 â†’ 1500|20000" data-detail="âœ” Farm boss + quest&#10;âœ” KhÃ´ng máº¥t Ä‘á»“&#10;âœ” 1â€“2 ngÃ y">700 â†’ 1500 â€“ 20.000Ä‘</option>
                <option value="1500 â†’ 2800|20000" data-detail="âœ” Farm full Sea 3&#10;âœ” An toÃ n 100%&#10;âœ” 2â€“3 ngÃ y">1500 â†’ 2800 â€“ 20.000Ä‘</option>
                <option value="0 â†’ MAX|50000" data-detail="âœ” Full Sea 1â€“2â€“3&#10;âœ” KhÃ´ng máº¥t acc&#10;âœ” 4â€“6 ngÃ y">0 â†’ MAX â€“ 50.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’ ITEM">
                <option value="Má» Neo|20000" data-detail="âœ” Full quest&#10;âœ” KhÃ´ng máº¥t Ä‘á»“&#10;âœ” 1 ngÃ y">Má» Neo â€“ 20.000Ä‘</option>
                <option value="Tushita|15000" data-detail="âœ” Full quest&#10;âœ” An toÃ n&#10;âœ” Trong ngÃ y">Tushita â€“ 15.000Ä‘</option>
                <option value="Yama|30000" data-detail="âœ” Full Yama&#10;âœ” KhÃ´ng máº¥t Ä‘á»“&#10;âœ” 1â€“2 ngÃ y">Yama â€“ 30.000Ä‘</option>
                <option value="Tam Kiáº¿m Full|35000" data-detail="âœ” Full 3 kiáº¿m&#10;âœ” KhÃ´ng rollback&#10;âœ” 2â€“3 ngÃ y">Tam Kiáº¿m Full â€“ 35.000Ä‘</option>
                <option value="CDK|30000" data-detail="âœ” Full CDK&#10;âœ” KhÃ´ng máº¥t item&#10;âœ” 1â€“2 ngÃ y">CDK â€“ 30.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’  V4">
                <option value="Full Gear V4|30000" data-detail="âœ” Full Gear&#10;âœ” Thá»©c tá»‰nh V4&#10;âœ” 1â€“2 ngÃ y">Full Gear V4 â€“ 30.000Ä‘</option>
                <option value="1 Gear V4|5000" data-detail="âœ” 1 Gear báº¥t ká»³&#10;âœ” Nhanh gá»n&#10;âœ” Trong ngÃ y">1 Gear V4 â€“ 5.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ¥‹ MELEE">
                <option value="Godhuman|20000" data-detail="âœ” Full Godhuman&#10;âœ” Farm nguyÃªn liá»‡u&#10;âœ” 1 ngÃ y">Godhuman â€“ 20.000Ä‘</option>
                <option value="Melee V2|15000" data-detail="âœ” Melee V2&#10;âœ” Nhanh&#10;âœ” Trong ngÃ y">Melee V2 â€“ 15.000Ä‘</option>
            </optgroup>
        </select>

        <div id="serviceDetail" class="detail-box"></div>

        <input id="accRoblox" placeholder="TÃ i khoáº£n (Username/Email)">
        <input id="passRoblox" type="password" placeholder="Máº­t kháº©u">
        
        <button class="green" style="width:100%" onclick="handleBuyService()">XÃC NHáº¬N THANH TOÃN</button>
        <button class="purple" style="width:100%" onclick="showNapBank()">ğŸ’³ Náº P TIá»€N QUA BANK</button>
    </div>
</div>

<div id="tabDoncay" class="main-tab" style="display:none">
    <div class="box">
        <h3>ğŸ“œ ÄÆ¡n cÃ y cá»§a báº¡n</h3>
        <div id="historyService"></div>
    </div>
</div>

<div id="tabAdmin" class="main-tab" style="display:none">
    <div class="box" style="border: 2px solid #ef4444;">
        <h3 style="color:#ef4444; margin: 0 0 15px 0; text-align: center;">ğŸ›  QUáº¢N TRá»Š VIÃŠN</h3>
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button class="gray" style="flex:1; font-size:12px; padding:10px 2px" onclick="showAdminTab('orders')">Táº¥t Cáº£ ÄÆ¡n</button>
            <button class="gray" style="flex:1; font-size:12px; padding:10px 2px" onclick="showAdminTab('naps')">Duyá»‡t Náº¡p</button>
            <button class="gray" style="flex:1; font-size:12px; padding:10px 2px" onclick="showAdminTab('gift')">Cáº¥p Tiá»n</button>
        </div>
        
        <div id="admOrders" class="adm-tab">
            <div id="adminOrderList"></div>
        </div>
        <div id="admNaps" class="adm-tab" style="display:none">
            <div id="adminNapList"></div>
        </div>
        <div id="admGift" class="adm-tab" style="display:none">
            <input id="adTargetUser" placeholder="TÃªn khÃ¡ch hÃ ng">
            <input id="adAmount" type="number" placeholder="Sá»‘ tiá»n cá»™ng">
            <button class="green" style="width:100%" onclick="adminGiftMoney()">XÃC NHáº¬N Cá»˜NG TIá»€N</button>
        </div>
    </div>
</div>

<div id="modalOverlay"><div class="modal" id="modalContent"></div></div>

<script>
const ADMIN_CONFIG = { user: "admin", pass: "admin123" };
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465766081548390534/iClDUAzau9xqGY3PFZTS6CT24uspMk8w5gLBvKyVyhjcxvuf-SD07-y9f9pC8Vax5lHE";

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');

function save() {
    localStorage.setItem('snow_users', JSON.stringify(db_users));
    localStorage.setItem('snow_orders', JSON.stringify(db_orders));
    localStorage.setItem('snow_naps', JSON.stringify(db_naps));
}

function render() {
    if(!cur) {
        document.getElementById('uName').innerText = "KhÃ¡ch";
        document.getElementById('uBalance').innerText = "0";
        document.getElementById('authButtons').style.display = "block";
        document.getElementById('userButtons').style.display = "none";
        document.getElementById('adminTabBtn').style.display = "none";
        document.getElementById('historyService').innerHTML = "Vui lÃ²ng Ä‘Äƒng nháº­p.";
    } else {
        cur = db_users[cur.username];
        document.getElementById('uName').innerText = cur.username;
        document.getElementById('uBalance').innerText = cur.balance.toLocaleString();
        document.getElementById('authButtons').style.display = "none";
        document.getElementById('userButtons').style.display = "block";
        document.getElementById('adminTabBtn').style.display = (cur.username === ADMIN_CONFIG.user) ? "block" : "none";
        
        // FIX: Chá»‰ lá»c Ä‘Æ¡n hÃ ng cá»§a Ä‘Ãºng ngÆ°á»i Ä‘ang Ä‘Äƒng nháº­p
        const myOrders = db_orders.filter(o => o.buyer === cur.username);
        document.getElementById('historyService').innerHTML = myOrders.length ? myOrders.slice().reverse().map(o => `
            <div style="border-bottom:1px solid #eee; padding:12px 0">
                <div style="display:flex; justify-content:space-between; align-items:center">
                    <b>${o.goi}</b>
                    <span class="badge ${getStatusClass(o.status)}">${o.status}</span>
                </div>
                <small style="color:#64748b">TÃ i khoáº£n: ${o.acc} | NgÃ y: ${o.time}</small>
            </div>
        `).join('') : "Báº¡n chÆ°a Ä‘áº·t Ä‘Æ¡n nÃ o.";
    }
    if(cur && cur.username === ADMIN_CONFIG.user) renderAdmin();
}

function getStatusClass(s){ 
    if(s === 'Xong') return 'bg-done';
    if(s === 'Äang cÃ y') return 'bg-process';
    return 'bg-wait'; 
}

async function sendToDiscord(title, fields, color) {
    const payload = { username: "SNOW SHOP", embeds: [{ title, color, fields }] };
    try { await fetch(DISCORD_WEBHOOK, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); } catch (e) {}
}

function handleBuyService() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    const g = document.getElementById('goi').value;
    if(!g) return alert("Chá»n gÃ³i dá»‹ch vá»¥!");
    const [name, price] = g.split('|');
    const acc = document.getElementById('accRoblox').value.trim();
    const pass = document.getElementById('passRoblox').value.trim();
    if(!acc || !pass) return alert("Nháº­p Ä‘á»§ thÃ´ng tin!");
    
    if(cur.balance < parseInt(price)) return alert("KhÃ´ng Ä‘á»§ tiá»n!");

    const newOrder = { buyer: cur.username, goi: name, acc, pass, status: "Chá» duyá»‡t", time: new Date().toLocaleString() };
    db_users[cur.username].balance -= parseInt(price);
    db_orders.push(newOrder);
    save(); render();
    
    sendToDiscord("ğŸš¨ ÄÆ N Má»šI", [{name: "KhÃ¡ch", value: cur.username}, {name: "GÃ³i", value: name}], 15105570);
    alert("Thanh toÃ¡n thÃ nh cÃ´ng!");
}

function showNapBank() {
    openModal(`<h3>ğŸ’³ Náº¡p tiá»n</h3><p>MB BANK: 1373727384<br>Ná»™i dung: NAP ${cur.username}</p>
        <input id="na" type="number" placeholder="Sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn">
        <button class="green" style="width:100%" onclick="confirmNap()">Gá»¬I YÃŠU Cáº¦U</button>`);
}

function confirmNap() {
    const amt = parseInt(document.getElementById('na').value);
    if(!amt) return;
    db_naps.push({username:cur.username, amount:amt, status:'Chá» duyá»‡t'});
    save(); closeModal(); render();
    sendToDiscord("ğŸ’° Náº P TIá»€N", [{name: "KhÃ¡ch", value: cur.username}, {name: "Tiá»n", value: amt.toLocaleString()}], 3066993);
    alert('ÄÃ£ gá»­i yÃªu cáº§u!');
}

function renderAdmin() {
    document.getElementById('adminOrderList').innerHTML = db_orders.map((o, i) => `
        <div class="box" style="font-size:12px; border-left:4px solid #38bdf8">
            <b>${o.buyer}</b>: ${o.goi} [${o.status}]<br>
            TK: ${o.acc} | MK: ${o.pass}<br>
            <button onclick="updateStatus(${i}, 'Äang cÃ y')" class="purple" style="font-size:10px">CÃ y</button>
            <button onclick="updateStatus(${i}, 'Xong')" class="green" style="font-size:10px">Xong</button>
            <button onclick="deleteOrder(${i})" class="red" style="font-size:10px">XoÃ¡</button>
        </div>
    `).reverse().join('');

    document.getElementById('adminNapList').innerHTML = db_naps.map((n, i) => `
        <div class="box">
            <b>${n.username}</b> náº¡p ${n.amount.toLocaleString()}Ä‘<br>
            ${n.status === 'Chá» duyá»‡t' ? `<button onclick="approveNap(${i})" class="green">Duyá»‡t</button>` : 'ÄÃ£ duyá»‡t'}
        </div>
    `).reverse().join('');
}

function updateStatus(i, s) { db_orders[i].status = s; save(); render(); }
function deleteOrder(i) { if(confirm("XoÃ¡?")) { db_orders.splice(i,1); save(); render(); } }
function approveNap(i) {
    const n = db_naps[i];
    if(db_users[n.username]) {
        db_users[n.username].balance += n.amount;
        db_naps[i].status = "Xong";
        save(); render();
    }
}
function adminGiftMoney() {
    const u = document.getElementById('adTargetUser').value.trim();
    const a = parseInt(document.getElementById('adAmount').value);
    if(db_users[u]) { db_users[u].balance += a; save(); render(); alert("Xong!"); }
}

function showMainTab(id, btn) {
    document.querySelectorAll('.main-tab').forEach(t => t.style.display = 'none');
    document.getElementById('tab' + id.charAt(0).toUpperCase() + id.slice(1)).style.display = 'block';
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function showAdminTab(id) {
    document.querySelectorAll('.adm-tab').forEach(t => t.style.display = 'none');
    document.getElementById('adm' + id.charAt(0).toUpperCase() + id.slice(1)).style.display = 'block';
}

function updateServiceDetail() {
    const select = document.getElementById('goi');
    const option = select.options[select.selectedIndex];
    const detailBox = document.getElementById('serviceDetail');
    if (option.value) {
        detailBox.innerHTML = option.getAttribute('data-detail');
        detailBox.style.display = 'block';
    } else { detailBox.style.display = 'none'; }
}

function showLogin() { openModal(`<h3>ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3><input id="au" placeholder="TÃªn Ä‘Äƒng nháº­p"><input id="ap" type="password" placeholder="Máº­t kháº©u"><button class="green" style="width:100%" onclick="handleAuth()">VÃ€O Cá»¬A HÃ€NG</button>`); }
function handleAuth() {
    const u = document.getElementById('au').value.trim(), p = document.getElementById('ap').value;
    if(!u || !p) return;
    if(!db_users[u]) db_users[u] = { username: u, password: p, balance: 0 };
    else if(db_users[u].password !== p) return alert("Sai máº­t kháº©u!");
    cur = db_users[u]; localStorage.setItem('snow_session', u); save(); closeModal(); render();
}
function logout() { localStorage.removeItem('snow_session'); location.reload(); }
function openModal(h) { document.getElementById('modalContent').innerHTML = h + `<button class="red" style="width:100%" onclick="closeModal()">ÄÃ³ng</button>`; document.getElementById('modalOverlay').style.display = "block"; }
function closeModal() { document.getElementById('modalOverlay').style.display = "none"; }

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session && db_users[session]) cur = db_users[session];
    render();
};
</script>
</body>
</html>
