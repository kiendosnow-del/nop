<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” Quáº£n Trá»‹ Há»‡ Thá»‘ng</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',Tahoma,sans-serif;background:#f1f5f9;margin:0;padding-bottom:50px}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;transition:0.18s;color:#fff}
        button:hover{opacity:0.9}
        button.red{background:#ef4444}
        button.green{background:#22c55e}
        button.purple{background:#a855f7}
        input,select,textarea{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
        .info{background:#f8fafc;border:1px dashed #38bdf8;border-radius:10px;padding:10px;margin-top:10px;line-height:1.5}
        .badge{padding:3px 8px;border-radius:6px;font-size:11px;font-weight:bold}
        .bg-wait{background:#fef3c7;color:#d97706}
        .bg-done{background:#dcfce7;color:#16a34a}
        .tab-btn{background:none;color:#64748b;border:1px solid #e2e8f0;margin-right:5px}
        .tab-btn.active{background:#38bdf8;color:#fff;border-color:#38bdf8}
        #modalOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:1000}
        .modal{background:#fff;width:90%;max-width:400px;margin:100px auto;border-radius:15px;padding:20px;position:relative}
    </style>
</head>
<body>

<div class="box" style="display:flex; justify-content:space-between; align-items:center">
    <div>
        <div style="font-size:12px; color:#64748b">TÃ i khoáº£n: <b id="uName" style="color:#0f172a">KhÃ¡ch</b></div>
        <div style="font-size:18px; font-weight:bold; color:#22c55e">ğŸ’° <span id="uBalance">0</span> Ä‘</div>
    </div>
    <div id="authButtons">
        <button onclick="showLogin()" style="padding:6px 12px">ğŸ”‘ VÃ o Shop</button>
    </div>
    <div id="userButtons" style="display:none">
        <button onclick="logout()" class="red" style="padding:6px 12px">ThoÃ¡t</button>
    </div>
</div>

<div id="clientView">
    <div class="box">
        <h3 style="margin:0 0 10px 0">ğŸ›’ Dá»‹ch vá»¥ CÃ y ThuÃª</h3>
        <select id="goi">
            <option value="">-- Chá»n gÃ³i cÃ y --</option>
            <option value="Level 700|20000">GÃ³i Sea 1 (Level 700) - 20,000Ä‘</option>
            <option value="Level 1500|40000">GÃ³i Sea 2 (Level 1500) - 40,000Ä‘</option>
            <option value="Max Level|60000">GÃ³i Max Level 2550+ - 60,000Ä‘</option>
        </select>
        <input id="accRoblox" placeholder="TÃªn Ä‘Äƒng nháº­p Roblox">
        <input id="passRoblox" type="password" placeholder="Máº­t kháº©u Roblox">
        <button class="green" style="width:100%" onclick="handleBuy()">XÃC NHáº¬N MUA NGAY</button>
        <button class="purple" style="width:100%" onclick="showNapBank()">ğŸ’³ Náº P TIá»€N QUA NGÃ‚N HÃ€NG</button>
    </div>

    <div class="box">
        <h3 style="margin:0 0 10px 0">ğŸ“œ Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng</h3>
        <div id="historyList">Vui lÃ²ng Ä‘Äƒng nháº­p...</div>
    </div>
</div>

<div id="adminView" style="display:none">
    <div class="box" style="border: 2px solid #ef4444">
        <h2 style="color:#ef4444; margin-top:0">ğŸ›  Báº¢NG QUáº¢N TRá»Š</h2>
        <div style="display:flex; margin-bottom:15px">
            <button class="tab-btn active" onclick="showTab('orders', this)">ÄÆ¡n cÃ y</button>
            <button class="tab-btn" onclick="showTab('naps', this)">Duyá»‡t Náº¡p</button>
            <button class="tab-btn" onclick="showTab('users', this)">ThÃ nh viÃªn</button>
        </div>

        <div id="tabOrders" class="tab-content">
            <div id="adminOrderList"></div>
        </div>

        <div id="tabNaps" class="tab-content" style="display:none">
            <div id="adminNapList"></div>
        </div>

        <div id="tabUsers" class="tab-content" style="display:none">
            <h4>Cá»™ng tiá»n cho khÃ¡ch</h4>
            <input id="adTargetUser" placeholder="Nháº­p username khÃ¡ch">
            <input id="adAmount" type="number" placeholder="Sá»‘ tiá»n cáº§n cá»™ng">
            <button class="green" onclick="adminAddMoney()">XÃC NHáº¬N Cá»˜NG</button>
        </div>
    </div>
</div>

<div id="modalOverlay">
    <div class="modal" id="modalContent"></div>
</div>

<script>
/* ----- CONFIG & DATABASE ----- */
const ADMIN_ACC = "snowsimo";
const ADMIN_PASS = "SimohaysiSnow";
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm"; // Thay Link Webhook vÃ o Ä‘Ã¢y

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');

const el = {
    uName: document.getElementById('uName'),
    uBalance: document.getElementById('uBalance'),
    authBtns: document.getElementById('authButtons'),
    userBtns: document.getElementById('userButtons'),
    history: document.getElementById('historyList'),
    modal: document.getElementById('modalOverlay'),
    modalIn: document.getElementById('modalContent'),
    adminView: document.getElementById('adminView'),
};

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session && db_users[session]) {
        cur = db_users[session];
    }
    render();
};

/* ----- CORE FUNCTIONS ----- */
function render() {
    if(!cur) {
        el.uName.innerText = "KhÃ¡ch";
        el.uBalance.innerText = "0";
        el.authBtns.style.display = "block";
        el.userBtns.style.display = "none";
        el.adminView.style.display = "none";
        el.history.innerHTML = "Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ xem.";
    } else {
        el.uName.innerText = cur.username;
        el.uBalance.innerText = cur.balance.toLocaleString();
        el.authBtns.style.display = "none";
        el.userBtns.style.display = "block";
        
        // Hiá»‡n Admin View náº¿u lÃ  admin
        el.adminView.style.display = (cur.username === ADMIN_ACC) ? "block" : "none";

        // Render Lá»‹ch sá»­ khÃ¡ch
        const myOrders = db_orders.filter(o => o.buyer === cur.username);
        el.history.innerHTML = myOrders.length ? myOrders.map(o => `
            <div style="border-bottom:1px solid #eee; padding:8px 0">
                <b>${o.goi}</b> <span class="badge ${o.status==='Xong'?'bg-done':'bg-wait'}">${o.status}</span><br>
                <small>${o.time}</small>
            </div>
        `).reverse().join('') : "ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o.";

        if(cur.username === ADMIN_ACC) renderAdmin();
    }
}

function renderAdmin() {
    // Admin ÄÆ¡n cÃ y
    document.getElementById('adminOrderList').innerHTML = db_orders.map((o, i) => `
        <div class="box" style="background:#f9fafb; font-size:13px">
            <b>KhÃ¡ch: ${o.buyer}</b> | GÃ³i: ${o.goi}<br>
            TK: <code>${o.acc}</code> | MK: <code>${o.pass}</code><br>
            Tráº¡ng thÃ¡i: <b class="${o.status==='Xong'?'bg-done':'bg-wait'}">${o.status}</b><br>
            <button onclick="changeStatus(${i}, 'Äang cÃ y')" class="purple" style="font-size:10px">Äang cÃ y</button>
            <button onclick="changeStatus(${i}, 'Xong')" class="green" style="font-size:10px">Xong</button>
            <button onclick="deleteOrder(${i})" class="red" style="font-size:10px">XoÃ¡ Ä‘Æ¡n</button>
        </div>
    `).reverse().join('');

    // Admin Duyá»‡t Náº¡p
    document.getElementById('adminNapList').innerHTML = db_naps.map((n, i) => `
        <div class="box" style="background:#f9fafb; font-size:13px">
            <b>KhÃ¡ch: ${n.username}</b> | Sá»‘ tiá»n: ${n.amount.toLocaleString()}Ä‘<br>
            Tráº¡ng thÃ¡i: ${n.status}<br>
            ${n.status === 'Chá» duyá»‡t' ? `<button onclick="approveNap(${i})" class="green">Duyá»‡t náº¡p tiá»n</button>` : ''}
            <button onclick="deleteNap(${i})" class="red">XoÃ¡</button>
        </div>
    `).reverse().join('');
}

/* ----- LOGIC MUA HÃ€NG & Náº P ----- */
function handleBuy() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    const gÃ³iVal = document.getElementById('goi').value;
    const acc = document.getElementById('accRoblox').value.trim();
    const pass = document.getElementById('passRoblox').value.trim();

    if(!gÃ³iVal || !acc || !pass) return alert("Vui lÃ²ng nháº­p Ä‘á»§ thÃ´ng tin!");
    
    const [tenGoi, giÃ¡] = gÃ³iVal.split('|');
    if(cur.balance < giÃ¡) return alert("Báº¡n khÃ´ng Ä‘á»§ tiá»n!");

    // Trá»« tiá»n
    cur.balance -= parseInt(giÃ¡);
    db_users[cur.username] = cur;
    
    // LÆ°u Ä‘Æ¡n
    const newOrder = {
        buyer: cur.username,
        goi: tenGoi,
        acc: acc,
        pass: pass,
        status: "Äang chá»",
        time: new Date().toLocaleString()
    };
    db_orders.push(newOrder);
    
    saveAll();
    render();
    alert("Mua thÃ nh cÃ´ng! ÄÆ¡n Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n Admin.");
    sendDiscord(`ğŸ›’ **ÄÆ N Má»šI:**\nKhÃ¡ch: ${cur.username}\nGÃ³i: ${tenGoi}\nAcc: ${acc}\nPass: ${pass}`);
}

function showNapBank() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n NgÃ¢n hÃ ng</h3>
        <div class="info">
            STK: <b>00000000000</b><br>
            NgÃ¢n hÃ ng: <b>MB BANK</b><br>
            Chá»§ TK: <b>NGUYEN VAN A</b><br>
            Ná»™i dung: <b style="color:red; font-size:18px">NAP ${cur.username}</b>
        </div>
        <p style="font-size:12px">Sau khi chuyá»ƒn khoáº£n, hÃ£y nháº­p sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn vÃ o dÆ°á»›i Ä‘Ã¢y:</p>
        <input id="napAmt" type="number" placeholder="Nháº­p sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn">
        <button class="green" style="width:100%" onclick="submitNap()">XÃC NHáº¬N ÄÃƒ CHUYá»‚N</button>
        <button class="red" style="width:100%" onclick="closeModal()">ÄÃ³ng</button>
    `);
}

function submitNap() {
    const amt = parseInt(document.getElementById('napAmt').value);
    if(!amt || amt < 1000) return alert("Sá»‘ tiá»n khÃ´ng há»£p lá»‡!");

    db_naps.push({
        username: cur.username,
        amount: amt,
        status: "Chá» duyá»‡t",
        time: new Date().toLocaleString()
    });
    saveAll();
    closeModal();
    alert("YÃªu cáº§u Ä‘Ã£ gá»­i! Vui lÃ²ng chá» Admin duyá»‡t tiá»n.");
    sendDiscord(`ğŸ’° **YÃŠU Cáº¦U Náº P:**\nKhÃ¡ch: ${cur.username}\nSá»‘ tiá»n: ${amt.toLocaleString()}Ä‘\nNá»™i dung: NAP ${cur.username}`);
}

/* ----- ADMIN ACTIONS ----- */
function changeStatus(index, status) {
    db_orders[index].status = status;
    saveAll();
    render();
}

function deleteOrder(index) {
    if(confirm("XoÃ¡ Ä‘Æ¡n nÃ y?")) {
        db_orders.splice(index, 1);
        saveAll();
        render();
    }
}

function approveNap(index) {
    const req = db_naps[index];
    if(db_users[req.username]) {
        db_users[req.username].balance += req.amount;
        db_naps[index].status = "ÄÃ£ duyá»‡t";
        saveAll();
        render();
        alert("ÄÃ£ duyá»‡t tiá»n cho khÃ¡ch!");
    }
}

function adminAddMoney() {
    const target = document.getElementById('adTargetUser').value;
    const amt = parseInt(document.getElementById('adAmount').value);
    if(db_users[target]) {
        db_users[target].balance += amt;
        saveAll();
        render();
        alert("ThÃ nh cÃ´ng!");
    } else alert("KhÃ´ng tÃ¬m tháº¥y khÃ¡ch nÃ y!");
}

/* ----- HELPERS ----- */
function saveAll() {
    localStorage.setItem('snow_users', JSON.stringify(db_users));
    localStorage.setItem('snow_orders', JSON.stringify(db_orders));
    localStorage.setItem('snow_naps', JSON.stringify(db_naps));
}

function sendDiscord(msg) {
    if(!DISCORD_WEBHOOK.includes("http")) return;
    fetch(DISCORD_WEBHOOK, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ content: msg })
    });
}

function showLogin() {
    openModal(`
        <h3>ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3>
        <input id="au" placeholder="Username">
        <input id="ap" type="password" placeholder="Password">
        <button class="blue" style="width:100%" onclick="handleAuth()">VÃ€O Cá»¬A HÃ€NG</button>
        <button class="red" style="width:100%" onclick="closeModal()">Há»§y</button>
    `);
}

function handleAuth() {
    const u = document.getElementById('au').value.trim();
    const p = document.getElementById('ap').value;
    if(!u || !p) return;

    if(!db_users[u]) {
        db_users[u] = { username: u, password: p, balance: 0 };
        alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
    } else {
        if(db_users[u].password !== p) return alert("Sai máº­t kháº©u!");
    }
    cur = db_users[u];
    localStorage.setItem('snow_session', u);
    saveAll();
    closeModal();
    render();
}

function logout() {
    localStorage.removeItem('snow_session');
    cur = null;
    location.reload();
}

function openModal(html) {
    el.modalIn.innerHTML = html;
    el.modal.style.display = "block";
}
function closeModal() { el.modal.style.display = "none"; }
function showTab(tab, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.style.display = "none");
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).style.display = "block";
    btn.classList.add('active');
}
</script>
</body>
</html>
