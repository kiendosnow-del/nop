<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>â„ï¸ SNOW SHOP | CÃ y ThuÃª Blox Fruits</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root{
  --bg:#0b1220;--card:#111827;--main:#38bdf8;--vip:#facc15;
  --text:#e5e7eb;--muted:#9ca3af;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter, Arial, sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
header{padding:18px;text-align:center;background:linear-gradient(135deg,#0284c7,#2563eb)}
header h1{margin:0;font-size:20px}
header .sub{margin-top:6px;font-size:13px;color:var(--muted)}
nav{display:flex;flex-wrap:wrap;justify-content:space-around;background:#020617;padding:10px;gap:6px}
nav button{background:none;border:none;color:#fff;font-weight:700;padding:8px 10px;border-radius:8px;cursor:pointer}
nav button.active{background:rgba(255,255,255,0.04)}
.container{max-width:720px;margin:18px auto;padding:12px}
.card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 6px 18px rgba(3,7,18,0.6)}
h3{color:var(--main);margin:0 0 10px 0}
input,select,textarea,button{
  width:100%;padding:10px;margin:6px 0;border-radius:10px;border:none;outline:none;box-sizing:border-box}
input,select,textarea{background:#020617;color:#fff}
button{background:var(--main);font-weight:700;cursor:pointer;color:#04263b}
.small{font-size:13px;color:var(--muted)}
.hidden{display:none}
.vip{background:linear-gradient(135deg,#facc15,#eab308);color:#000}
.log{font-size:13px;border-bottom:1px dashed #334155;padding:8px 0;display:flex;justify-content:space-between}
.pending{background:#020617;padding:8px;border-radius:10px;margin-bottom:8px}
.row{display:flex;gap:8px}
.col{flex:1}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
.table th,.table td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.04)}
.badge{padding:6px 8px;border-radius:8px;font-weight:700}
.status-new{background:#0ea5a4;color:#00171a}
.status-done{background:#38bdf8;color:#04263b}
.footer-note{font-size:12px;color:var(--muted);margin-top:8px}
@media (max-width:520px){
  nav{justify-content:space-between}
  .row{flex-direction:column}
}
</style>
</head>
<body>

<header>
  <h1>â„ï¸ SNOW SHOP</h1>
  <div class="sub">ğŸ‘¤ <b id="userLabel">ChÆ°a Ä‘Äƒng nháº­p</b> â€” ğŸ’° VÃ­: <b id="sodu">0</b>Ä‘</div>
</header>

<nav id="mainNav">
  <button data-tab="account" class="active">ğŸ‘¤ TÃ i khoáº£n</button>
  <button data-tab="shop">ğŸ›’ ThuÃª cÃ y</button>
  <button data-tab="nap">ğŸ’³ Náº¡p</button>
  <button data-tab="gift">ğŸ Gift</button>
  <button data-tab="lichsu">ğŸ“œ Lá»‹ch sá»­</button>
  <button data-tab="admin">ğŸ” Admin</button>
</nav>

<div class="container">

  <!-- ACCOUNT -->
  <div id="account" class="card">
    <h3>ğŸ‘¤ TÃ€I KHOáº¢N</h3>

    <div id="authBox">
      <input id="acc_user" placeholder="TÃªn Ä‘Äƒng nháº­p (username)" autocomplete="username">
      <input id="acc_pass" type="password" placeholder="Máº­t kháº©u" autocomplete="new-password">
      <div class="row" style="margin-top:6px">
        <div class="col"><button id="btnLogin">ÄÄƒng nháº­p</button></div>
        <div class="col"><button id="btnRegister" class="vip">ÄÄƒng kÃ½</button></div>
      </div>
      <p class="small">TÃ i khoáº£n Ä‘Æ°á»£c lÆ°u cá»¥c bá»™ (localStorage) â€” chá»‰ dÃ nh cho demo. KhÃ´ng dÃ¹ng máº­t kháº©u quan trá»ng.</p>
    </div>

    <div id="logoutBox" class="hidden">
      <p>âœ… Xin chï¿½ï¿½o <b id="accName"></b></p>
      <div class="row">
        <div class="col"><button id="btnLogout">ÄÄƒng xuáº¥t</button></div>
        <div class="col"><button id="btnProfile">Xem há»“ sÆ¡</button></div>
      </div>
      <div id="profileBox" class="hidden small" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- SHOP -->
  <div id="shop" class="card hidden">
    <h3>ğŸ›’ THUÃŠ CÃ€Y BLOX FRUITS</h3>

    <input id="ten" placeholder="TÃªn Roblox / Discord (vÃ­ dá»¥: abc123)">
    <input id="login" placeholder="Login Roblox (email hoáº·c login token náº¿u cÃ³)">

    <select id="goi">
      <option value="">-- Chá»n gÃ³i cÃ y thuÃª --</option>

      <optgroup label="ğŸ”° LEVEL">
        <option value="Level 700|20000" data-info="Farm nhanh lÃªn level 700" data-detail="âœ” Farm quest nhanh\nâœ” KhÃ´ng Ä‘á»•i trÃ¡i\nâœ” 3â€“5 giá»">Level 700 â€“ 20.000Ä‘</option>
        <option value="700 â†’ 1500|20000" data-info="Farm tá»« Sea 2" data-detail="âœ” Farm boss + quest\nâœ” KhÃ´ng máº¥t Ä‘á»“\nâœ” 1â€“2 ngÃ y">700 â†’ 1500 â€“ 20.000Ä‘</option>
        <option value="1500 â†’ 2800|20000" data-info="Farm Sea 3" data-detail="âœ” Farm full Sea 3\nâœ” An toÃ n 100%\nâœ” 2â€“3 ngÃ y">1500 â†’ 2800 â€“ 20.000Ä‘</option>
        <option value="0 â†’ MAX|50000" data-info="CÃ y tá»« Ä‘áº§u tá»›i max" data-detail="âœ” Full Sea 1â€“2â€“3\nâœ” KhÃ´ng máº¥t acc\nâœ” 4â€“6 ngÃ y">0 â†’ MAX â€“ 50.000Ä‘</option>
      </optgroup>

      <optgroup label="ğŸ’ ITEM">
        <option value="Má» Neo|20000" data-info="LÃ m Má» Neo" data-detail="âœ” Full quest\nâœ” KhÃ´ng máº¥t Ä‘á»“\nâœ” 1 ngÃ y">Má» Neo â€“ 20.000Ä‘</option>
        <option value="Tushita|15000" data-info="Kiáº¿m Tushita" data-detail="âœ” Full quest\nâœ” An toÃ n\nâœ” Trong ngÃ y">Tushita â€“ 15.000Ä‘</option>
        <option value="Yama|30000" data-info="Kiáº¿m Yama" data-detail="âœ” Full Yama\nâœ” KhÃ´ng máº¥t Ä‘á»“\nâœ” 1â€“2 ngÃ y">Yama â€“ 30.000Ä‘</option>
        <option value="Tam Kiáº¿m Full|35000" data-info="True Triple Katana" data-detail="âœ” Full 3 kiáº¿m\nâœ” KhÃ´ng rollback\nâœ” 2â€“3 ngÃ y">Tam Kiáº¿m Full â€“ 35.000Ä‘</option>
        <option value="CDK|30000" data-info="Cursed Dual Katana" data-detail="âœ” Full CDK\nâœ” KhÃ´ng máº¥t item\nâœ” 1â€“2 ngÃ y">CDK â€“ 30.000Ä‘</option>
      </optgroup>

      <optgroup label="ğŸ’  V4">
        <option value="Full Gear V4|30000" data-info="Full Gear V4" data-detail="âœ” Full Gear\nâœ” Thá»©c tá»‰nh V4\nâœ” 1â€“2 ngÃ y">Full Gear V4 â€“ 30.000Ä‘</option>
        <option value="1 Gear V4|5000" data-info="Up 1 Gear" data-detail="âœ” 1 Gear báº¥t ká»³\nâœ” Nhanh gá»n\nâœ” Trong ngÃ y">1 Gear V4 â€“ 5.000Ä‘</option>
      </optgroup>

      <optgroup label="ğŸ¥‹ MELEE">
        <option value="Godhuman|20000" data-info="Melee Godhuman" data-detail="âœ” Full Godhuman\nâœ” Farm nguyÃªn liá»‡u\nâœ” 1 ngÃ y">Godhuman â€“ 20.000Ä‘</option>
        <option value="Melee V2|15000" data-info="Up Melee V2" data-detail="âœ” Melee V2\nâœ” Nhanh\nâœ” Trong ngÃ y">Melee V2 â€“ 15.000Ä‘</option>
      </optgroup>
    </select>

    <div id="goiInfo" class="small"></div>
    <div id="goiDetail" class="small" style="white-space:pre-line;background:#020617;padding:10px;border-radius:10px;display:none"></div>

    <textarea id="note" placeholder="Ghi chÃº thÃªm (vÃ­ dá»¥: thá»i gian ráº£nh, lÆ°u Ã½ Ä‘áº·c biá»‡t)" rows="3"></textarea>
    <div class="row">
      <div class="col"><button id="btnDatDon">ğŸš€ Äáº¶T ÄÆ N</button></div>
      <div class="col"><button id="btnPreview" class="vip">Xem trÆ°á»›c Ä‘Æ¡n</button></div>
    </div>
    <p class="footer-note">Sá»‘ dÆ° sáº½ tá»± Ä‘á»™ng trá»« khi Ä‘áº·t Ä‘Æ¡n thÃ nh cÃ´ng. Náº¿u webhook chÆ°a thiáº¿t láº­p, Ä‘Æ¡n váº«n lÆ°u vÃ o há»‡ thá»‘ng ná»™i bá»™.</p>
  </div>

  <!-- Náº P -->
  <div id="nap" class="card hidden">
    <h3>ğŸ’³ Náº P TIá»€N</h3>
    <input id="nap_amount" type="number" placeholder="Sá»‘ tiá»n náº¡p (Ä‘á»“ng)" min="1000" step="500">
    <div class="row">
      <div class="col"><button id="btnNap">Náº¡p (thÃªm vÃ o vÃ­)</button></div>
      <div class="col"><button id="btnFakePay" class="vip">MÃ´ phá»ng thanh toÃ¡n nhanh</button></div>
    </div>
    <p class="small">LÆ°u Ã½: ÄÃ¢y lÃ  cháº¿ Ä‘á»™ demo. TÃ­ch há»£p cá»•ng thanh toÃ¡n thá»±c táº¿ cáº§n backend.</p>
  </div>

  <!-- GIFT -->
  <div id="gift" class="card hidden">
    <h3>ğŸ MÃƒ GIFT / KHUYáº¾N MÃƒI</h3>
    <input id="gift_code" placeholder="Nháº­p mÃ£ gift (vd: SNOW1000)">
    <div class="row">
      <div class="col"><button id="btnRedeem">Äá»•i mÃ£</button></div>
      <div class="col"><button id="btnListCodes" class="vip">Xem mÃ£ máº«u</button></div>
    </div>
    <div id="giftResult" class="small" style="margin-top:8px"></div>
  </div>

  <!-- Lá»ŠCH Sá»¬ -->
  <div id="lichsu" class="card hidden">
    <h3>ğŸ“œ Lá»ŠCH Sá»¬ ÄÆ N HÃ€NG</h3>
    <div id="ordersList" class="small"></div>
  </div>

  <!-- ADMIN -->
  <div id="admin" class="card hidden">
    <h3>ğŸ” ADMIN</h3>
    <div id="adminAuth">
      <input id="admin_pass" type="password" placeholder="Máº­t kháº©u admin">
      <div class="row">
        <div class="col"><button id="btnAdminLogin">ÄÄƒng nháº­p admin</button></div>
        <div class="col"><button id="btnInitMock" class="vip">Khá»Ÿi táº¡o dá»¯ liá»‡u demo</button></div>
      </div>
    </div>

    <div id="adminPanel" class="hidden">
      <p class="small">Webhook hiá»‡n táº¡i: <b id="webhookLabel">DÃN_WEBHOOK_Cá»¦A_Báº N</b></p>
      <input id="webhookInput" placeholder="DÃ¡n Discord webhook URL á»Ÿ Ä‘Ã¢y">
      <div class="row">
        <div class="col"><button id="btnSaveWebhook">LÆ°u webhook</button></div>
        <div class="col"><button id="btnViewUsers" class="vip">Xem ngÆ°á»i dÃ¹ng</button></div>
      </div>

      <h4 style="margin-top:12px;color:var(--main)">Quáº£n lÃ½ Ä‘Æ¡n</h4>
      <div id="adminOrders" class="small"></div>
    </div>
  </div>

</div>

<script>
/*
  SNOW SHOP - Frontend (demo)
  - LÆ°u dá»¯ liá»‡u vÃ o localStorage: users, currentUser, orders, webhook
  - Gá»­i webhook tá»›i Discord náº¿u webhook Ä‘Æ°á»£c thiáº¿t láº­p (fetch POST)
  - Äáº£m báº£o xá»­ lÃ½ lá»—i, xÃ¡c thá»±c, vÃ  UI mÆ°á»£t mÃ 
*/

/* ========== Utility ========== */
const $ = (id)=>document.getElementById(id);
const formatMoney = (n)=> (Number(n)||0).toLocaleString('vi-VN') + 'Ä‘';
const now = ()=> new Date().toISOString();

/* ========== Local storage helpers ========== */
function loadJSON(key, fallback){
  try{ const v = localStorage.getItem(key); return v? JSON.parse(v): fallback; } catch(e){ return fallback; }
}
function saveJSON(key, data){ localStorage.setItem(key, JSON.stringify(data)); }

/* default stores */
if (!localStorage.getItem('sn_users')) saveJSON('sn_users', []);
if (!localStorage.getItem('sn_orders')) saveJSON('sn_orders', []);
if (!localStorage.getItem('sn_webhook')) localStorage.setItem('sn_webhook', 'DÃN_WEBHOOK_Cá»¦A_Báº N');

/* ========== Auth / Account logic ========== */
let currentUser = loadJSON('sn_currentUser', null);

function refreshHeader(){
  const u = currentUser;
  $('userLabel').textContent = u ? u.username : 'ChÆ°a Ä‘Äƒng nháº­p';
  $('sodu').textContent = u ? formatMoney(u.balance) : formatMoney(0);
}

function showSection(id){
  document.querySelectorAll('.container > .card').forEach(c=>{
    if (c.id === id) c.classList.remove('hidden'); else c.classList.add('hidden');
  });
  document.querySelectorAll('nav button').forEach(btn=>{
    btn.classList.toggle('active', btn.dataset.tab === id);
  });
}

/* login/register/logout */
function registerAcc(){
  const user = $('acc_user').value.trim();
  const pass = $('acc_pass').value;
  if (!user || !pass){ alert('Nháº­p tÃªn Ä‘Äƒng nháº­p vÃ  máº­t kháº©u.'); return; }
  const users = loadJSON('sn_users', []);
  if (users.find(x=>x.username.toLowerCase()===user.toLowerCase())){ alert('TÃªn Ä‘Äƒng nháº­p Ä‘Ã£ tá»“n táº¡i.'); return; }
  const newUser = { id: Date.now(), username: user, password: pass, balance: 0, created_at: now() };
  users.push(newUser);
  saveJSON('sn_users', users);
  currentUser = { id: newUser.id, username: newUser.username, balance: newUser.balance };
  saveJSON('sn_currentUser', currentUser);
  updateUIAfterAuth();
  alert('ÄÄƒng kÃ½ thÃ nh cÃ´ng! Báº¡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng nháº­p tá»± Ä‘á»™ng.');
}

function loginAcc(){
  const user = $('acc_user').value.trim();
  const pass = $('acc_pass').value;
  if (!user || !pass){ alert('Nháº­p tÃªn Ä‘Äƒng nháº­p vÃ  máº­t kháº©u.'); return; }
  const users = loadJSON('sn_users', []);
  const found = users.find(x=>x.username.toLowerCase()===user.toLowerCase() && x.password === pass);
  if (!found){ alert('TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng.'); return; }
  currentUser = { id: found.id, username: found.username, balance: found.balance };
  saveJSON('sn_currentUser', currentUser);
  updateUIAfterAuth();
  alert('ÄÄƒng nháº­p thÃ nh cÃ´ng!');
}

function logout(){
  currentUser = null;
  localStorage.removeItem('sn_currentUser');
  updateUIAfterAuth();
}

function updateUIAfterAuth(){
  if (currentUser){
    $('authBox').classList.add('hidden');
    $('logoutBox').classList.remove('hidden');
    $('accName').textContent = currentUser.username;
    $('profileBox').classList.add('hidden');
  } else {
    $('authBox').classList.remove('hidden');
    $('logoutBox').classList.add('hidden');
  }
  refreshHeader();
}

/* ========== Shop logic ========== */
const goiSelect = $('goi');
goiSelect.addEventListener('change', ()=>{
  const opt = goiSelect.selectedOptions[0];
  if (!opt || !opt.value){ $('goiInfo').textContent = ''; $('goiDetail').style.display='none'; return; }
  $('goiInfo').textContent = opt.dataset.info || '';
  $('goiDetail').style.display = 'block';
  $('goiDetail').textContent = opt.dataset.detail || '';
});

function parseGoiValue(val){
  // expecting "Name|price"
  const parts = val.split('|');
  return { name: parts[0] || '', price: Number(parts[1] || 0) };
}

function datDon(){
  if (!currentUser){ alert('Vui lÃ²ng Ä‘Äƒng nháº­p trÆ°á»›c khi Ä‘áº·t Ä‘Æ¡n.'); showSection('account'); return; }
  const ten = $('ten').value.trim();
  const login = $('login').value.trim();
  const goiVal = $('goi').value;
  if (!ten || !login || !goiVal){ alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ tÃªn, login vÃ  chá»n gÃ³i.'); return; }
  const { name, price } = parseGoiValue(goiVal);
  if (isNaN(price) || price <= 0){ alert('GÃ³i khÃ´ng há»£p lá»‡.'); return; }
  // check balance
  const users = loadJSON('sn_users', []);
  const idx = users.findIndex(u=>u.id === currentUser.id);
  if (idx === -1){ alert('NgÆ°á»i dÃ¹ng khÃ´ng tá»“n táº¡i. HÃ£y Ä‘Äƒng xuáº¥t vÃ  Ä‘Äƒng nháº­p láº¡i.'); logout(); return; }
  if (users[idx].balance < price){ alert('Sá»‘ dÆ° khÃ´ng Ä‘á»§. Vui lÃ²ng náº¡p thÃªm.'); showSection('nap'); return; }

  // Create order
  const order = {
    id: 'ORD' + Date.now(),
    userId: currentUser.id,
    username: currentUser.username,
    targetName: ten,
    login: login,
    package: name,
    price: price,
    note: $('note').value.trim(),
    status: 'new',
    created_at: now()
  };

  // Deduct balance
  users[idx].balance -= price;
  saveJSON('sn_users', users);
  // Update currentUser and header
  currentUser.balance = users[idx].balance;
  saveJSON('sn_currentUser', currentUser);
  refreshHeader();

  // Save order
  const orders = loadJSON('sn_orders', []);
  orders.unshift(order);
  saveJSON('sn_orders', orders);

  // Try to send webhook (non-blocking)
  sendDiscordWebhook(order).catch(err=>{
    // swallow error but log
    console.warn('Webhook send failed:', err);
  });

  alert('Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng! ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c lÆ°u.');
  renderOrders(); // update UI
  // reset form (but keep user data)
  $('ten').value = ''; $('login').value = ''; $('note').value = '';
  $('goi').value = '';
  $('goiInfo').textContent = ''; $('goiDetail').style.display='none';
}

/* Preview order modal-like (simple) */
$('btnPreview').addEventListener('click', ()=>{
  const goiVal = $('goi').value;
  if (!goiVal){ alert('Chá»n gÃ³i Ä‘á»ƒ xem trÆ°á»›c.'); return; }
  const {name,price} = parseGoiValue(goiVal);
  const ten = $('ten').value.trim(); const login = $('login').value.trim();
  const note = $('note').value.trim();
  alert(
    `XÃ¡c nháº­n Ä‘Æ¡n:\n\nGÃ³i: ${name}\nGiÃ¡: ${formatMoney(price)}\nTÃªn: ${ten || '(chÆ°a nháº­p)'}\nLogin: ${login || '(chÆ°a nháº­p)'}\nGhi chÃº: ${note || '(khÃ´ng)'}`
  );
});

/* ========== Náº¡p tiá»n / Gift ========== */
$('btnNap').addEventListener('click', ()=>{
  if (!currentUser){ alert('Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ náº¡p.'); showSection('account'); return; }
  const amt = Number($('nap_amount').value) || 0;
  if (amt < 1000){ alert('Sá»‘ tiá»n náº¡p tá»‘i thiá»ƒu 1.000Ä‘ (demo).'); return; }
  // Add to user
  const users = loadJSON('sn_users', []);
  const idx = users.findIndex(u=>u.id===currentUser.id);
  if (idx === -1){ alert('NgÆ°á»i dÃ¹ng khÃ´ng tá»“n táº¡i.'); logout(); return; }
  users[idx].balance += amt;
  saveJSON('sn_users', users);
  currentUser.balance = users[idx].balance;
  saveJSON('sn_currentUser', currentUser);
  refreshHeader();
  $('nap_amount').value = '';
  alert('Náº¡p thÃ nh cÃ´ng (demo). Sá»‘ dÆ° Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t.');
});

$('btnFakePay').addEventListener('click', ()=>{
  $('nap_amount').value = 50000;
  $('btnNap').click();
});

/* Gift codes demo */
const demoCodes = {
  'SNOW1000': 1000,
  'SNOW5000': 5000,
  'WELCOME50': 50000
};

$('btnRedeem').addEventListener('click', ()=>{
  const code = $('gift_code').value.trim().toUpperCase();
  if (!code){ alert('Nháº­p mÃ£ gift.'); return; }
  if (!currentUser){ alert('ÄÄƒng nháº­p Ä‘á»ƒ Ä‘á»•i mÃ£.'); showSection('account'); return; }
  if (!demoCodes[code]){ $('giftResult').textContent = 'MÃ£ khÃ´ng há»£p lá»‡ hoáº·c Ä‘Ã£ háº¿t háº¡n.'; return; }

  // add balance and "consume" code (for demo we'll store redeemed codes per user)
  const users = loadJSON('sn_users', []);
  const idx = users.findIndex(u=>u.id === currentUser.id);
  if (idx === -1){ alert('NgÆ°á»i dÃ¹ng khÃ´ng tá»“n táº¡i.'); logout(); return; }
  const redeemedKey = 'sn_redeemed_' + currentUser.id;
  const redeemed = loadJSON(redeemedKey, []);
  if (redeemed.includes(code)){ $('giftResult').textContent = 'Báº¡n Ä‘Ã£ sá»­ dá»¥ng mÃ£ nÃ y trÆ°á»›c Ä‘Ã³.'; return; }
  users[idx].balance += demoCodes[code];
  saveJSON('sn_users', users);
  saveJSON(redeemedKey, [...redeemed, code]);
  currentUser.balance = users[idx].balance;
  saveJSON('sn_currentUser', currentUser);
  refreshHeader();
  $('giftResult').textContent = `Äá»•i mÃ£ thÃ nh cÃ´ng! Báº¡n nháº­n Ä‘Æ°á»£c ${formatMoney(demoCodes[code])}.`;
  $('gift_code').value = '';
});

/* ========== Orders / Lá»‹ch sá»­ ========== */
function renderOrders(){
  const orders = loadJSON('sn_orders', []);
  const currentId = currentUser ? currentUser.id : null;
  const list = orders.filter(o => !currentId || o.userId === currentId);
  if (list.length === 0){
    $('ordersList').innerHTML = '<p class="small">ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng.</p>';
    $('adminOrders').innerHTML = '<p class="small">ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng.</p>';
    return;
  }
  const html = list.map(o=>{
    const time = new Date(o.created_at).toLocaleString();
    return `<div class="pending">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><b>${o.package}</b> â€” <span class="small">${o.targetName}</span></div>
        <div><span class="badge ${o.status==='new'?'status-new':'status-done'}">${o.status.toUpperCase()}</span></div>
      </div>
      <div class="small" style="margin-top:6px">${o.note || ''}</div>
      <div class="small" style="margin-top:6px">GiÃ¡: ${formatMoney(o.price)} â€” ${time}</div>
      <div class="small" style="margin-top:6px">ID: ${o.id}</div>
    </div>`;
  }).join('');
  $('ordersList').innerHTML = html;
  // admin orders (full list)
  const allOrders = loadJSON('sn_orders', []);
  const adminHtml = allOrders.map(o=>{
    const time = new Date(o.created_at).toLocaleString();
    return `<div style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><b>${o.package}</b> â€” <span class="small">${o.username} â†’ ${o.targetName}</span></div>
        <div style="display:flex;gap:6px">
          <button data-act="mark" data-id="${o.id}" class="small">âœ… HoÃ n thÃ nh</button>
          <button data-act="del" data-id="${o.id}" class="small">ğŸ—‘ï¸ XÃ³a</button>
        </div>
      </div>
      <div class="small" style="margin-top:6px">GiÃ¡: ${formatMoney(o.price)} â€” ${time} â€” Tráº¡ng thÃ¡i: ${o.status}</div>
    </div>`;
  }).join('');
  $('adminOrders').innerHTML = adminHtml;
  // attach admin order handlers
  $('adminOrders').querySelectorAll('button[data-act]').forEach(btn=>{
    btn.addEventListener('click', (ev)=>{
      const id = btn.dataset.id;
      const act = btn.dataset.act;
      if (act === 'mark'){
        markOrderDone(id);
      } else if (act === 'del'){
        if (!confirm('XÃ¡c nháº­n xÃ³a Ä‘Æ¡n?')) return;
        deleteOrder(id);
      }
    });
  });
}

function markOrderDone(orderId){
  const orders = loadJSON('sn_orders', []);
  const idx = orders.findIndex(o=>o.id === orderId);
  if (idx === -1) return alert('ÄÆ¡n khÃ´ng tá»“n táº¡i.');
  orders[idx].status = 'done';
  saveJSON('sn_orders', orders);
  renderOrders();
  alert('ÄÃ£ Ä‘Ã¡nh dáº¥u hoÃ n thÃ nh.');
}

function deleteOrder(orderId){
  let orders = loadJSON('sn_orders', []);
  orders = orders.filter(o=>o.id !== orderId);
  saveJSON('sn_orders', orders);
  renderOrders();
}

/* ========== Discord webhook sender (optional) ========== */
async function sendDiscordWebhook(order){
  const webhook = localStorage.getItem('sn_webhook') || '';
  if (!webhook || webhook.includes('DÃN_WEBHOOK')) {
    console.log('Webhook chÆ°a Ä‘Æ°á»£c cáº¥u hÃ¬nh â€” bá» qua gá»­i thÃ´ng bÃ¡o.', order);
    return;
  }
  // Construct a simple embed payload
  const payload = {
    username: 'SNOW SHOP BOT',
    embeds: [{
      title: `ÄÆ¡n má»›i: ${order.package}`,
      color: 2430542,
      fields: [
        { name: 'NgÆ°á»i Ä‘áº·t', value: order.username || 'â€”', inline: true},
        { name: 'Má»¥c tiÃªu', value: order.targetName || 'â€”', inline: true},
        { name: 'GiÃ¡', value: formatMoney(order.price), inline: true},
        { name: 'Ghi chÃº', value: order.note || 'â€”', inline: false},
        { name: 'ID Ä‘Æ¡n', value: order.id, inline: true},
      ],
      footer: { text: `Thá»i gian: ${new Date(order.created_at).toLocaleString()}` }
    }]
  };
  const res = await fetch(webhook, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  if (!res.ok) throw new Error('Webhook send failed: ' + res.status);
  return res;
}

/* ========== Admin logic ========== */
const ADMIN_PASSWORD = 'admin123'; // demo password (in production: store securely on server)

$('btnAdminLogin').addEventListener('click', ()=>{
  const pass = $('admin_pass').value;
  if (pass !== ADMIN_PASSWORD){ alert('Máº­t kháº©u admin khÃ´ng Ä‘Ãºng.'); return; }
  $('adminAuth').classList.add('hidden');
  $('adminPanel').classList.remove('hidden');
  $('webhookInput').value = localStorage.getItem('sn_webhook') || '';
  $('webhookLabel').textContent = localStorage.getItem('sn_webhook') || 'ChÆ°a Ä‘áº·t';
  renderOrders();
});

$('btnSaveWebhook').addEventListener('click', ()=>{
  const w = $('webhookInput').value.trim();
  if (!w){ alert('Nháº­p URL webhook.'); return; }
  localStorage.setItem('sn_webhook', w);
  $('webhookLabel').textContent = w;
  alert('ÄÃ£ lÆ°u webhook (lÆ°u á»Ÿ localStorage, demo).');
});

$('btnViewUsers').addEventListener('click', ()=>{
  const users = loadJSON('sn_users', []);
  if (users.length === 0){ alert('ChÆ°a cÃ³ user.'); return; }
  const txt = users.map(u=>`${u.username} â€” ${formatMoney(u.balance)} â€” id:${u.id}`).join('\n');
  alert('Danh sÃ¡ch ngÆ°á»i dÃ¹ng:\n\n' + txt);
});

$('btnInitMock').addEventListener('click', ()=>{
  if (!confirm('Khá»Ÿi táº¡o dá»¯ liá»‡u demo (thÃªm vÃ i users vÃ  orders)?')) return;
  // sample users
  const sampleUsers = [
    { id: 1, username:'alice', password:'pw', balance:50000, created_at: now() },
    { id: 2, username:'bob', password:'pw', balance:20000, created_at: now() }
  ];
  saveJSON('sn_users', sampleUsers);
  saveJSON('sn_orders', [
    { id:'ORD1', userId:1, username:'alice', targetName:'alice_rb', package:'Level 700', price:20000, note:'Æ¯u tiÃªn ban ngÃ y', status:'new', created_at:now() },
    { id:'ORD2', userId:2, username:'bob', targetName:'bob_rb', package:'Tushita', price:15000, note:'SÃ¡ng sá»›m', status:'done', created_at:now() }
  ]);
  alert('ÄÃ£ táº¡o dá»¯ liá»‡u máº«u. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i náº¿u cáº§n.');
  renderOrders();
});

/* ========== Navigation & init ========== */
document.querySelectorAll('nav button').forEach(btn=>{
  btn.addEventListener('click', ()=> showSection(btn.dataset.tab));
});

$('btnLogin').addEventListener('click', loginAcc);
$('btnRegister').addEventListener('click', registerAcc);
$('btnLogout').addEventListener('click', logout);
$('btnDatDon').addEventListener('click', datDon);

window.addEventListener('load', ()=>{
  currentUser = loadJSON('sn_currentUser', null);
  updateUIAfterAuth();
  renderOrders();
  // start on account tab
  showSection('account');
});
</script>

</body>
</html>
