<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SNOW SHOP ‚Äî Thu√™ c√†y Blox Fruits</title>

<!-- Google Font (preconnect + preload for performance) -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* -------------------------
   Visual / Layout (modern)
   ------------------------- */
:root{
  --bg:#051024;
  --panel:#071226;
  --card:#0d1a2a;
  --muted:#9aa3af;
  --text:#e6eef6;
  --accent:#06b6d4;
  --accent-2:#60a5fa;
  --success:#10b981;
  --danger:#ef4444;
  --glass: rgba(255,255,255,0.02);
  --radius:12px;
  --shadow: 0 10px 30px rgba(2,6,23,0.6);
  --transition: 200ms cubic-bezier(.2,.9,.3,1);
  --max-width:1200px;
  --card-gap:14px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  background:linear-gradient(180deg,var(--bg),#03101d 150%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.45;
  -webkit-tap-highlight-color: transparent;
}

/* Header */
.header{
  max-width:var(--max-width);
  margin:18px auto;
  padding:14px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.brand{display:flex;align-items:center;gap:12px}
.logo{
  width:56px;height:56px;border-radius:12px;
  background:linear-gradient(135deg,var(--accent),#2563eb);
  display:flex;align-items:center;justify-content:center;font-weight:800;color:#021022;
  box-shadow:var(--shadow);font-size:20px;
}
.title{font-weight:700}
.header-info{display:flex;gap:12px;align-items:center;font-size:14px;color:var(--muted)}

/* Nav */
.nav{
  max-width:var(--max-width);
  margin:0 auto;
  padding:8px 18px 0;
  display:flex;
  gap:8px;
  justify-content:center;
}
.nav button{
  background:transparent;border:0;color:var(--muted);padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;
  transition:color var(--transition), background var(--transition);
}
.nav button[aria-current="true"], .nav button:hover{ color:var(--text); background:var(--glass) }

/* Main layout */
.main{
  max-width:var(--max-width);
  margin:18px auto;
  padding:18px;
  display:grid;
  grid-template-columns: 1fr 360px;
  gap:18px;
}
@media (max-width:980px){ .main{ grid-template-columns:1fr } }

/* Panels */
.panel{
  background:linear-gradient(180deg,var(--panel),#061224);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,0.03);
}

/* Hero */
.hero{display:flex;justify-content:space-between;gap:16px;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(90deg,rgba(6,182,212,0.05),rgba(58,123,213,0.03))}
.hero h1{margin:0;font-size:20px}
.hero p{margin:6px 0 0;color:var(--muted);font-size:14px}
.hero .actions{display:flex;gap:8px;margin-top:12px}

/* Search / filter */
.controls{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.controls input, .controls select{
  background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text);padding:10px;border-radius:10px;width:100%;
}
.controls .col{min-width:160px;flex:1}

/* Packages grid */
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:var(--card-gap);
}
@media (max-width:980px){ .grid{ grid-template-columns: repeat(2,1fr) } }
@media (max-width:640px){ .grid{ grid-template-columns:1fr } }

.card-item{
  background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
  padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
  transition: transform var(--transition), box-shadow var(--transition);
  will-change: transform;
}
.card-item:hover{ transform: translateY(-6px); box-shadow: 0 20px 40px rgba(2,6,23,0.6); }

/* package header */
.pkg-head{display:flex;justify-content:space-between;align-items:center;gap:8px}
.pkg-name{font-weight:800}
.pkg-price{font-weight:800;color:var(--accent)}
.pkg-meta{color:var(--muted);font-size:13px;margin-top:8px}

/* features */
.features{margin-top:10px;display:flex;flex-direction:column;gap:6px;color:var(--muted);font-size:13px}
.feature{display:flex;gap:8px;align-items:flex-start}
.feature .dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(90deg,var(--accent),var(--accent-2));margin-top:6px}

/* action row */
.actions-row{display:flex;gap:8px;margin-top:12px}
.btn{
  border:0;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer;color:#021022;background:linear-gradient(90deg,var(--accent),var(--accent-2));
  transition: transform var(--transition);
}
.btn.secondary{ background:transparent;color:var(--text); border:1px solid rgba(255,255,255,0.04) }
.btn:active{ transform: translateY(1px) }

/* Sidebar */
.sidebar{display:flex;flex-direction:column;gap:12px}
.wallet{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
.wallet .balance{font-weight:800;color:var(--accent);font-size:18px;margin-top:8px}
.orders-preview{padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
.order-small{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:var(--glass);margin-bottom:8px}

/* modal / toast */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:60}
.modal{width:100%;max-width:720px;background:linear-gradient(180deg,#071022,#05101a);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 40px rgba(0,0,0,0.7)}
.toast-wrap{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px;z-index:70}

/* small helpers */
.kv{color:var(--muted);font-size:13px}
.hidden{display:none}
.small{font-size:13px;color:var(--muted)}
</style>
</head>

<body>
  <header class="header" role="banner">
    <div class="brand">
      <div class="logo" aria-hidden>SS</div>
      <div>
        <div class="title">SNOW SHOP</div>
        <div class="kv">Thu√™ c√†y Blox Fruits ‚Äî Uy t√≠n ‚Ä¢ Nhanh ‚Ä¢ An to√†n</div>
      </div>
    </div>

    <div class="header-info" aria-hidden>
      <div class="kv">üë§ <strong id="hdr-user">Ch∆∞a ƒëƒÉng nh·∫≠p</strong></div>
      <div class="kv">üí∞ <strong id="hdr-balance">0ƒë</strong></div>
    </div>
  </header>

  <nav class="nav" role="navigation" aria-label="Ch√≠nh">
    <button data-tab="packages" aria-current="true">G√≥i d·ªãch v·ª•</button>
    <button data-tab="account">T√†i kho·∫£n</button>
    <button data-tab="orders">L·ªãch s·ª≠</button>
    <button id="contactBtn">Li√™n h·ªá</button>
  </nav>

  <main class="main" role="main">
    <!-- left: packages -->
    <section class="panel" aria-labelledby="hero-title">
      <div class="hero" id="hero">
        <div>
          <h1 id="hero-title">Thu√™ c√†y chuy√™n nghi·ªáp ‚Äî An to√†n & Nhanh</h1>
          <p>Ch·ªçn g√≥i, ƒë·∫∑t ƒë∆°n, theo d√µi ti·∫øn tr√¨nh. H·ªá th·ªëng demo ƒë√£ ƒë∆∞·ª£c t·ªëi ∆∞u UX/hi·ªáu nƒÉng.</p>
          <div class="hero-actions" style="margin-top:10px">
            <button class="btn" id="cta-order">Mua ngay</button>
            <button class="btn secondary" id="cta-learn">C√°ch ho·∫°t ƒë·ªông</button>
          </div>
        </div>

        <div style="text-align:right">
          <div class="kv">H·ªó tr·ª£ 24/7</div>
          <div style="margin-top:10px" class="kv">Cam k·∫øt ho√†n ti·ªÅn n·∫øu vi ph·∫°m</div>
        </div>
      </div>

      <div class="controls" aria-hidden>
        <input id="searchInput" placeholder="T√¨m ki·∫øm g√≥i (v√≠ d·ª•: Level, Tushita, Yama)" class="col" />
        <select id="sortSelect" class="col" aria-label="S·∫Øp x·∫øp">
          <option value="popular">M·∫∑c ƒë·ªãnh</option>
          <option value="price_asc">Gi√° tƒÉng d·∫ßn</option>
          <option value="price_desc">Gi√° gi·∫£m d·∫ßn</option>
        </select>
      </div>

      <div id="packagesGrid" class="grid" aria-live="polite" aria-label="Danh s√°ch g√≥i"></div>
    </section>

    <!-- right: sidebar -->
    <aside class="sidebar">
      <div class="wallet panel">
        <div class="kv">T√†i kho·∫£n</div>
        <div id="acctName" class="kv" style="margin-top:6px">B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p</div>
        <div id="balance" class="balance">0ƒë</div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn" id="openAccount">ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</button>
          <button class="btn secondary" id="quickBuy">ƒê·∫∑t nhanh</button>
        </div>
      </div>

      <div class="orders-preview panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>ƒê∆°n g·∫ßn ƒë√¢y</strong>
          <button class="small" id="viewOrders">Xem t·∫•t c·∫£</button>
        </div>
        <div id="ordersPreview" style="margin-top:12px"></div>
      </div>

      <div class="panel">
        <strong>H·ªó tr·ª£</strong>
        <div class="kv" style="margin-top:8px">Li√™n h·ªá: Discord / Telegram / Zalo (c·∫≠p nh·∫≠t sau)</div>
        <div style="margin-top:12px"><button class="btn secondary" id="contactSupport">M·ªü k√™nh h·ªó tr·ª£</button></div>
      </div>
    </aside>
  </main>

  <div id="modalRoot" class="hidden" aria-hidden="true"></div>
  <div id="toastWrap" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>

<script>
/*
  Improved & optimized single-file front-end
  - Better UX: toast notifications, accessible modal, non-blocking flow
  - Performance: event delegation, debounced search, minimal reflows
  - Security: don't embed Discord webhook in client; use backend to forward
  - Storage: wrapped localStorage usage
*/

/* -------- CONFIG -------- */
const DISCORD_WEBHOOK = ""; // Set to your backend endpoint that forwards to Discord (do NOT embed raw Discord webhook)
const PACKAGES = [
  { id:'p1', name:'Level 700', price:20000, time:'3‚Äì5 gi·ªù', desc:'Farm quest nhanh ‚Ä¢ Kh√¥ng ƒë·ªïi tr√°i', features:['Farm quest t·ªëi ∆∞u','Kh√¥ng m·∫•t ƒë·ªì','Nhanh g·ªçn'] },
  { id:'p2', name:'700 ‚Üí 1500', price:20000, time:'1‚Äì2 ng√†y', desc:'Farm boss + quest', features:['Farm boss','Kh√¥ng m·∫•t ƒë·ªì','An to√†n'] },
  { id:'p3', name:'1500 ‚Üí 2800', price:20000, time:'2‚Äì3 ng√†y', desc:'Farm Sea 3 full', features:['Full Sea 3','An to√†n cao','Ho√†n th√†nh ƒë√∫ng h·∫°n'] },
  { id:'p4', name:'0 ‚Üí MAX', price:50000, time:'4‚Äì6 ng√†y', desc:'C√†y t·ª´ ƒë·∫ßu t·ªõi max', features:['Full Sea 1-2-3','Kh√¥ng m·∫•t acc','Cam k·∫øt ho√†n th√†nh'] },
  { id:'p5', name:'Tushita', price:15000, time:'Trong ng√†y', desc:'Ki·∫øm Tushita an to√†n', features:['Full quest','Nhanh','An to√†n'] },
  { id:'p6', name:'Tam Ki·∫øm Full', price:35000, time:'2‚Äì3 ng√†y', desc:'True Triple Katana', features:['Full 3 ki·∫øm','Kh√¥ng rollback','T·ªâ l·ªá cao'] },
];

/* -------- Utilities -------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const fmt = n => (Number(n)||0).toLocaleString('vi-VN');
const now = () => Date.now();
async function sha256(msg){ const enc = new TextEncoder(); const buf = await crypto.subtle.digest('SHA-256', enc.encode(msg)); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join(''); }
function escapeHtml(s){ if(s==null) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function debounce(fn, wait){ let t; return (...args) => { clearTimeout(t); t = setTimeout(()=>fn(...args), wait); }; }

/* Storage wrapper */
const Storage = {
  usersKey: 'snow_v3_users',
  ordersKey: 'snow_v3_orders',
  getUsers(){ try{return JSON.parse(localStorage.getItem(this.usersKey) || '{}')}catch(e){return{}} },
  saveUsers(v){ localStorage.setItem(this.usersKey, JSON.stringify(v)) },
  getOrders(){ try{return JSON.parse(localStorage.getItem(this.ordersKey) || '[]')}catch(e){return[]} },
  saveOrders(v){ localStorage.setItem(this.ordersKey, JSON.stringify(v)) },
};

/* Current user (session) */
function currentUser(){ try{return JSON.parse(sessionStorage.getItem('snow_current_user')||'null')}catch(e){return null} }
function setCurrentUser(u){ if(u) sessionStorage.setItem('snow_current_user', JSON.stringify(u)); else sessionStorage.removeItem('snow_current_user'); }

/* -------- UI: Toast (non-blocking) -------- */
const toastWrap = $('#toastWrap');
function toast(message, {type='info', timeout=3000}={}) {
  const el = document.createElement('div');
  el.className = 'panel';
  el.style.padding = '10px 12px';
  el.style.minWidth = '200px';
  el.style.borderRadius = '10px';
  el.style.background = type==='error' ? 'linear-gradient(180deg, rgba(239,68,68,0.08), rgba(239,68,68,0.03))' : 'linear-gradient(180deg, rgba(6,182,212,0.04), transparent)';
  el.innerText = message;
  toastWrap.appendChild(el);
  setTimeout(()=>{ el.style.opacity = '0'; el.style.transform='translateX(12px)'; setTimeout(()=>el.remove(), 300); }, timeout);
}

/* -------- Modal (accessible) -------- */
const modalRoot = $('#modalRoot');
function showModal(contentHTML, {onOpen=null}={}) {
  modalRoot.innerHTML = `<div class="modal-backdrop" id="backdrop" role="dialog" aria-modal="true">${contentHTML}</div>`;
  modalRoot.classList.remove('hidden');
  // trap focus minimal: focus first focusable element
  requestAnimationFrame(()=> {
    const focusable = modalRoot.querySelector('button, input, textarea, [tabindex]:not([tabindex="-1"])');
    if(focusable) focusable.focus();
    if(typeof onOpen === 'function') onOpen();
  });
  // close on ESC
  const onKey = (e) => { if(e.key === 'Escape') hideModal(); };
  document.addEventListener('keydown', onKey, {once:false});
  modalRoot.dataset.keyHandler = true;
  modalRoot._onKey = onKey;
}
function hideModal(){ modalRoot.innerHTML=''; modalRoot.classList.add('hidden'); if(modalRoot._onKey) document.removeEventListener('keydown', modalRoot._onKey); }

/* -------- Auth (demo) -------- */
async function registerUser(username, password) {
  if(!username || !password) throw new Error('Nh·∫≠p t√™n v√† m·∫≠t kh·∫©u');
  const users = Storage.getUsers();
  if(users[username]) throw new Error('T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i');
  users[username] = { username, passHash: await sha256(password), balance:0 };
  Storage.saveUsers(users);
  return true;
}
async function loginUser(username, password) {
  const users = Storage.getUsers();
  const rec = users[username];
  if(!rec) throw new Error('Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n');
  const h = await sha256(password);
  if(h !== rec.passHash) throw new Error('M·∫≠t kh·∫©u sai');
  setCurrentUser({ username });
  return true;
}

/* -------- Orders -------- */
function saveOrder(order) {
  const list = Storage.getOrders();
  list.unshift(order);
  Storage.saveOrders(list);
}
function getOrders(){ return Storage.getOrders(); }
function buildOrderPayload(order){
  return {
    id: order.id, username: order.username, name: order.name,
    login: order.login, package: order.package, price: order.price,
    note: order.note || '', created_at: new Date(order.createdAt).toISOString()
  };
}
async function forwardOrder(order){
  if(!DISCORD_WEBHOOK) throw new Error('No webhook configured');
  const payload = { embeds: [{ title:`ƒê∆°n m·ªõi: ${order.package}`, color:3447003,
    fields:[
      {name:'Ng∆∞·ªùi ƒë·∫∑t', value:order.username || '-', inline:true},
      {name:'T√™n/Discord', value:order.name || '-', inline:true},
      {name:'Login', value:order.login || '-', inline:true},
      {name:'Gi√°', value:fmt(order.price)+'‚Ç´', inline:true},
      {name:'Ghi ch√∫', value:order.note || '-', inline:false}
    ], timestamp: new Date(order.createdAt).toISOString()
  }]};
  const res = await fetch(DISCORD_WEBHOOK, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  if(!res.ok) throw new Error('Forward failed: '+res.status);
  return res;
}

/* -------- Rendering -------- */
function renderHeader(){
  const cur = currentUser();
  if(cur){
    $('#hdr-user').textContent = cur.username;
    const users = Storage.getUsers();
    const bal = (users[cur.username] && users[cur.username].balance) || 0;
    $('#hdr-balance').textContent = fmt(bal)+'ƒë';
    $('#acctName').textContent = 'Xin ch√†o, '+cur.username;
    $('#balance').textContent = fmt(bal)+'ƒë';
  } else {
    $('#hdr-user').textContent = 'Ch∆∞a ƒëƒÉng nh·∫≠p';
    $('#hdr-balance').textContent = '0ƒë';
    $('#acctName').textContent = 'B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p';
    $('#balance').textContent = '0ƒë';
  }
}

/* Render package cards (optimized: build fragments) */
function renderPackages(list = PACKAGES){
  const grid = $('#packagesGrid');
  // use document fragment to minimize reflows
  const frag = document.createDocumentFragment();
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card-item';
    card.innerHTML = `
      <div class="pkg-head">
        <div>
          <div class="pkg-name">${escapeHtml(p.name)}</div>
          <div class="pkg-meta">${escapeHtml(p.desc)}</div>
        </div>
        <div style="text-align:right">
          <div class="pkg-price">${fmt(p.price)}‚Ç´</div>
          <div class="kv" style="font-size:12px">${escapeHtml(p.time)}</div>
        </div>
      </div>
      <div class="features">${p.features.map(f=>`<div class="feature"><div class="dot"></div>${escapeHtml(f)}</div>`).join('')}</div>
      <div class="actions-row">
        <button class="btn" data-buy="${p.id}">MUA NGAY</button>
        <button class="btn secondary" data-info="${p.id}">CHI TI·∫æT</button>
      </div>
    `;
    frag.appendChild(card);
  });
  grid.innerHTML = '';
  grid.appendChild(frag);
}

/* Render orders preview */
function renderOrdersPreview(){
  const container = $('#ordersPreview');
  const list = getOrders();
  if(!container) return;
  if(!list || list.length === 0){ container.innerHTML = '<div class="kv">Ch∆∞a c√≥ ƒë∆°n g·∫ßn ƒë√¢y</div>'; return; }
  container.innerHTML = list.slice(0,6).map(o => `
    <div class="order-small">
      <div style="max-width:65%"><strong>${escapeHtml(o.package)}</strong><div class="kv" style="font-size:12px">${escapeHtml(o.name)} ‚Ä¢ ${escapeHtml(o.login)}</div></div>
      <div style="text-align:right"><div class="kv">${fmt(o.price)}‚Ç´</div><div class="kv" style="color:${o.sent? 'var(--success)':'var(--accent)'}">${o.sent? 'ƒê√£ g·ª≠i':'Ch∆∞a g·ª≠i'}</div></div>
    </div>
  `).join('');
}

/* -------- Search & Sort (debounced) -------- */
const onSearch = debounce(() => {
  const q = $('#searchInput').value.trim().toLowerCase();
  let filtered = PACKAGES.filter(p => !q || (p.name + ' ' + p.desc + ' ' + p.features.join(' ')).toLowerCase().includes(q));
  const sort = $('#sortSelect').value;
  if(sort === 'price_asc') filtered.sort((a,b)=>a.price-b.price);
  else if(sort === 'price_desc') filtered.sort((a,b)=>b.price-a.price);
  renderPackages(filtered);
}, 160);

/* -------- Event handling (delegation) -------- */
document.addEventListener('click', (e) => {
  const buy = e.target.closest('[data-buy]');
  if(buy) {
    const id = buy.getAttribute('data-buy'); const pkg = PACKAGES.find(p=>p.id===id);
    openOrderModal(pkg);
    return;
  }
  const info = e.target.closest('[data-info]');
  if(info){
    const id = info.getAttribute('data-info'); const pkg = PACKAGES.find(p=>p.id===id);
    showInfoModal(pkg);
    return;
  }
});

/* Header/nav interactions */
$$('.nav button').forEach(b => b.addEventListener('click', (ev) => {
  $$('.nav button').forEach(x => x.setAttribute('aria-current','false'));
  b.setAttribute('aria-current','true');
  const tab = b.getAttribute('data-tab');
  if(tab === 'account') openAuthModal();
  else if(tab === 'orders') openOrdersModal();
}));

$('#contactBtn').addEventListener('click', ()=>toast('Li√™n h·ªá: Discord / Telegram / Zalo ‚Äî c·∫≠p nh·∫≠t sau'));
$('#cta-learn').addEventListener('click', ()=>toast('1) Ch·ªçn g√≥i ‚Üí 2) ƒê·∫∑t ƒë∆°n ‚Üí 3) Team th·ª±c hi·ªán ‚Üí 4) Ho√†n th√†nh'));
$('#openAccount').addEventListener('click', openAuthModal);
$('#quickBuy').addEventListener('click', ()=>openOrderModal(PACKAGES[0]));
$('#viewOrders').addEventListener('click', openOrdersModal);
$('#contactSupport').addEventListener('click', ()=>toast('M·ªü k√™nh h·ªó tr·ª£ ‚Äî demo'));

/* Search and sort */
$('#searchInput').addEventListener('input', onSearch);
$('#sortSelect').addEventListener('change', onSearch);

/* CTA order open first package */
$('#cta-order').addEventListener('click', ()=>openOrderModal(PACKAGES[0]));

/* -------- Info modal -------- */
function showInfoModal(pkg){
  showModal(`<div class="modal"><h3>${escapeHtml(pkg.name)}</h3>
    <div class="kv" style="margin-top:8px">${escapeHtml(pkg.desc)}</div>
    <div style="margin-top:8px"><strong>Th·ªùi gian:</strong> ${escapeHtml(pkg.time)} ‚Ä¢ <strong>Gi√°:</strong> ${fmt(pkg.price)}‚Ç´</div>
    <div style="margin-top:10px"><strong>T√≠nh nƒÉng:</strong><ul class="kv">${pkg.features.map(f=>`<li>${escapeHtml(f)}</li>`).join('')}</ul></div>
    <div style="display:flex;gap:8px;margin-top:12px"><button class="btn" id="infoBuy">MUA NGAY</button><button class="btn secondary" id="infoClose">ƒê√ìNG</button></div></div>`, {
      onOpen: ()=> {
        $('#infoClose').addEventListener('click', hideModal);
        $('#infoBuy').addEventListener('click', ()=>{ hideModal(); openOrderModal(pkg); });
      }
  });
}

/* -------- Auth modal (login / register) -------- */
function openAuthModal(){
  showModal(`<div class="modal">
    <h3>T√†i kho·∫£n</h3>
    <div style="display:flex;gap:8px;margin-top:12px">
      <input id="m_user" placeholder="T√™n ƒëƒÉng nh·∫≠p" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)" />
      <input id="m_pass" type="password" placeholder="M·∫≠t kh·∫©u" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)" />
    </div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn" id="m_login">ƒêƒÉng nh·∫≠p</button>
      <button class="btn secondary" id="m_register">ƒêƒÉng k√Ω</button>
      <button class="btn secondary" id="m_close">ƒê√≥ng</button>
    </div>
    <p class="kv" style="margin-top:10px">Demo l∆∞u d·ªØ li·ªáu c·ª•c b·ªô. Kh√¥ng d√πng t√†i kho·∫£n th·∫≠t.</p>
  </div>`, { onOpen: () => {
    $('#m_close').addEventListener('click', hideModal);
    $('#m_register').addEventListener('click', async ()=>{
      const u = $('#m_user').value.trim(), p = $('#m_pass').value;
      try{ await registerUser(u,p); toast('ƒêƒÉng k√Ω th√†nh c√¥ng ‚Äî vui l√≤ng ƒëƒÉng nh·∫≠p'); $('#m_pass').value=''; } catch(err){ toast(err.message || 'L·ªói', {type:'error'}); }
    });
    $('#m_login').addEventListener('click', async ()=>{
      const u = $('#m_user').value.trim(), p = $('#m_pass').value;
      try{ await loginUser(u,p); hideModal(); renderHeader(); toast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng'); } catch(err){ toast(err.message || 'L·ªói', {type:'error'}); }
    });
  }});
}

/* -------- Order modal flow -------- */
function openOrderModal(pkg){
  showModal(`<div class="modal">
    <h3>ƒê·∫∑t g√≥i ‚Äî ${escapeHtml(pkg.name)} <span style="float:right;color:var(--accent)">${fmt(pkg.price)}‚Ç´</span></h3>
    <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
      <input id="o_name" placeholder="T√™n (Roblox / Discord)" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)"/>
      <input id="o_login" placeholder="Login Roblox" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)"/>
      <textarea id="o_note" placeholder="Ghi ch√∫ (pass, y√™u c·∫ßu...)" style="padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)"></textarea>
    </div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn" id="o_confirm">X√ÅC NH·∫¨N ƒê·∫∂T</button>
      <button class="btn secondary" id="o_cancel">H·ª¶Y</button>
    </div>
    <p class="kv" style="margin-top:10px">H·ªá th·ªëng demo s·∫Ω l∆∞u ƒë∆°n c·ª•c b·ªô. ƒê·ªÉ g·ª≠i t·ªõi k√™nh qu·∫£n l√Ω th·ª±c t·∫ø, c·∫ßn backend an to√†n.</p>
  </div>`, {
    onOpen: () => {
      const cur = currentUser();
      if(cur) $('#o_name').value = cur.username;
      $('#o_cancel').addEventListener('click', hideModal);
      $('#o_confirm').addEventListener('click', async ()=>{
        const curUser = currentUser();
        if(!curUser){ if(confirm('B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p. ƒêƒÉng nh·∫≠p b√¢y gi·ªù?')) { hideModal(); openAuthModal(); } return; }
        const name = $('#o_name').value.trim(), login = $('#o_login').value.trim(), note = $('#o_note').value.trim();
        if(!name || !login){ toast('Nh·∫≠p t√™n v√† login', {type:'error'}); return; }
        if(!confirm(`X√°c nh·∫≠n ƒë·∫∑t: ${pkg.name} ‚Äî ${fmt(pkg.price)}‚Ç´ ?`)) return;
        const order = { id:'o_'+now(), username:curUser.username, name, login, package:pkg.name, price:pkg.price, note, createdAt: now(), sent:false };
        saveOrder(order);
        renderOrdersPreview();
        hideModal();
        toast('ƒê√£ l∆∞u ƒë∆°n c·ª•c b·ªô, ƒëang g·ª≠i t·ªõi h·ªá th·ªëng...');
        try{
          await forwardOrder(order);
          // mark sent
          const list = Storage.getOrders(); const idx = list.findIndex(x=>x.id===order.id); if(idx>=0){ list[idx].sent=true; Storage.saveOrders(list); renderOrdersPreview(); }
          toast('ƒê∆°n ƒë√£ g·ª≠i t·ªõi h·ªá th·ªëng');
        }catch(err){
          // fallback: copy payload to clipboard (if available) so developer can forward on server
          try{ await navigator.clipboard.writeText(JSON.stringify(buildOrderPayload(order), null, 2)); }catch(e){}
          toast('Kh√¥ng th·ªÉ g·ª≠i t·ª± ƒë·ªông. Payload ƒë√£ sao ch√©p (n·∫øu tr√¨nh duy·ªát h·ªó tr·ª£).', {type:'error', timeout:5000});
        }
      });
    }
  });
}

/* -------- Orders modal (full) -------- */
function openOrdersModal(){
  const list = getOrders();
  showModal(`<div class="modal"><h3>L·ªãch s·ª≠ ƒë∆°n h√†ng</h3>
    <div style="max-height:420px;overflow:auto;margin-top:12px">
      ${list.length===0 ? '<p class="kv">Ch∆∞a c√≥ ƒë∆°n n√†o.</p>' : list.map(o=>`
        <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:8px;background:var(--glass)">
          <div style="max-width:70%"><strong>${escapeHtml(o.package)}</strong><div class="kv">${escapeHtml(o.name)} ‚Äî ${escapeHtml(o.login)}</div><div class="kv" style="margin-top:6px">Ghi ch√∫: ${escapeHtml(o.note||'‚Äî')}</div></div>
          <div style="text-align:right"><div style="font-weight:800">${fmt(o.price)}‚Ç´</div><div class="kv" style="color:${o.sent? 'var(--success)':'var(--accent)'}">${o.sent? 'ƒê√£ g·ª≠i':'Ch∆∞a g·ª≠i'}</div></div>
        </div>`).join('')}
    </div>
    <div style="display:flex;gap:8px;margin-top:12px"><button class="btn" id="ordersClose">ƒê√≥ng</button><button class="btn secondary" id="ordersExport">Xu·∫•t JSON</button></div></div>`, {
      onOpen: () => {
        $('#ordersClose').addEventListener('click', hideModal);
        $('#ordersExport').addEventListener('click', ()=> {
          const json = JSON.stringify(getOrders(), null, 2);
          const w = window.open('', '_blank');
          if(w){ w.document.write('<pre>'+escapeHtml(json)+'</pre>'); w.document.title='Orders JSON'; }
        });
      }
  });
}

/* -------- Init (on DOM ready) -------- */
document.addEventListener('DOMContentLoaded', () => {
  renderPackages(); renderHeader(); renderOrdersPreview();
  // create demo user if none
  (async()=>{
    const users = Storage.getUsers();
    if(!users['demo']){ users['demo'] = { username:'demo', passHash: await sha256('demo'), balance: 50000 }; Storage.saveUsers(users); }
    // reflect header if logged
    renderHeader();
  })();
});
</script>
</body>
</html>
