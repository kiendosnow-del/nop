<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” Professional System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:'Segoe UI',sans-serif;background:#f1f5f9;margin:0;padding-bottom:80px;color:#334155}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;color:#fff;transition:0.2s}
        button:hover{opacity:0.8}
        button.red{background:#ef4444} button.green{background:#22c55e} button.purple{background:#a855f7} button.gray{background:#64748b}
        input,select{width:100%;padding:12px;margin:6px 0;border-radius:8px;border:1px solid #e2e8f0;box-sizing:border-box}
        .badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
        .bg-wait{background:#fef3c7;color:#d97706} .bg-process{background:#f3e8ff;color:#7c3aed} .bg-done{background:#dcfce7;color:#16a34a}
        .tab-btn{background:#fff;color:#64748b;border:1px solid #e2e8f0;margin-right:5px; padding: 10px 15px}
        .tab-btn.active{background:#38bdf8;color:#fff;border-color:#38bdf8}
        #modalOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,0.6);display:none;z-index:1000;backdrop-filter:blur(3px)}
        .modal{background:#fff;width:90%;max-width:450px;margin:50px auto;border-radius:16px;padding:20px;position:relative}
        .grid-nicks { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .nick-card { border: 1px solid #e2e8f0; border-radius: 10px; padding: 10px; text-align: center; }
        .detail-box { background: #f8fafc; border-left: 4px solid #38bdf8; padding: 10px; margin: 10px 0; font-size: 13px; display: none; white-space: pre-line; }
        .history-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 13px; }
    </style>
</head>
<body>

<div class="box" style="display:flex; justify-content:space-between; align-items:center; background:linear-gradient(to right, #fff, #f0f9ff)">
    <div>
        <div style="font-size:12px; color:#64748b">ChÃ o, <b id="uName">KhÃ¡ch</b></div>
        <div style="font-size:18px; font-weight:bold; color:#16a34a">ğŸ’° <span id="uBalance">0</span> Ä‘</div>
    </div>
    <div id="authButtons"><button onclick="showLogin()">ğŸ”‘ ÄÄƒng nháº­p</button></div>
    <div id="userButtons" style="display:none"><button onclick="logout()" class="red">ThoÃ¡t</button></div>
</div>

<div class="box" style="display:flex; overflow-x: auto; gap: 5px; border:none; background:transparent; box-shadow:none">
    <button class="tab-btn active" onclick="showMainTab('caythue', this)">ğŸ® CÃ y ThuÃª</button>
    <button id="tabNickBtn" class="tab-btn" style="display:none" onclick="showMainTab('shopnick', this)">ğŸ›’ Mua Nick</button>
    <button class="tab-btn" onclick="showMainTab('lichsu', this)">ğŸ“œ Lá»‹ch sá»­</button>
</div>

<div id="tabCayThue" class="main-tab">
    <div class="box">
        <h3>ğŸ›’ Chá»n gÃ³i dá»‹ch vá»¥</h3>
        <select id="goi" onchange="updateServiceDetail()">
            <option value="">-- Click Ä‘á»ƒ chá»n gÃ³i --</option>
            <optgroup label="ğŸ”° LEVEL">
                <option value="Level 700|20000" data-info="Farm nhanh lÃªn level 700" data-detail="âœ” Farm quest nhanh&#10;âœ” KhÃ´ng Ä‘á»•i trÃ¡i&#10;âœ” 3â€“5 giá»">Level 700 â€“ 20.000Ä‘</option>
                <option value="700 â†’ 1500|20000" data-info="Farm tá»« Sea 2" data-detail="âœ” Farm boss + quest&#10;âœ” KhÃ´ng máº¥t Ä‘á»“&#10;âœ” 1â€“2 ngÃ y">700 â†’ 1500 â€“ 20.000Ä‘</option>
                <option value="1500 â†’ 2800|20000" data-info="Farm Sea 3" data-detail="âœ” Farm full Sea 3&#10;âœ” An toÃ n 100%&#10;âœ” 2â€“3 ngÃ y">1500 â†’ 2800 â€“ 20.000Ä‘</option>
                <option value="0 â†’ MAX|50000" data-info="CÃ y tá»« Ä‘áº§u tá»›i max" data-detail="âœ” Full Sea 1â€“2â€“3&#10;âœ” KhÃ´ng máº¥t acc&#10;âœ” 4â€“6 ngÃ y">0 â†’ MAX â€“ 50.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’ ITEM">
                <option value="Má» Neo|20000" data-info="LÃ m Má» Neo" data-detail="âœ” Full quest&#10;âœ” KhÃ´ng máº¥t Ä‘á»“&#10;âœ” 1 ngÃ y">Má» Neo â€“ 20.000Ä‘</option>
                <option value="Tushita|15000" data-info="Kiáº¿m Tushita" data-detail="âœ” Full quest&#10;âœ” An toÃ n&#10;âœ” Trong ngÃ y">Tushita â€“ 15.000Ä‘</option>
                <option value="Yama|30000" data-info="Kiáº¿m Yama" data-detail="âœ” Full Yama&#10;âœ” KhÃ´ng máº¥t Ä‘á»“&#10;âœ” 1â€“2 ngÃ y">Yama â€“ 30.000Ä‘</option>
                <option value="Tam Kiáº¿m Full|35000" data-info="True Triple Katana" data-detail="âœ” Full 3 kiáº¿m&#10;âœ” KhÃ´ng rollback&#10;âœ” 2â€“3 ngÃ y">Tam Kiáº¿m Full â€“ 35.000Ä‘</option>
                <option value="CDK|30000" data-info="Cursed Dual Katana" data-detail="âœ” Full CDK&#10;âœ” KhÃ´ng máº¥t item&#10;âœ” 1â€“2 ngÃ y">CDK â€“ 30.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ’  V4">
                <option value="Full Gear V4|30000" data-info="Full Gear V4" data-detail="âœ” Full Gear&#10;âœ” Thá»©c tá»‰nh V4&#10;âœ” 1â€“2 ngÃ y">Full Gear V4 â€“ 30.000Ä‘</option>
                <option value="1 Gear V4|5000" data-info="Up 1 Gear" data-detail="âœ” 1 Gear báº¥t ká»³&#10;âœ” Nhanh gá»n&#10;âœ” Trong ngÃ y">1 Gear V4 â€“ 5.000Ä‘</option>
            </optgroup>
            <optgroup label="ğŸ¥‹ MELEE">
                <option value="Godhuman|20000" data-info="Melee Godhuman" data-detail="âœ” Full Godhuman&#10;âœ” Farm nguyÃªn liá»‡u&#10;âœ” 1 ngÃ y">Godhuman â€“ 20.000Ä‘</option>
                <option value="Melee V2|15000" data-info="Up Melee V2" data-detail="âœ” Melee V2&#10;âœ” Nhanh&#10;âœ” Trong ngÃ y">Melee V2 â€“ 15.000Ä‘</option>
            </optgroup>
        </select>
        <div id="serviceDetail" class="detail-box"></div>
        <input id="accRoblox" placeholder="TÃ i khoáº£n (Username/Email)">
        <input id="passRoblox" type="password" placeholder="Máº­t kháº©u">
        <button class="green" style="width:100%" onclick="handleBuyService()">XÃC NHáº¬N THANH TOÃN</button>
        <button class="purple" style="width:100%" onclick="showNapBank()">ğŸ’³ Náº P TIá»€N QUA BANK / MOMO</button>
    </div>
</div>

<div id="tabShopNick" class="main-tab" style="display:none">
    <div class="box">
        <h3>ğŸ”¥ Danh sÃ¡ch Nick (Chá»‰ Admin tháº¥y)</h3>
        <div id="nickList" class="grid-nicks"></div>
    </div>
</div>

<div id="tabLichSu" class="main-tab" style="display:none">
    <div class="box">
        <h3>ğŸ“œ Tráº¡ng thÃ¡i Ä‘Æ¡n cÃ y cá»§a báº¡n</h3>
        <div id="historyService"></div>
    </div>
    <div class="box">
        <h3>ğŸ’° Lá»‹ch sá»­ náº¡p tiá»n</h3>
        <div id="historyNap"></div>
    </div>
    <div id="boxNickDaMua" class="box" style="display:none">
        <h3>ğŸ”‘ Nick Ä‘Ã£ mua</h3>
        <div id="historyNicks"></div>
    </div>
</div>

<div id="adminView" style="display:none">
    <div class="box" style="border: 2px solid #ef4444;">
        <h2 style="color:#ef4444;">ğŸ›  ADMIN PANEL</h2>
        <div style="display:flex; gap:5px; margin-bottom:10px; overflow-x:auto">
            <button class="gray" onclick="showAdminTab('orders')">ÄÆ¡n CÃ y</button>
            <button class="gray" onclick="showAdminTab('naps')">Duyá»‡t Náº¡p</button>
            <button class="gray" onclick="showAdminTab('addnick')">ThÃªm Nick</button>
            <button class="gray" onclick="showAdminTab('gift')">Cáº¥p Tiá»n</button>
        </div>
        <div id="admOrders" class="adm-tab"><div id="adminOrderList"></div></div>
        <div id="admNaps" class="adm-tab" style="display:none"><div id="adminNapList"></div></div>
        <div id="admAddNick" class="adm-tab" style="display:none">
            <input id="niTitle" placeholder="TiÃªu Ä‘á» Nick">
            <input id="niPrice" type="number" placeholder="GiÃ¡ bÃ¡n">
            <input id="niAcc" placeholder="TÃ i khoáº£n Nick">
            <input id="niPass" placeholder="Máº­t kháº©u Nick">
            <button class="green" style="width:100%" onclick="adminAddNick()">ÄÄ‚NG BÃN NICK</button>
        </div>
        <div id="admGift" class="adm-tab" style="display:none">
            <input id="adTargetUser" placeholder="TÃªn khÃ¡ch hÃ ng">
            <input id="adAmount" type="number" placeholder="Sá»‘ tiá»n cá»™ng">
            <button class="green" style="width:100%" onclick="adminGiftMoney()">XÃC NHáº¬N Cá»˜NG TIá»€N</button>
        </div>
    </div>
</div>

<div id="modalOverlay"><div class="modal" id="modalContent"></div></div>

<script>
const ADMIN_CONFIG = { user: "admin", pass: "admin123" };

let cur = null;
let db_users = JSON.parse(localStorage.getItem('snow_users') || '{}');
let db_orders = JSON.parse(localStorage.getItem('snow_orders') || '[]');
let db_naps = JSON.parse(localStorage.getItem('snow_naps') || '[]');
let db_nicks = JSON.parse(localStorage.getItem('snow_nicks') || '[]');

function save() {
    localStorage.setItem('snow_users', JSON.stringify(db_users));
    localStorage.setItem('snow_orders', JSON.stringify(db_orders));
    localStorage.setItem('snow_naps', JSON.stringify(db_naps));
    localStorage.setItem('snow_nicks', JSON.stringify(db_nicks));
}

function render() {
    if(!cur) {
        document.getElementById('uName').innerText = "KhÃ¡ch";
        document.getElementById('uBalance').innerText = "0";
        document.getElementById('authButtons').style.display = "block";
        document.getElementById('userButtons').style.display = "none";
        document.getElementById('adminView').style.display = "none";
        document.getElementById('tabNickBtn').style.display = "none";
    } else {
        cur = db_users[cur.username];
        document.getElementById('uName').innerText = cur.username;
        document.getElementById('uBalance').innerText = cur.balance.toLocaleString();
        document.getElementById('authButtons').style.display = "none";
        document.getElementById('userButtons').style.display = "block";
        
        // Chá»‰ admin má»›i tháº¥y tab Mua Nick vÃ  Panel
        const isAdmin = (cur.username === ADMIN_CONFIG.user);
        document.getElementById('adminView').style.display = isAdmin ? "block" : "none";
        document.getElementById('tabNickBtn').style.display = isAdmin ? "block" : "none";
        
        // Lá»‹ch sá»­ cÃ y thuÃª riÃªng cá»§a acc
        const myOrders = db_orders.filter(o => o.buyer === cur.username);
        document.getElementById('historyService').innerHTML = myOrders.length ? myOrders.reverse().map(o => `
            <div class="history-item">
                <b>${o.goi}</b> - <span class="badge ${getStatusClass(o.status)}">${o.status}</span><br>
                <small>${o.time}</small>
            </div>
        `).join('') : "Báº¡n chÆ°a cÃ³ Ä‘Æ¡n cÃ y nÃ o.";

        // Lá»‹ch sá»­ náº¡p riÃªng cá»§a acc
        const myNaps = db_naps.filter(n => n.username === cur.username);
        document.getElementById('historyNap').innerHTML = myNaps.length ? myNaps.reverse().map(n => `
            <div class="history-item">
                Náº¡p <b>${n.amount.toLocaleString()}Ä‘</b> - 
                <span class="badge ${n.status==='Xong'?'bg-done':'bg-wait'}">${n.status}</span>
            </div>
        `).join('') : "ChÆ°a cÃ³ lá»‹ch sá»­ náº¡p.";

        // Nick Ä‘Ã£ mua (Chá»‰ hiá»‡n náº¿u cÃ³ mua nick)
        const myNicks = db_nicks.filter(n => n.soldTo === cur.username);
        if(myNicks.length > 0) {
            document.getElementById('boxNickDaMua').style.display = "block";
            document.getElementById('historyNicks').innerHTML = myNicks.map(n => `
                <div style="background:#f8fafc; border:1px solid #e2e8f0; padding:8px; border-radius:8px; margin-top:5px; font-size:13px">
                    <b>${n.title}</b><br>TK: <code>${n.acc}</code> | MK: <code>${n.pass}</code>
                </div>
            `).join('');
        } else {
            document.getElementById('boxNickDaMua').style.display = "none";
        }
    }
    if(cur && cur.username === ADMIN_CONFIG.user) {
        renderShopNick();
        renderAdmin();
    }
}

function showNapBank() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n qua Bank</h3>
        <div style="background:#f0f9ff; padding:15px; border-radius:10px; border:1px dashed #38bdf8; font-size:14px; line-height:1.6">
            NgÃ¢n hÃ ng: <b>MB BANK</b><br>
            STK: <b style="color:#ef4444; font-size:18px">1373727384</b><br>
            Chá»§ TK: <b>NGUYEN VAN A</b><br>
            Ná»™i dung CK: <b style="color:#0ea5e9">NAP ${cur.username}</b>
        </div>
        <p style="font-size:12px; color:#64748b; margin-top:10px">Sau khi chuyá»ƒn khoáº£n, vui lÃ²ng nháº­p sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn vÃ o dÆ°á»›i Ä‘Ã¢y vÃ  báº¥m xÃ¡c nháº­n.</p>
        <input id="na" type="number" placeholder="Nháº­p sá»‘ tiá»n Ä‘Ã£ chuyá»ƒn">
        <button class="green" style="width:100%" onclick="submitNapRequest()">XÃC NHáº¬N ÄÃƒ CHUYá»‚N</button>
    `);
}

function submitNapRequest() {
    const val = document.getElementById('na').value;
    const amt = parseInt(val);
    if(!amt || amt < 1000) return alert("Sá»‘ tiá»n khÃ´ng há»£p lá»‡!");
    db_naps.push({
        username: cur.username,
        amount: amt,
        status: 'Chá» duyá»‡t',
        time: new Date().toLocaleString()
    });
    save(); closeModal(); render();
    alert("YÃªu cáº§u Ä‘Ã£ Ä‘Æ°á»£c gá»­i! Vui lÃ²ng chá» Admin duyá»‡t.");
}

function updateServiceDetail() {
    const select = document.getElementById('goi');
    const option = select.options[select.selectedIndex];
    const detailBox = document.getElementById('serviceDetail');
    if (option.value) {
        detailBox.innerHTML = `<b>${option.getAttribute('data-info')}</b>\n${option.getAttribute('data-detail')}`;
        detailBox.style.display = 'block';
    } else {
        detailBox.style.display = 'none';
    }
}

function getStatusClass(s){ return s==='Xong'?'bg-done':(s==='Äang cÃ y'?'bg-process':'bg-wait'); }

function renderShopNick() {
    const list = db_nicks.filter(n => !n.soldTo);
    document.getElementById('nickList').innerHTML = list.length ? list.map((n, i) => `
        <div class="nick-card">
            <div style="font-weight:bold; height:40px; overflow:hidden">${n.title}</div>
            <div style="color:#16a34a; font-weight:bold; margin:5px 0">${n.price.toLocaleString()}Ä‘</div>
            <button class="green" style="width:100%; font-size:12px" onclick="buyNick('${n.acc}')">MUA NICK</button>
        </div>
    `).join('') : "Háº¿t hÃ ng!";
}

function handleBuyService() {
    if(!cur) return alert("Vui lÃ²ng Ä‘Äƒng nháº­p!");
    const g = document.getElementById('goi').value;
    if(!g) return alert("Vui lÃ²ng chá»n gÃ³i!");
    const [name, price] = g.split('|');
    const acc = document.getElementById('accRoblox').value.trim();
    const pass = document.getElementById('passRoblox').value.trim();
    if(!acc || !pass) return alert("Nháº­p tÃ i khoáº£n/máº­t kháº©u!");
    if(cur.balance < parseInt(price)) return alert("Sá»‘ dÆ° khÃ´ng Ä‘á»§!");

    db_users[cur.username].balance -= parseInt(price);
    db_orders.push({ buyer: cur.username, goi: name, acc, pass, status: "Chá» duyá»‡t", time: new Date().toLocaleString() });
    save(); render(); alert("Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng!");
}

function buyNick(acc) {
    const realIdx = db_nicks.findIndex(n => n.acc === acc);
    const targetNick = db_nicks[realIdx];
    if(cur.balance < targetNick.price) return alert("Sá»‘ dÆ° khÃ´ng Ä‘á»§!");
    db_users[cur.username].balance -= targetNick.price;
    db_nicks[realIdx].soldTo = cur.username;
    save(); render(); alert("Mua thÃ nh cÃ´ng!");
}

function renderAdmin() {
    document.getElementById('adminOrderList').innerHTML = db_orders.map((o, i) => `
        <div class="box" style="font-size:12px; border-left:4px solid #38bdf8">
            <b>${o.buyer}</b> mua ${o.goi} [${o.status}]<br>
            TK: ${o.acc} | MK: ${o.pass}<br>
            <button onclick="updateStatus(${i}, 'ÄÃ£ duyá»‡t')" class="gray" style="font-size:10px">Duyá»‡t</button>
            <button onclick="updateStatus(${i}, 'Äang cÃ y')" class="purple" style="font-size:10px">CÃ y</button>
            <button onclick="updateStatus(${i}, 'Xong')" class="green" style="font-size:10px">DONE</button>
            <button onclick="deleteOrder(${i})" class="red" style="font-size:10px">XoÃ¡</button>
        </div>
    `).reverse().join('');

    document.getElementById('adminNapList').innerHTML = db_naps.map((n, i) => `
        <div class="box">
            <b>${n.username}</b> náº¡p ${n.amount.toLocaleString()}Ä‘<br>
            ${n.status === 'Chá» duyá»‡t' ? `<button onclick="approveNap(${i})" class="green">Cá»˜NG TIá»€N</button>` : 'ÄÃ£ xong'}
            <button onclick="db_naps.splice(${i},1); save(); render();" class="red" style="font-size:10px">XoÃ¡</button>
        </div>
    `).reverse().join('');
}

function adminAddNick() {
    const title = document.getElementById('niTitle').value;
    const price = parseInt(document.getElementById('niPrice').value);
    const acc = document.getElementById('niAcc').value;
    const pass = document.getElementById('niPass').value;
    if(!title || !price || !acc) return alert("Nháº­p Ä‘á»§ thÃ´ng tin!");
    db_nicks.push({ title, price, acc, pass, soldTo: null });
    save(); render(); alert("ÄÃ£ Ä‘Äƒng bÃ¡n!");
}

function adminGiftMoney() {
    const user = document.getElementById('adTargetUser').value.trim();
    const amt = parseInt(document.getElementById('adAmount').value);
    if(db_users[user]) {
        db_users[user].balance += amt;
        save(); render(); alert("ÄÃ£ cá»™ng tiá»n!");
    } else alert("KhÃ´ng tháº¥y user!");
}

function updateStatus(i, s) { db_orders[i].status = s; save(); render(); }
function deleteOrder(i) { if(confirm("XoÃ¡ Ä‘Æ¡n?")) { db_orders.splice(i,1); save(); render(); } }
function approveNap(i) {
    const n = db_naps[i];
    if(db_users[n.username]) {
        db_users[n.username].balance += n.amount;
        db_naps[i].status = "Xong";
        save(); render();
    }
}

function showMainTab(id, btn) {
    document.querySelectorAll('.main-tab').forEach(t => t.style.display = 'none');
    document.getElementById('tab' + id.charAt(0).toUpperCase() + id.slice(1)).style.display = 'block';
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}
function showAdminTab(id) {
    document.querySelectorAll('.adm-tab').forEach(t => t.style.display = 'none');
    document.getElementById('adm' + id.charAt(0).toUpperCase() + id.slice(1)).style.display = 'block';
}
function showLogin() { openModal(`<h3>ğŸ”‘ ÄÄƒng nháº­p</h3><input id="au" placeholder="User"><input id="ap" type="password" placeholder="Pass"><button class="green" style="width:100%" onclick="handleAuth()">VÃ€O SHOP</button>`); }
function handleAuth() {
    const u = document.getElementById('au').value.trim(), p = document.getElementById('ap').value;
    if(!u || !p) return;
    if(!db_users[u]) db_users[u] = { username: u, password: p, balance: 0 };
    else if(db_users[u].password !== p) return alert("Sai máº­t kháº©u");
    cur = db_users[u]; localStorage.setItem('snow_session', u); save(); closeModal(); render();
}
function logout() { localStorage.removeItem('snow_session'); location.reload(); }
function openModal(h) { document.getElementById('modalContent').innerHTML = h + `<button class="red" style="width:100%" onclick="closeModal()">ÄÃ³ng</button>`; document.getElementById('modalOverlay').style.display = "block"; }
function closeModal() { document.getElementById('modalOverlay').style.display = "none"; }

window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session && db_users[session]) cur = db_users[session];
    render();
};
</script>
</body>
</html>
