<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Blox Fruits CÃ y ThuÃª</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#0b0f14;color:#fff}
.hidden{display:none}
.card{background:#121826;border-radius:12px;padding:16px;margin:12px}
input,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#22c55e;color:#000;font-weight:bold}
button.red{background:#ef4444;color:#fff}
.top{display:flex;justify-content:space-between;align-items:center}
.small{opacity:.7;font-size:13px}
</style>
</head>

<body>

<!-- AUTH -->
<div id="auth" class="card">
  <h2>ğŸ” ÄÄƒng nháº­p / ÄÄƒng kÃ½</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Máº­t kháº©u">
  <button onclick="register()">ÄÄƒng kÃ½</button>
  <button onclick="login()">ÄÄƒng nháº­p</button>
  <p id="authMsg" class="small"></p>
</div>

<!-- APP -->
<div id="app" class="hidden">

  <div class="card top">
    <div>
      <b id="userEmail"></b><br>
      ğŸ’° VÃ­: <span id="wallet">0</span> Ä‘
    </div>
    <button class="red" onclick="logout()">ThoÃ¡t</button>
  </div>

  <!-- ORDER -->
  <div class="card">
    <h3>ğŸ“¦ ThuÃª cÃ y</h3>
    <select id="service">
      <option value="20000">Level 700 â†’ 1500 (20k)</option>
      <option value="30000">CDK (30k)</option>
      <option value="20000">Godhuman (20k)</option>
    </select>
    <button onclick="createOrder()">ThuÃª ngay</button>
  </div>

  <!-- HISTORY -->
  <div class="card">
    <h3>ğŸ“œ ÄÆ¡n cá»§a báº¡n</h3>
    <div id="orders"></div>
  </div>

  <!-- ADMIN -->
  <div id="admin" class="card hidden">
    <h3>ğŸ§‘â€ğŸ’» ADMIN PANEL</h3>
    <input id="adminUid" placeholder="UID user">
    <input id="adminMoney" placeholder="Sá»‘ tiá»n (+/-)">
    <button onclick="adminAdjust()">Chá»‰nh vÃ­</button>
  </div>

  <!-- SUPPORT -->
  <div class="card small">
    ğŸ†˜ Discord: <a href="https://discord.gg/G2gaVehJ">discord.gg/G2gaVehJ</a><br>
    ğŸ“± Zalo: 0373727384
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBe1mlXDAnOWzqkMarFN5PKJmuM9YIKTs4",
  authDomain: "nott-9d55e.firebaseapp.com",
  projectId: "nott-9d55e",
  storageBucket: "nott-9d55e.firebasestorage.app",
  messagingSenderId: "1013326079626",
  appId: "1:1013326079626:web:2b24a7753d09f97187af73",
  measurementId: "G-93C68KND1B"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.firestore();
</script>
/* ================================================== */

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* AUTH */
async function register(){
  try{
    const email=email.value, pass=password.value;
    const res=await auth.createUserWithEmailAndPassword(email,pass);
    await db.collection("users").doc(res.user.uid).set({
      email, wallet:0, role:"user", created:Date.now()
    });
  }catch(e){authMsg.innerText=e.message}
}

async function login(){
  try{
    await auth.signInWithEmailAndPassword(email.value,password.value);
  }catch(e){authMsg.innerText=e.message}
}

function logout(){auth.signOut()}

/* STATE */
auth.onAuthStateChanged(async user=>{
  if(!user){auth.classList.remove("hidden");app.classList.add("hidden");return}
  auth.classList.add("hidden");app.classList.remove("hidden");
  userEmail.innerText=user.email;

  const ref=db.collection("users").doc(user.uid);
  ref.onSnapshot(s=>{
    wallet.innerText=s.data().wallet||0;
    if(s.data().role==="admin") admin.classList.remove("hidden");
  });

  db.collection("orders").where("uid","==",user.uid)
    .onSnapshot(q=>{
      orders.innerHTML="";
      q.forEach(d=>{
        const o=d.data();
        orders.innerHTML+=`<div class="small">#${d.id} | ${o.price}Ä‘ | ${o.status}</div>`;
      });
    });
});

/* ORDER */
async function createOrder(){
  const price=parseInt(service.value);
  const u=auth.currentUser;
  const ref=db.collection("users").doc(u.uid);

  await db.runTransaction(async t=>{
    const snap=await t.get(ref);
    if(snap.data().wallet<price) throw "KhÃ´ng Ä‘á»§ tiá»n";
    t.update(ref,{wallet:snap.data().wallet-price});
    t.set(db.collection("orders").doc(),{
      uid:u.uid, price, status:"Äang cÃ y", time:Date.now()
    });
  });
}

/* ADMIN */
async function adminAdjust(){
  const ref=db.collection("users").doc(adminUid.value);
  await db.runTransaction(async t=>{
    const s=await t.get(ref);
    t.update(ref,{wallet:s.data().wallet+parseInt(adminMoney.value)});
  });
}
</script>
</body>
</html>
