<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>â„ï¸ SNOW SHOP â€” CÃ y ThuÃª Blox Fruits</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body{font-family:Arial,sans-serif;background:#f1f5f9;margin:0;padding-bottom:50px}
        .box{background:#fff;margin:12px;border-radius:12px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
        button{background:#38bdf8;border:0;padding:10px 14px;border-radius:10px;font-weight:bold;margin:6px 0;cursor:pointer;transition:0.3s;color:#fff}
        button:hover{opacity:0.8}
        button.red{background:#ef4444}
        button.green{background:#22c55e}
        button.orange{background:#f59e0b}
        input,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
        small{color:#555;display:block;margin-top:5px}
        .info{background:#f8fafc;border:1px dashed #38bdf8;border-radius:10px;padding:10px;margin-top:10px;line-height:1.6;font-size:14px}
        .qr-box{text-align:center;padding:15px;background:#f1f5f9;border-radius:10px;margin-top:10px}
        .history-item{padding:8px;border-bottom:1px solid #eee;font-size:13px}
        #modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:99}
    </style>
</head>
<body>

<div id="modal-overlay"></div>

<div class="box">
    ğŸ‘¤ <b id="u">ChÆ°a Ä‘Äƒng nháº­p</b> | 
    ğŸ’° <b id="b">0</b>Ä‘ 
    <button class="red" onclick="logout()" style="float:right;padding:5px 10px">ThoÃ¡t</button>
</div>

<div class="box" id="auth_section">
    <button onclick="showAuth()" style="width:100%">ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</button>
</div>

<div class="box" id="user_actions" style="display:none">
    <button class="orange" onclick="showDeposit()" style="width:48%">ğŸ’³ Náº¡p tiá»n</button>
    <button id="adminBtn" class="red" style="display:none;width:48%" onclick="showAdmin()">ğŸ›  Admin</button>
</div>

<div class="box">
    <h3>ğŸ›’ Dá»‹ch vá»¥ CÃ y ThuÃª</h3>
    <select id="goi" onchange="showInfo()">
        <option value="">-- Chá»n gÃ³i dá»‹ch vá»¥ --</option>
        <optgroup label="ğŸ”° LEVEL">
            <option value="Level 700|20000" data-info="Farm lÃªn level 700" data-detail="âœ” Tá»‘c Ä‘á»™ nhanh<br>âœ” An toÃ n 100%">Level 700 â€“ 20.000Ä‘</option>
            <option value="0 â†’ MAX|50000" data-info="CÃ y Max Level" data-detail="âœ” Full Sea 1-2-3<br>âœ” 4â€“6 ngÃ y hoÃ n thÃ nh">0 â†’ MAX â€“ 50.000Ä‘</option>
        </optgroup>
        <optgroup label="ğŸ’ ITEM">
            <option value="CDK|30000" data-info="Láº¥y Song kiáº¿m CDK" data-detail="âœ” YÃªu cáº§u lv 2200+<br>âœ” HoÃ n thÃ nh nhanh">CDK â€“ 30.000Ä‘</option>
        </optgroup>
    </select>
    <div id="goiInfo" class="info" style="display:none"></div>
    <button class="green" style="width:100%;font-size:16px;margin-top:10px" onclick="order()">MUA NGAY (Trá»« vÃ­)</button>
</div>

<div class="box">
    <h3>ğŸ“œ Lá»‹ch sá»­ giao dá»‹ch</h3>
    <div id="his"><i>ChÆ°a cÃ³ giao dá»‹ch nÃ o</i></div>
</div>

<div id="adminPanel" class="box" style="display:none;border-top:4px solid red">
    <h3>ğŸ›  Quáº£n trá»‹ viÃªn (Cá»™ng tiá»n)</h3>
    <input type="text" id="admin_target" placeholder="TÃªn tÃ i khoáº£n khÃ¡ch">
    <input type="number" id="admin_amount" placeholder="Sá»‘ tiá»n cá»™ng">
    <input type="password" id="admin_key_input" placeholder="Nháº­p mÃ£ Admin Key">
    <button class="red" style="width:100%" onclick="adminAddMoney()">XÃC NHáº¬N Cá»˜NG TIá»€N</button>
</div>

<div id="modal_content"></div>

<script>
// Cáº¤U HÃŒNH Báº¢O Máº¬T
const ADMIN_KEY = "SNOW_ADMIN_123"; // Thay mÃ£ nÃ y Ä‘á»ƒ báº£o máº­t náº¡p tiá»n
const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465766093543964673/QfBdKIbYOgo5_s9S_YaJDF6vg6ZF8RyWwEw06uPZW3YtZuPUjCmODVJfdFmowfH1d9Gm";

let cur = null;

// Tá»± Ä‘á»™ng táº£i dá»¯ liá»‡u khi má»Ÿ trang
window.onload = () => {
    const session = localStorage.getItem('snow_session');
    if(session) {
        loadUser(session);
    }
};

function loadUser(username) {
    const data = localStorage.getItem('user_' + username);
    if(data) {
        cur = JSON.parse(data);
        render();
    }
}

function saveUser() {
    if(cur) {
        localStorage.setItem('user_' + cur.username, JSON.stringify(cur));
    }
}

function render() {
    if(!cur) {
        document.getElementById('u').innerText = "ChÆ°a Ä‘Äƒng nháº­p";
        document.getElementById('b').innerText = "0";
        document.getElementById('auth_section').style.display = "block";
        document.getElementById('user_actions').style.display = "none";
        document.getElementById('adminBtn').style.display = "none";
        document.getElementById('his').innerHTML = "<i>Vui lÃ²ng Ä‘Äƒng nháº­p</i>";
        return;
    }
    document.getElementById('u').innerText = cur.username;
    document.getElementById('b').innerText = cur.balance.toLocaleString();
    document.getElementById('auth_section').style.display = "none";
    document.getElementById('user_actions').style.display = "block";
    
    if(cur.username === 'admin') document.getElementById('adminBtn').style.display = 'inline-block';

    // Render lá»‹ch sá»­
    const hisBox = document.getElementById('his');
    if(cur.history.length === 0) {
        hisBox.innerHTML = "<i>ChÆ°a cÃ³ giao dá»‹ch</i>";
    } else {
        hisBox.innerHTML = cur.history.map(h => `<div class="history-item"><b>[${h.time}]</b> ${h.msg}</div>`).join('');
    }
}

function showAuth() {
    openModal(`
        <h3>ğŸ”‘ ÄÄƒng nháº­p / ÄÄƒng kÃ½</h3>
        <small>Náº¿u chÆ°a cÃ³ tk, há»‡ thá»‘ng sáº½ tá»± táº¡o má»›i vá»›i máº­t kháº©u báº¡n nháº­p.</small>
        <input id="au" placeholder="TÃªn tÃ i khoáº£n...">
        <input id="ap" type="password" placeholder="Máº­t kháº©u...">
        <button onclick="handleAuth()" style="width:100%">XÃC NHáº¬N</button>
    `);
}

function handleAuth() {
    const user = document.getElementById('au').value.trim();
    const pass = document.getElementById('ap').value.trim();
    if(user.length < 3) return alert("TÃªn quÃ¡ ngáº¯n");

    const existing = localStorage.getItem('user_' + user);
    if(existing) {
        const parsed = JSON.parse(existing);
        if(parsed.password !== pass) return alert("Sai máº­t kháº©u!");
        cur = parsed;
    } else {
        cur = { username: user, password: pass, balance: 0, history: [] };
        saveUser();
    }
    localStorage.setItem('snow_session', cur.username);
    closeModal();
    render();
}

function showDeposit() {
    openModal(`
        <h3>ğŸ’³ Náº¡p tiá»n qua QR</h3>
        <input type="number" id="napAmount" placeholder="Nháº­p sá»‘ tiá»n..." oninput="updateQR()">
        <div class="qr-box" id="qrArea">Vui lÃ²ng nháº­p sá»‘ tiá»n</div>
        <p style="font-size:12px; color:red">LÆ°u Ã½: Sau khi chuyá»ƒn khoáº£n, hÃ£y Ä‘á»£i Admin kiá»ƒm tra vÃ  cá»™ng tiá»n vÃ o vÃ­.</p>
    `);
}

function updateQR() {
    const amount = document.getElementById('napAmount').value;
    const qrArea = document.getElementById('qrArea');
    if(amount < 1000) {
        qrArea.innerHTML = "Tá»‘i thiá»ƒu 1,000Ä‘";
        return;
    }
    const content = `NAP ${cur.username}`;
    const qrUrl = `https://img.vietqr.io/image/TCB-1373727384-compact.png`;
    qrArea.innerHTML = `<img src="${qrUrl}" style="width:180px"><br>Ná»™i dung: <b>${content}</b>`;
}

async function order() {
    if(!cur) return alert("HÃ£y Ä‘Äƒng nháº­p!");
    const select = document.getElementById('goi');
    if(!select.value) return alert("HÃ£y chá»n gÃ³i!");

    const [name, price] = select.value.split('|');
    const cost = parseInt(price);

    if(cur.balance < cost) return alert("VÃ­ khÃ´ng Ä‘á»§ tiá»n! Vui lÃ²ng náº¡p thÃªm.");

    cur.balance -= cost;
    cur.history.unshift({time: new Date().toLocaleString(), msg: `Mua gÃ³i ${name} -${cost}Ä‘`});
    saveUser();
    render();
    
    alert("Äáº·t Ä‘Æ¡n thÃ nh cÃ´ng! Admin sáº½ xá»­ lÃ½ sá»›m.");
    
    // Gá»­i Discord thÃ´ng bÃ¡o cho Admin
    await fetch(DISCORD_WEBHOOK, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            content: `ğŸ”” **ÄÆ N Má»šI**: KhÃ¡ch **${cur.username}** vá»«a mua **${name}** (${cost}Ä‘)`
        })
    });
}

function adminAddMoney() {
    const target = document.getElementById('admin_target').value.trim();
    const amount = parseInt(document.getElementById('admin_amount').value);
    const key = document.getElementById('Simohayha').value;

    if(key !== ADMIN_KEY) return alert("Sai mÃ£ Admin Key! Äá»«ng hack báº¡n Æ¡i.");
    
    const targetData = localStorage.getItem('user_' + target);
    if(!targetData) return alert("KhÃ´ng tÃ¬m tháº¥y ngÆ°á»i dÃ¹ng nÃ y!");

    let userObj = JSON.parse(targetData);
    userObj.balance += amount;
    userObj.history.unshift({time: new Date().toLocaleString(), msg: `Admin cá»™ng +${amount}Ä‘`});
    localStorage.setItem('user_' + target, JSON.stringify(userObj));
    
    if(cur && cur.username === target) {
        cur = userObj;
        render();
    }
    alert("ÄÃ£ cá»™ng tiá»n thÃ nh cÃ´ng cho " + target);
}

function showAdmin() {
    const p = document.getElementById('adminPanel');
    p.style.display = p.style.display === 'none' ? 'block' : 'none';
}

function logout() {
    localStorage.removeItem('snow_session');
    cur = null;
    location.reload();
}

function showInfo(){
    let s = document.getElementById('goi').options[document.getElementById('goi').selectedIndex];
    const info = document.getElementById('goiInfo');
    if(!s.value) { info.style.display="none"; return; }
    info.style.display="block";
    info.innerHTML=`<b>ğŸ“Œ ${s.dataset.info}</b><br>${s.dataset.detail}`;
}

function openModal(html) {
    const m = document.getElementById('modal_content');
    const o = document.getElementById('modal-overlay');
    m.innerHTML = `<div class="box" style="position:fixed;top:10%;left:5%;right:5%;z-index:100;border:2px solid #38bdf8">
        ${html}
        <button class="red" onclick="closeModal()" style="width:100%">ÄÃ“NG</button>
    </div>`;
    o.style.display = "block";
}

function closeModal() {
    document.getElementById('modal_content').innerHTML = "";
    document.getElementById('modal-overlay').style.display = "none";
}
</script>

</body>
</html>
