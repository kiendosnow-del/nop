if (price <= 0) {
  alert("â„ï¸ Vui lÃ²ng chá»n gÃ³i dá»‹ch vá»¥");
  return;
}
const gia = document.getElementById("totalPrice").innerText;
const ADMIN_PASSWORD = "snowadmin123"; // Ä‘á»•i tÃ¹y báº¡n
const firebaseConfig = {
  apiKey: "AIzaSyD-wt7xZrb-pVmE6MVumtCElOGl2woeVP8",
  authDomain: "snow-shop-d8c02.firebaseapp.com",
  projectId: "snow-shop-d8c02",
  storageBucket: "snow-shop-d8c02.firebasestorage.app",
  messagingSenderId: "7891801203",
  appId: "1:7891801203:web:958c5e37bb65dbee884606",
  measurementId: "G-M7CJZ8588Q"
};
function register(){
  const email = regEmail.value;
  const pass = regPass.value;
  const username = regName.value;

  auth.createUserWithEmailAndPassword(email, pass)
  .then(res=>{
    return db.collection("users").doc(res.user.uid).set({
      username,
      wallet: 0,
      created: new Date()
    });
  })
  .then(()=> alert("âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng!"));
}
function login(){
  auth.signInWithEmailAndPassword(loginEmail.value, loginPass.value)
  .then(()=> alert("âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng"));
}
auth.onAuthStateChanged(user=>{
  if(!user) return;

  db.collection("users").doc(user.uid).onSnapshot(doc=>{
    document.getElementById("wallet").innerText =
      doc.data().wallet.toLocaleString()+"Ä‘";
  });
});
function guiDon(){
  const price = Number(goi.value);
  const note = textarea.value;

  auth.onAuthStateChanged(user=>{
    if(!user) return alert("ChÆ°a Ä‘Äƒng nháº­p!");

    const userRef = db.collection("users").doc(user.uid);

    db.runTransaction(async t=>{
      const doc = await t.get(userRef);
      if(doc.data().wallet < price)
        throw "KhÃ´ng Ä‘á»§ tiá»n";

      t.update(userRef,{ wallet: doc.data().wallet - price });

      db.collection("orders").add({
        uid: user.uid,
        username: doc.data().username,
        goi: goi.options[goi.selectedIndex].text,
        price,
        note,
        status:"Chá» duyá»‡t",
        time: new Date()
      });
    })
    .then(()=> alert("âœ… Mua thÃ nh cÃ´ng"))
    .catch(e=>alert(e));
  });
}
db.collection("orders").onSnapshot(snap=>{
  snap.forEach(doc=>{
    const o = doc.data();
    adminBox.innerHTML += `
      <div>
        ğŸ‘¤ ${o.username}<br>
        ğŸ“¦ ${o.goi}<br>
        ğŸ’° ${o.price}Ä‘<br>
        ğŸ“Œ ${o.status}<br>
        <button onclick="duyet('${doc.id}')">âœ” Duyá»‡t</button>
      </div>`;
  });
});

function duyet(id){
  db.collection("orders").doc(id).update({
    status:"ÄÃ£ duyá»‡t"
  });
}
