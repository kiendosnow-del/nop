async function register(){
  try{
    const emailValue = document.getElementById("email").value;
    const passValue  = document.getElementById("password").value;

    const res = await auth.createUserWithEmailAndPassword(
      emailValue,
      passValue
    );

    await db.collection("users").doc(res.user.uid).set({
      email: emailValue,
      wallet: 0,
      role: "user",
      created: Date.now()
    });

  }catch(e){
    document.getElementById("authMsg").innerText = e.message;
  }
}
async function login(){
  try{
    const emailValue = document.getElementById("email").value;
    const passValue  = document.getElementById("password").value;

    await auth.signInWithEmailAndPassword(
      emailValue,
      passValue
    );

  }catch(e){
    document.getElementById("authMsg").innerText = e.message;
  }
}
auth.onAuthStateChanged(user=>{
  if(!user){
    document.getElementById("authBox").classList.remove("hidden");
    document.getElementById("app").classList.add("hidden");
    return;
  }

  document.getElementById("authBox").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");

  document.getElementById("userEmail").innerText = user.email;

  db.collection("users").doc(user.uid)
    .onSnapshot(s=>{
      document.getElementById("wallet").innerText = s.data().wallet || 0;
      if(s.data().role === "admin"){
        document.getElementById("admin").classList.remove("hidden");
      }
    });
});
