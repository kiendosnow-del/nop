<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>ğŸ‘‘ SNOW SHOP â€” ADMIN</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{font-family:Arial;background:#0f172a;margin:0;color:#fff}
.box{background:#020617;margin:14px;border-radius:14px;padding:16px}
h3{margin:0 0 10px}
button{
 background:#38bdf8;border:0;padding:8px 12px;
 border-radius:8px;font-weight:bold;cursor:pointer
}
button.red{background:#ef4444;color:#fff}
button.green{background:#22c55e;color:#000}
input,select{
 width:100%;padding:8px;margin:6px 0;
 border-radius:8px;border:0
}
hr{border:none;border-top:1px solid #334155;margin:10px 0}
.row{display:flex;gap:8px;flex-wrap:wrap}
.card{
 background:#020617;border:1px solid #1e293b;
 padding:10px;border-radius:10px;margin:6px 0
}
small{color:#94a3b8}
</style>
</head>

<body>

<div class="box">
ğŸ‘‘ <b>ADMIN PANEL</b>
<button onclick="logout()" class="red" style="float:right">ÄÄƒng xuáº¥t</button>
</div>

<div class="box" id="loginBox">
<h3>ğŸ” ÄÄƒng nháº­p Admin</h3>
<input id="u" placeholder="Admin user">
<input id="p" type="password" placeholder="Password">
<button onclick="login()">ÄÄƒng nháº­p</button>
</div>

<div id="main" style="display:none">

<div class="box">
<h3>ğŸ’¸ Duyá»‡t náº¡p tiá»n</h3>
<div id="deps"></div>
</div>

<div class="box">
<h3>ğŸ“¦ Quáº£n lÃ½ Ä‘Æ¡n thuÃª</h3>
<div id="orders"></div>
</div>

<div class="box">
<h3>ğŸ‘¤ Danh sÃ¡ch User</h3>
<div id="users"></div>
</div>

</div>

<script>
const API="/api";
let token=null;

/* ===== AUTH ===== */
async function login(){
 const res=await fetch(API+"/auth/login",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({username:u.value,password:p.value})
 });
 const data=await res.json();
 if(!data.token) return alert("Sai tÃ i khoáº£n");
 token=data.token;
 loginBox.style.display="none";
 main.style.display="block";
 loadAll();
}

function logout(){
 token=null;
 main.style.display="none";
 loginBox.style.display="block";
}

/* ===== LOAD ===== */
async function loadAll(){
 loadDeposits();
 loadOrders();
 loadUsers();
}

/* ===== DEPOSITS ===== */
async function loadDeposits(){
 const res=await fetch(API+"/admin/deposits",{headers:{Authorization:"Bearer "+token}});
 const d=await res.json();
 deps.innerHTML=d.length?d.map(x=>`
  <div class="card">
  ğŸ‘¤ ${x.username}<br>
  ğŸ’° ${x.amount}Ä‘<br>
  <small>${new Date(x.time).toLocaleString()}</small><br><br>
  <button class="green" onclick="approveDep(${x.id})">Duyá»‡t + Cá»™ng tiá»n</button>
  </div>
 `).join(""):"<small>KhÃ´ng cÃ³</small>";
}

async function approveDep(id){
 if(!confirm("XÃ¡c nháº­n duyá»‡t náº¡p?"))return;
 await fetch(API+"/admin/deposits/"+id,{
  method:"POST",
  headers:{Authorization:"Bearer "+token}
 });
 loadDeposits();
 loadUsers();
}

/* ===== ORDERS ===== */
async function loadOrders(){
 const res=await fetch(API+"/admin/orders",{headers:{Authorization:"Bearer "+token}});
 const o=await res.json();
 orders.innerHTML=o.map(x=>`
  <div class="card">
  ğŸ‘¤ ${x.username}<br>
  ğŸ“¦ ${x.service}<br>
  ğŸ’° ${x.price}Ä‘<br>
  <small>${new Date(x.time).toLocaleString()}</small><br><br>
  <select onchange="setStatus(${x.id},this.value)">
   <option ${x.status=="Äang chá»"?"selected":""}>Äang chá»</option>
   <option ${x.status=="Äang lÃ m"?"selected":""}>Äang lÃ m</option>
   <option ${x.status=="HoÃ n thÃ nh"?"selected":""}>HoÃ n thÃ nh</option>
  </select>
  </div>
 `).join("");
}

async function setStatus(id,s){
 await fetch(API+"/admin/orders/"+id,{
  method:"POST",
  headers:{
   "Content-Type":"application/json",
   Authorization:"Bearer "+token
  },
  body:JSON.stringify({status:s})
 });
}

/* ===== USERS ===== */
async function loadUsers(){
 const res=await fetch(API+"/admin/users",{headers:{Authorization:"Bearer "+token}});
 const u=await res.json();
 users.innerHTML=u.map(x=>`
  <div class="card">
  ğŸ‘¤ ${x.username}<br>
  ğŸ’° ${x.balance}Ä‘
  </div>
 `).join("");
}
</script>

</body>
</html>
